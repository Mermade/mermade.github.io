<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

	<meta name="description" content="Open source software including BBC Nitro feed parser" />

    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/github-dark.css" media="screen">
    <!-- <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print"> -->
	<link rel="stylesheet" type="text/css" href="/stylesheets/datatables.css" media="screen">
	<link rel="stylesheet" type="text/css" href="/stylesheets/colorbox.css" media="screen">

		<script src="/javascripts/jQuery-min.js"></script>
		<script src="/javascripts/dataTables.js"></script>
		<script src="/javascripts/jquery.colorbox-min.js"></script>

    <title>Software by Mermade</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Mermade Software</h1>
        <h2>Itches elegantly scratched</h2>

        <section id="downloads">
          <a href="https://github.com/Mermade" class="btn btn-github"><span class="icon"></span>Follow us on GitHub</a>
		  <a id="aPassHash" href="/static/passwordHasher.html" class="btn btn-passwd"><span class="icon"></span>Generate secure passwords</a>
		  <a href="mailto:meic@gmx.com" class="btn btn-mail"><span class="icon"></span>Contact us</a>
		</section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">

	  <div><a id="imagelink" href=""><img id="image" src="" alt="Image placeholder"/></a><br>
	  <span>Default version PID= <span id="verpid"></span></span>
	  </div>

	  <table id="tblMain" class="display">
	  <thead>
	  <tr><td>Field</td><td>Value</td></tr>
	  </thead>
	  <tbody>
	  </tbody>
	  </table>

      </section>
    </div>

	<script language="JavaScript" type='text/javascript'>
		function getParameterByName(name) {
			name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
			return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
		}
		function extractDetails(p,result,prefix) {
			var parentPid = getParameterByName('pid');
			if (p.image && p.image.pid && prefix == '') {
				$('#image').attr('src','http://ichef.bbci.co.uk/images/ic/640x360/'+p.image.pid+'.jpg');
				$('#imagelink').attr('href','http://bbc.co.uk/programmes/'+parentPid);
			}

			for (var i in p) {
				if (i == 'pid') {
					var href = '<a href="/bbc/detail.html?pid=' + p[i] + '">' + p[i] + '</a>';
					result.push([prefix+i,href]);
				}
				else if (!(p[i] instanceof Object)) {
					result.push([prefix+i,p[i]]);
				}
				else if (i == 'versions') {
					for (var v in p.versions) {
						var ver = p.versions[v];
						if (ver.canonical == 1 && prefix == '') {
							$('#verpid').text(ver.pid);
						}
						for (var j in ver) {
							if (!(ver[j] instanceof Object)) {
								result.push(['Version #'+v+' '+j,ver[j]]);
							}
							else {
								result.push(['Version #'+v+' '+j,JSON.stringify(ver[j])]);
							}
						}
					}
				}
				else if (i == 'parent') {
					var level = 1;
					var parent = p.parent.programme;
					var loop = true;
					while (loop) {
						loop = false;
						extractDetails(parent,result,'Parent '+level+' ');
						for (var j in parent) {
							if (j == 'parent') {
								parent = parent.parent.programme;
								loop = true;
								level++;
							}
						}
					}
				}
				else if (i == 'links') {
					for (var l in p.links) {
						var link = p.links[l];
						var href = '<a href="' + link.url + '">' + link.title + '</a>';
						result.push([link.type,href]);
					}
				}
				else if (i == 'ownership') {
					var href = '<a href="http://www.bbc.co.uk/'+p.ownership.service.key+'">'+
						p.ownership.service.title+'</a>';
					result.push([prefix+i,href]);
				}
				else if (i == 'display_title') {
					result.push([prefix+i,p[i].title+'\n'+(p[i].subtitle ? p[i].subtitle : '')]);
				}
				else if (i == 'peers') {
					for (var np in p.peers) {
						var peer = p.peers[np];
						if (peer) {
							var href = '<a href="/bbc/detail.html?pid='+peer.pid+'">'+peer.title+'</a>';
							result.push(['peer '+np,href]);
						}
					}
				}
				else if (i == 'categories') {
					for (var c in p.categories) {
						var cat = p.categories[c];
						result.push([i,cat.title]);
					}
				}
				else {
					result.push([prefix+i,JSON.stringify(p[i])]);
				}
			}
			return result;
		}
		$(document).ready(function(){
			$("#aPassHash").colorbox({iframe:true, width:"410", height:"90%"});
			var parentPid = getParameterByName('pid');
			var table = $('#tblMain').DataTable({
				"ajax": {
					url: 'http://www.bbc.co.uk/programmes/'+parentPid+'.json',
					"dataSrc": function(json){
						var result = [];
						if (!json.programme) {
							alert(JSON.stringify(json));
						}
						else {
							extractDetails(json.programme,result,'');
						}
						return result;
					}
				}
				//,
				//"columns": [
				//	{ "data": "0"},
				//	{ "data": "1"}
				//]
			});
			table.on( 'xhr', function () {
				var json = table.ajax.json();
				//alert( ((json && json.category_slice) ? json.category_slice.programmes.length : 0)+' row(s) were loaded');
				return {};
			});
			$('#category').change(function(){
				table.ajax.url('http://www.bbc.co.uk/radio/programmes/genres/'+this.value+'/player.json').load();
			});
			//
			//table.ajax.reload(function(data){
			//	alert('Got some data');
			//});
			//alert('oh');
		});
	</script>

  </body>
</html>
