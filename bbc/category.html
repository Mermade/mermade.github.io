<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

	<meta name="description" content="Open source software including BBC Nitro feed parser" />

    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/github-dark.css" media="screen">
    <!-- <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print"> -->
	<link rel="stylesheet" type="text/css" href="/stylesheets/datatables.css" media="screen">
	<link rel="stylesheet" type="text/css" href="/stylesheets/colorbox.css" media="screen">

	<script src="/javascripts/jQuery-min.js"></script>
	<script src="/javascripts/dataTables.js"></script>
	<script src="/javascripts/jquery.colorbox-min.js"></script>

	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-71322956-1', 'auto');
	ga('send', 'pageview');
	</script>

    <title>Software by Mermade</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Mermade Software / BBC</h1>
        <h2>Itches elegantly scratched</h2>

        <section id="downloads">
          <a href="https://github.com/Mermade" class="btn btn-github"><span class="icon"></span>Follow us on GitHub</a>
		  <a id="aPassHash" href="/static/passwordHasher.html" class="btn btn-passwd"><span class="icon"></span>Generate secure passwords</a>
		  <a href="mailto:meic@gmx.com" class="btn btn-mail"><span class="icon"></span>Contact us</a>
		</section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">

	  <form id="form1">
		<div>
		<input type="radio" id="rbRadio" name="domain" value="/radio" checked />Radio Only
		&nbsp;-&nbsp;
		<input type="radio" id="rbTv" name="domain" value=""/>Radio and TV
		</div>
		<div>
		<input type="radio" name="page" value="/player" checked />Available
		&nbsp;-&nbsp;
		<input type="radio" name="page" value="/schedules/upcoming"/>Upcoming
		&nbsp;-&nbsp;
		<input type="radio" name="page" value="/player/episodes"/>Latest
		</div>
		<div>

<select id="category" name="category">
<option value="formats/animation">Animation*</option>
<optgroup label="Childrens">
<option value="genres/childrens/activities">Childrens/Activities</option>
<option value="genres/childrens/drama">Childrens/Drama</option>
<option value="genres/childrens/entertainmentandcomedy">Childrens/Entertainment &amp; Comedy</option>
<option value="genres/childrens/factual">Childrens/Factual</option>
<option value="genres/childrens/music">Childrens/Music</option>
<option value="genres/childrens/news">Childrens/News*</option>
<option value="genres/childrens/sport">Childrens/Sport</option>
</optgroup>
<optgroup label="Comedy">
<option value="genres/comedy">Comedy (all)</option>
<option value="genres/comedy/character">Comedy/Character</option>
<option value="genres/comedy/impressionists">Comedy/Impressionists</option>
<option value="genres/comedy/music">Comedy/Music</option>
<option value="genres/comedy/satire">Comedy/Satire</option>
<option value="genres/comedy/sitcoms">Comedy/Sitcoms</option>
<option value="genres/comedy/sketch">Comedy/Sketch</option>
<option value="genres/comedy/spoof">Comedy/Spoof</option>
<option value="genres/comedy/standup">Comedy/Standup</option>
<option value="genres/comedy/stunt">Comedy/Stunt</option>
</optgroup>
<optgroup label="Drama">
<option value="genres/drama">Drama (All)</option>
<option value="genres/drama/actionandadventure">Drama/Action &amp; Adventure</option>
<option value="genres/drama/biographical">Drama/Biographical</option>
<option value="genres/drama/classicandperiod">Drama/Classic &amp; Period</option>
<option value="genres/drama/crime">Drama/Crime</option>
<option value="genres/drama/historical">Drama/Historical</option>
<option value="genres/drama/horrorandsupernatural">Drama/Horror &amp; Supernatural</option>
<option value="genres/drama/legalandcourtroom">Drama/Legal &amp; Courtroom</option>
<option value="genres/drama/medical">Drama/Medical</option>
<option value="genres/drama/musical">Drama/Musical</option>
<option value="genres/drama/political">Drama/Political</option>
<option value="genres/drama/psychological">Drama/Psychological</option>
<option value="genres/drama/relationshipsandromance">Drama/Relationships &amp; Romance</option>
<option value="genres/drama/scifiandfantasy" selected>Drama/SciFi &amp; Fantasy</option>
<option value="genres/drama/soaps">Drama/Soaps</option>
<option value="genres/drama/spiritual">Drama/Spiritual</option>
<option value="genres/drama/thriller">Drama/Thriller</option>
<option value="genres/drama/waranddisaster">Drama/War &amp; Disaster</option>
<option value="genres/drama/western">Drama/Western</option>
</optgroup>
<option value="formats/docudramas">Docudramas</option>
<option value="formats/documentaries">Documentaries</option>
<option value="genres/entertainment/varietyshows">Entertainment/Variety Shows</option>
<optgroup label="Factual">
<option value="genres/factual/antiques">Factual/Antiques</option>
<option value="genres/factual/artscultureandthemedia">Factual/Arts, Culture &amp; the Media</option>
<option value="genres/factual/beautyandstyle">Factual/Beauty &amp; Style</option>
<option value="genres/factual/carsandmotors">Factual/Cars &amp; Motors</option>
<option value="genres/factual/consumer">Factual/Consumer</option>
<option value="genres/factual/crimeandjustice">Factual/Crime &amp; Justice</option>
<option value="genres/factual/disability">Factual/Disability</option>
<option value="genres/factual/familiesandrelationships">Factual/Families &amp; Relationships</option>
<option value="genres/factual/foodanddrink">Factual/Food &amp; Drink</option>
<option value="genres/factual/healthandwellbeing">Factual/Health &amp; Wellbeing</option>
<option value="genres/factual/history">Factual/History</option>
<option value="genres/factual/homesandgardens">Factual/Homes &amp; Gardens</option>
<option value="genres/factual/lifestories">Factual/Life Stories</option>
<option value="genres/factual/money">Factual/Money</option>
<option value="genres/factual/petsandanimals">Factual/Pets &amp; Animals</option>
<option value="genres/factual/politics">Factual/Politics</option>
<option value="genres/factual/scienceandnature">Factual/Science &amp; Nature</option>
<option value="genres/factual/travel">Factual/Travel</option>
</optgroup>
<option value="formats/films">Films*</option>
<optgroup label="Learning">
<option value="genres/learning/adults">Learning/Adults</option>
<option value="genres/learning/preschool">Learning/Pre-School</option>
<option value="genres/learning/primary">Learning/Primary</option>
<option value="genres/learning/secondary">Learning/Secondary</option>
</optgroup>
<optgroup label="Music">
<option value="genres/music/classicpopandrock">Music/Classic Pop &amp; Rock</option>
<option value="genres/music/classical">Music/Classical</option>
<option value="genres/music/country">Music/Country</option>
<option value="genres/music/danceandelectronica">Music/Dance &amp; Electronica</option>
<option value="genres/music/desi">Music/Desi</option>
<option value="genres/music/easylisteningsoundtracksandmusicals">Music/Easy Listening, Soundtracks &amp; Musicals</option>
<option value="genres/music/folk">Music/Folk</option>
<option value="genres/music/hiphoprnbanddancehall">Music/Hip Hop, RnB &amp; Dancehall</option>
<option value="genres/music/jazzandblues">Music/Jazz &amp; Blues</option>
<option value="genres/music/popandchart">Music/Pop &amp; Chart</option>
<option value="genres/music/rockandindie">Music/Rock &amp; Indie</option>
<option value="genres/music/soulandreggae">Music/Soul &amp; Reggae</option>
<option value="genres/music/world">Music/World</option>
</optgroup>
<option value="genres/news">News</option>
<option value="formats/readings">Readings</option>
<optgroup label="Sports">
<option value="genres/sport/americanfootball">Sport/American Football</option>
<option value="genres/sport/athletics">Sport/Athletics</option>
<option value="genres/sport/baseball">Sport/Baseball</option>
<option value="genres/sport/basketball">Sport/Basketball</option>
<option value="genres/sport/bobsleigh">Sport/Bobsleigh</option>
<option value="genres/sport/boxing">Sport/Boxing</option>
<option value="genres/sport/commonwealthgames">Sport/Commonwealth Games</option>
<option value="genres/sport/cricket">Sport/Cricket</option>
<option value="genres/sport/cycling">Sport/Cycling</option>
<option value="genres/sport/disabilitysport">Sport/Disability Sport</option>
<option value="genres/sport/football">Sport/Football</option>
<option value="genres/sport/formulaone">Sport/Formula One</option>
<option value="genres/sport/gaelicgames">Sport/Gaelic Games</option>
<option value="genres/sport/golf">Sport/Golf</option>
<option value="genres/sport/gymnastics">Sport/Gymnastics</option>
<option value="genres/sport/hockey">Sport/Hockey</option>
<option value="genres/sport/horseracing">Sport/Horse Racing</option>
<option value="genres/sport/icehockey">Sport/Ice Hockey</option>
<option value="genres/sport/motorsport">Sport/Motorsport</option>
<option value="genres/sport/netball">Sport/Netball</option>
<option value="genres/sport/olympics">Sport/Olympics</option>
<option value="genres/sport/rowing">Sport/Rowing</option>
<option value="genres/sport/rugbyleague">Sport/Rugby League</option>
<option value="genres/sport/rugbyunion">Sport/Rugby Union</option>
<option value="genres/sport/sailing">Sport/Sailing</option>
<option value="genres/sport/shinty">Sport/Shinty</option>
<option value="genres/sport/snooker">Sport/Snooker</option>
<option value="genres/sport/swimming">Sport/Swimming</option>
<option value="genres/sport/synchronisedswimming">Sport/Synchronised Swimming</option>
<option value="genres/sport/tabletennis">Sport/Table Tennis</option>
<option value="genres/sport/taekwondo">Sport/Taekwondo</option>
<option value="genres/sport/tennis">Sport/Tennis</option>
<option value="genres/sport/winterolympics">Sport/Winter Olympics</option>
<option value="genres/sport/wintersports">Sport/Winter Sports</option>
</optgroup>
<option value="genres/weather">Weather</option>
		</select>
		</div>
		</form>
		<div>
			<form id="form2">
				<input id="search" name="search"/>
				<button id="btnSearch" name="Search">Search iPlayer</button>
				<input type="checkbox" id="cbAltSearch" />Alternative Search
			</form>
		</div>
	  <hr width="50%">

	  <table id="tblMain" class="compact nowrap">
	  <thead>
	  <tr><td>PID</td><td>Type</td><td>Title</td></tr>
	  </thead>
	  <tbody>
	  </tbody>
	  </table>

      </section>
    </div>

	<script language="JavaScript" type='text/javascript'>
		$("#aPassHash").colorbox({iframe:true, width:"410", height:"90%"});

		function jAlert(obj) {
			alert(JSON.stringify(obj));
		}
		function domain(){
			return $('input:radio[name=domain]:checked').val();
		}
		function url(){
			var page = $('input:radio[name=page]:checked').val();
			return 'http://www.bbc.co.uk'+domain()+'/programmes/'+$('#category').val()+page+'.json';
		}
		var table;
		$(document).ready(function(){
			table = $('#tblMain').DataTable({
				"stateSave": true,
				"stateDuration": -1,
				"bSort": false,
				//"order": [[ 3, "asc" ]],
				"ajax": {
					url: url(),
					"dataSrc": function(json){
						var result = [];

						var container = {};
						if (json.category_page) {
							container = json.category_page.available_programmes;
						}
						else if (json.category_slice) {
							container = json.category_slice.programmes;
						}
						else if (json.episodes) {
							container = json.episodes;
						}
						else if (json.broadcasts) {
							container = json.broadcasts;
						}
						else if (json.atoz) {
							container = json.atoz.tleo_titles;
						}
						else {
							// searchSuggest results
							container = [];
							for (var i in json[1]) {
								var o = json[1][i];
								for (var t in o.tleo) {
									var tleo = o.tleo[t];
									container.push(tleo);
								}
							}
						}

						var seen = [];

						for (var i in container) {
							var p = container[i];
							if (p.programme) p = p.programme;
							if (seen.indexOf(p.pid)<0) {
								var pid = '<a href="http://bbc.co.uk/programmes/'+p.pid+'">'+p.pid+'</a>';
								var tlink;

								var title = p.title;
								if (p.display_titles) {
									title = p.display_titles.title;
									if (p.display_titles.subtitle) title += ' : ' + p.display_titles.subtitle;
								}

								if (p.type == 'brand' || p.type == 'series') {
									tlink = '<a href="/bbc/children.html?pid='+p.pid+'">'+title+'</a>';
								}
								else {
									tlink = '<a href="/bbc/detail.html?pid='+p.pid+'">'+title+'</a>';
								}
								var row = [pid,p.type,tlink];
								result.push(row);
								seen.push(p.pid);
							}
						}
						return result;
					}
				}
				//,
				//"columns": [
				//	{ "data": "0"},
				//	{ "data": "1"}
				//]
			});
			//table.on('xhr', function() {
			//	var json = table.ajax.json();
			//	jAlert(json);
			//	return {};
			//});
			$('#category').change(function(){
				if (($('#category :selected').text().indexOf('*')>=0) && (domain() == '/radio')) {
					// for films and animation etc switch to TV mode automatically
					$('#rbTv').prop('checked', true);
				}
				$('#search').val('');
				table.ajax.url(url()).load();
			});
			$('input:radio[name=page]').change(function(){
				$('#search').val('');
				table.ajax.url(url()).load();
			});
			$('input:radio[name=domain]').change(function(){
				$('#search').val('');
				table.ajax.url(url()).load();
			});
			$('#btnSearch').click(function(e){
				var searchTerm = encodeURIComponent($('#search').val());
				var pidRegex = /^([0-9,a-d,f-h,j-n,p-t,v-z]){8,}$/;
				if (searchTerm.search(pidRegex)==0) {
					window.location.href = '/bbc/detail.html?pid='+searchTerm;
				}
				else {
					if ($('#cbAltSearch').is(":checked")) {
						var mediatype = (domain() == '' ? 'video' : 'audio');
						table.ajax.url('http://search-suggest.api.bbci.co.uk/search-suggest/suggest?q='+
							searchTerm+'&scope=iplayer&format=bigscreen-2&mediatype='+mediatype+'&mediaset=pc&apikey=sUDquwOAnfNDMeRGWY9vQUuUnsQPRBOA').load();
					}
					else {
						// nb www in the host, AJAX / CORS not following redirect
						table.ajax.url('http://www.bbc.co.uk/programmes/a-z/by/'+searchTerm+'/player.json').load();
					}
				}
				e.preventDefault();
				return false;
			});
			//table.ajax.reload(function(data){
			//	alert('Data returned');
			//});			
		});
		$(document).ajaxError(function(event, jqxhr, settings, thrownError) {
			alert('No data returned: '+thrownError);
			if (table) {
				table.clear().draw();
			}
		});
	</script>

  </body>
</html>
