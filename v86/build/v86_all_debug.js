'use strict';var m,ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function da(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ea=da(this);
function fa(a,b){if(b)a:{var c=ea;a=a.split(".");for(var e=0;e<a.length-1;e++){var d=a[e];if(!(d in c))break a;c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&ba(c,a,{configurable:!0,writable:!0,value:b})}}fa("globalThis",function(a){return a||ea});fa("String.prototype.trimRight",function(a){function b(){return this.replace(/[\s\xa0]+$/,"")}return a||b});
fa("Object.fromEntries",function(a){return a?a:function(b){var c={};if(!(Symbol.iterator in b))throw new TypeError(""+b+" is not iterable");b=b[Symbol.iterator].call(b);for(var e=b.next();!e.done;e=b.next()){e=e.value;if(Object(e)!==e)throw new TypeError("iterable for fromEntries should yield objects");c[e[0]]=e[1]}return c}});
var ia=[[1,""],[2,"CPU"],[32768,"DISK"],[4,"FPU"],[8,"MEM"],[16,"DMA"],[32,"IO"],[64,"PS2"],[128,"PIC"],[256,"VGA"],[512,"PIT"],[1024,"MOUS"],[2048,"PCI"],[4096,"BIOS"],[8192,"FLOP"],[16384,"SERI"],[65536,"RTC"],[131072,"HPET"],[262144,"ACPI"],[524288,"APIC"],[1048576,"NET"],[2097152,"VIO"],[4194304,"9P"],[8388608,"SB16"]];const ja=Object.freeze(["shared","exclusive","unlock"]);
function la(a,b,c){this.h=a;this.A=c;this.C=[104,111,115,116,57,112];this.F=this.C.length;this.D="9P2000.L";this.j=this.B=8192;this.i=new Uint8Array(2*this.j);this.o=0;this.g=[];this.Za=new ma(b,{name:"virtio-9p",Oa:48,Re:4169,nh:9,Pe:{kd:43008,bb:[{wc:32,Sd:0}],features:[0,32,29,28],Ok:()=>{}},notification:{kd:43264,mh:!1,$e:[e=>{if(0!==e)n(!1,"Virtio9P Notified for non-existent queue: "+e+" (expected queue_id of 0)");else{for(;na(this.l);){e=this.l;n(e.h,"VirtQueue addresses must be configured before use");
n(na(e),"VirtQueue must not pop nonexistent request");var d=e.s.ta(e.h+4+2*e.j);r("Pop request: avail_last_idx="+e.j+" desc_idx="+d,2097152);d=new oa(e,d);e.j=e.j+1&e.sd;qa(this,d)}e=this.l;n(!0,"Must skip a non-negative number of requests");d=e.s.ta(e.h+2)+0&65535;e.s.$c(e.g+4+8*e.size,d)}}]},Kc:{kd:42752},mg:{kd:42496,Dd:[{bytes:2,name:"mount tag length",read:()=>this.F,write:()=>{}}].concat(Array.from(Array(254).keys()).map(e=>({bytes:1,name:"mount tag name "+e,read:()=>this.C[e]||0,write:()=>
{}})))}});this.l=this.Za.bb[0]}la.prototype.Y=function(){var a=[];a[0]=this.C;a[1]=this.F;a[2]=this.Za;a[3]=this.D;a[4]=this.B;a[5]=this.j;a[6]=this.i;a[7]=this.o;a[8]=this.g.map(function(b){return[b.Z,b.type,b.uid,b.Ra]});a[9]=this.h;return a};la.prototype.H=function(a){this.C=a[0];this.F=a[1];this.Za.H(a[2]);this.l=this.Za.bb[0];this.D=a[3];this.B=a[4];this.j=a[5];this.i=a[6];this.o=a[7];this.g=a[8].map(function(b){return{Z:b[0],type:b[1],uid:b[2],Ra:b[3]}});this.h.H(a[9])};
function x(a,b,c,e){n(0<=e,"9P: Negative payload size");ra(["w","b","h"],[e+7,b+1,c],a.i,0);e+7>=a.i.length&&B("Error in 9p: payloadsize exceeds maximum length");a.o=e+7}function sa(a,b,c){c=ra(["w"],[c],a.i,7);x(a,6,b,c)}
function C(a,b){n(0<=a.o,"9P: Negative replybuffersize");for(var c=a.i.subarray(0,a.o),e=0,d=c.length;d;){if(b.cg===b.dg.length){r("Device<"+b.Za.name+"> Write more than device-writable capacity",2097152);break}var f=b.dg[b.cg];const k=f.Ke+b.Je;f=f.se-b.Je;f>d?(f=d,b.Je+=d):(b.cg++,b.Je=0);ta(b.s,c.subarray(e,e+f),k);e+=f;d-=f}b.Hf+=e;c=a.l;n(c.g,"VirtQueue addresses must be configured before use");n(c.i<c.size,"VirtQueue replies must not exceed queue size");e=c.s.ta(c.g+2)+c.i&c.sd;r("Push reply: used_idx="+
e+" desc_idx="+b.Ag,2097152);d=b.Hf;c.s.Cb(c.g+4+8*e,b.Ag);c.s.Cb(c.g+8+8*e,d);c.i++;a=a.l;n(a.g,"VirtQueue addresses must be configured before use");0===a.i?r("flush_replies: Nothing to flush",2097152):(r("Flushing "+a.i+" replies",2097152),b=a.s.ta(a.g+2)+a.i&65535,a.s.$c(a.g+2,b),a.i=0,0<(a.Za.h[0]&536870912)?(a.s.ta(a.h+4+2*a.size),a.Za.Da(1)):~a.s.ta(a.h)&1&&a.Za.Da(1))}
async function qa(a,b){var c=new Uint8Array(b.Gf);ua(b,c);var e={offset:0},d=J(["w","b","h"],c,e),f=d[0],k=d[1],l=d[2];switch(k){case 8:f=ya(a.h);c=za(a.h);d=[16914839];d[1]=a.B;d[2]=Math.floor(c/d[1]);d[3]=d[2]-Math.floor(f/d[1]);d[4]=d[2]-Math.floor(f/d[1]);d[5]=Ca(a.h);d[6]=Da(a.h);d[7]=0;d[8]=256;f=ra("wwddddddw".split(""),d,a.i,7);x(a,k,l,f);C(a,b);break;case 112:case 12:d=J(["w","w"],c,e);var p=d[0];e=d[1];B("[open] fid="+p+", mode="+e);c=a.g[p].Z;var q=Ea(a.h,c);B("file open "+a.g[p].Ra);f=
Fa(a.h,c,e);Ha(a.h,a.g[p].Z,function(){B("file opened "+this.g[p].Ra+" tag:"+l);var v=[];v[0]=q.Ca;v[1]=this.j-24;ra(["Q","w"],v,this.i,7);x(this,k,l,17);C(this,b)}.bind(a));break;case 70:d=J(["w","w","s"],c,e);c=d[0];p=d[1];f=d[2];B("[link] dfid="+c+", name="+f);f=Ia(a.h,a.g[c].Z,a.g[p].Z,f);if(0>f){-1!==f&&n(!1,"[link]: Unexpected error code: "+-f);sa(a,l,-f);C(a,b);break}x(a,k,l,0);C(a,b);break;case 16:d=J(["w","s","s","w"],c,e);p=d[0];f=d[1];c=d[2];d=d[3];B("[symlink] fid="+p+", name="+f+", symgt="+
c+", gid="+d);c=Ja(a.h,f,a.g[p].Z,c);q=Ea(a.h,c);q.uid=a.g[p].uid;q.Ma=d;ra(["Q"],[q.Ca],a.i,7);x(a,k,l,13);C(a,b);break;case 18:d=J("wswwww".split(""),c,e);p=d[0];f=d[1];e=d[2];c=d[3];var t=d[4];d=d[5];B("[mknod] fid="+p+", name="+f+", major="+c+", minor="+t);c=La(a.h,f,a.g[p].Z,c,t);q=Ea(a.h,c);q.mode=e;q.uid=a.g[p].uid;q.Ma=d;ra(["Q"],[q.Ca],a.i,7);x(a,k,l,13);C(a,b);break;case 22:d=J(["w"],c,e);p=d[0];q=Ea(a.h,a.g[p].Z);B("[readlink] fid="+p+" name="+a.g[p].Ra+" target="+q.$d);f=ra(["s"],[q.$d],
a.i,7);x(a,k,l,f);C(a,b);break;case 72:d=J(["w","s","w","w"],c,e);p=d[0];f=d[1];e=d[2];d=d[3];B("[mkdir] fid="+p+", name="+f+", mode="+e+", gid="+d);c=Ma(a.h,f,a.g[p].Z);q=Ea(a.h,c);q.mode=e|Na;q.uid=a.g[p].uid;q.Ma=d;ra(["Q"],[q.Ca],a.i,7);x(a,k,l,13);C(a,b);break;case 14:d=J(["w","s","w","w","w"],c,e);p=d[0];f=d[1];c=d[2];e=d[3];d=d[4];a.A.send("9p-create",[f,a.g[p].Z]);B("[create] fid="+p+", name="+f+", flags="+c+", mode="+e+", gid="+d);c=Oa(a.h,f,a.g[p].Z);a.g[p].Z=c;a.g[p].type=1;a.g[p].Ra=f;
q=Ea(a.h,c);q.uid=a.g[p].uid;q.Ma=d;q.mode=e;ra(["Q","w"],[q.Ca,a.j-24],a.i,7);x(a,k,l,17);C(a,b);break;case 52:d=J("wbwddws".split(""),c,e);p=d[0];c=d[2];f=0===d[4]?Infinity:d[4];d=Pa(d[1],d[3],f,d[5],d[6]);B("[lock] fid="+p+", type="+ja[d.type]+", start="+d.start+", length="+d.length+", proc_id="+d.g);f=Qa(a.h,a.g[p].Z,d,c);ra(["b"],[f],a.i,7);x(a,k,l,1);C(a,b);break;case 54:d=J("wbddws".split(""),c,e);p=d[0];f=0===d[3]?Infinity:d[3];d=Pa(d[1],d[2],f,d[4],d[5]);B("[getlock] fid="+p+", type="+ja[d.type]+
", start="+d.start+", length="+d.length+", proc_id="+d.g);f=Ra(a.h,a.g[p].Z,d);f||(f=d,f.type=2);f=ra(["b","d","d","w","s"],[f.type,f.start,Infinity===f.length?0:f.length,f.g,f.h],a.i,7);x(a,k,l,f);C(a,b);break;case 24:d=J(["w","d"],c,e);p=d[0];q=Ea(a.h,a.g[p].Z);B("[getattr]: fid="+p+" name="+a.g[p].Ra+" request mask="+d[1]);if(!q||q.status===Sa){B("getattr: unlinked");sa(a,l,2);C(a,b);break}d[0]|=4096;d[0]=d[1];d[1]=q.Ca;d[2]=q.mode;d[3]=q.uid;d[4]=q.Ma;d[5]=q.wa;d[6]=q.df<<8|q.ff;d[7]=q.size;d[8]=
a.B;d[9]=Math.floor(q.size/512+1);d[10]=q.dd;d[11]=0;d[12]=q.qc;d[13]=0;d[14]=q.Md;d[15]=0;d[16]=0;d[17]=0;d[18]=0;d[19]=0;ra("dQwwwddddddddddddddd".split(""),d,a.i,7);x(a,k,l,153);C(a,b);break;case 26:d=J("wwwwwddddd".split(""),c,e);p=d[0];q=Ea(a.h,a.g[p].Z);B("[setattr]: fid="+p+" request mask="+d[1]+" name="+a.g[p].Ra);d[1]&1&&(q.mode=d[2]);d[1]&2&&(q.uid=d[3]);d[1]&4&&(q.Ma=d[4]);d[1]&16&&(q.dd=Math.floor((new Date).getTime()/1E3));d[1]&32&&(q.qc=Math.floor((new Date).getTime()/1E3));d[1]&64&&
(q.Md=Math.floor((new Date).getTime()/1E3));d[1]&128&&(q.dd=d[6]);d[1]&256&&(q.qc=d[8]);d[1]&8&&await Ta(a.h,a.g[p].Z,d[5]);x(a,k,l,0);C(a,b);break;case 50:d=J(["w","d"],c,e);p=d[0];x(a,k,l,0);C(a,b);break;case 40:case 116:d=J(["w","d","w"],c,e);p=d[0];f=d[1];t=d[2];q=Ea(a.h,a.g[p].Z);40==k&&B("[treaddir]: fid="+p+" offset="+f+" count="+t);116==k&&B("[read]: fid="+p+" ("+a.g[p].Ra+") offset="+f+" count="+t+" fidtype="+a.g[p].type);if(!q||q.status===Sa){B("read/treaddir: unlinked");sa(a,l,2);C(a,b);
break}if(2==a.g[p].type){(void 0).length<f+t&&(t=(void 0).length-f);for(d=0;d<t;d++)a.i[11+d]=(void 0)[f+d];ra(["w"],[t],a.i,7);x(a,k,l,4+t)}else Fa(a.h,a.g[p].Z,void 0),d=a.g[p].Z,t=Math.min(t,a.i.length-11),q.size<f+t?t=q.size-f:40==k&&(t=Ua(a.h,d,f+t)-f),f>q.size&&(t=0),a.A.send("9p-read-start",[a.g[p].Ra]),d=await Va(a.h,d,f,t),a.A.send("9p-read-end",[a.g[p].Ra,t]),d&&a.i.set(d,11),ra(["w"],[t],a.i,7),x(a,k,l,4+t);C(a,b);break;case 118:d=J(["w","d","w"],c,e);p=d[0];f=d[1];t=d[2];d=a.g[p].Ra;B("[write]: fid="+
p+" ("+d+") offset="+f+" count="+t+" fidtype="+a.g[p].type);if(2===a.g[p].type){sa(a,l,95);C(a,b);break}else await Wa(a.h,a.g[p].Z,f,t,c.subarray(e.offset));a.A.send("9p-write-end",[d,t]);ra(["w"],[t],a.i,7);x(a,k,l,4);C(a,b);break;case 74:d=J(["w","s","w","s"],c,e);f=d[0];c=d[1];e=d[2];d=d[3];B("[renameat]: oldname="+c+" newname="+d);f=await Xa(a.h,a.g[f].Z,c,a.g[e].Z,d);if(0>f){-2!==f&&-1!==f&&-39!==f&&n(!1,"[renameat]: Unexpected error code: "+-f);sa(a,l,-f);C(a,b);break}x(a,k,l,0);C(a,b);break;
case 76:d=J(["w","s","w"],c,e);e=d[0];f=d[1];c=d[2];B("[unlink]: dirfd="+e+" name="+f+" flags="+c);p=Ya(a.h,a.g[e].Z,f);if(-1==p){sa(a,l,2);C(a,b);break}f=Za(a.h,a.g[e].Z,f);if(0>f){-39!==f&&-1!==f&&n(!1,"[unlink]: Unexpected error code: "+-f);sa(a,l,-f);C(a,b);break}x(a,k,l,0);C(a,b);break;case 100:d=J(["w","s"],c,e);B("[version]: msize="+d[0]+" version="+d[1]);a.j=d[0];f=ra(["w","s"],[a.j,a.D],a.i,7);x(a,k,l,f);C(a,b);break;case 104:d=J(["w","w","s","s","w"],c,e);p=d[0];f=d[4];B("[attach]: fid="+
p+" afid="+K(d[1])+" uname="+d[2]+" aname="+d[3]);a.g[p]={Z:0,type:1,uid:f,Ra:""};q=Ea(a.h,a.g[p].Z);ra(["Q"],[q.Ca],a.i,7);x(a,k,l,13);C(a,b);a.A.send("9p-attach");break;case 108:d=J(["h"],c,e);B("[flush] "+l);x(a,k,l,0);C(a,b);break;case 110:d=J(["w","w","h"],c,e);p=d[0];t=d[1];var u=d[2];B("[walk]: fid="+d[0]+" nwfid="+d[1]+" nwname="+u);if(0==u){a.g[t]={Z:a.g[p].Z,type:1,uid:a.g[p].uid,Ra:a.g[p].Ra};ra(["h"],[0],a.i,7);x(a,k,l,2);C(a,b);break}f=[];for(d=0;d<u;d++)f.push("s");e=J(f,c,e);c=a.g[p].Z;
f=9;var A=0;B("walk in dir "+a.g[p].Ra+" to: "+e.toString());for(d=0;d<u;d++){c=Ya(a.h,c,e[d]);if(-1==c){B("Could not find: "+e[d]);break}f+=ra(["Q"],[Ea(a.h,c).Ca],a.i,f);A++;a.g[t]={Z:c,type:1,uid:a.g[p].uid,Ra:e[d]}}ra(["h"],[A],a.i,7);x(a,k,l,f-7);C(a,b);break;case 120:d=J(["w"],c,e);B("[clunk]: fid="+d[0]);a.g[d[0]]&&0<=a.g[d[0]].Z&&(await ab(a.h,a.g[d[0]].Z),a.g[d[0]].Z=-1,a.g[d[0]].type=-1);x(a,k,l,0);C(a,b);break;case 32:d=J(["w","s","d","w"],c,e);p=d[0];f=d[1];e=d[2];c=d[3];B("[txattrcreate]: fid="+
p+" name="+f+" attr_size="+e+" flags="+c);a.g[p].type=2;x(a,k,l,0);C(a,b);break;case 30:d=J(["w","w","s"],c,e);p=d[0];f=d[2];B("[xattrwalk]: fid="+d[0]+" newfid="+d[1]+" name="+d[2]);sa(a,l,95);C(a,b);break;default:B("Error in Virtio9p: Unknown id "+k+" received"),bb()}};function cb(a,b){function c(E){E=E.toString(16);return"#"+"0".repeat(6-E.length)+E}function e(E,F,X,aa){E.style.width="";E.style.height="";aa&&(E.style.transform="");var ka=E.getBoundingClientRect();aa?E.style.transform=(1===F?"":" scaleX("+F+")")+(1===X?"":" scaleY("+X+")"):(0===F%1&&0===X%1?(d.style.imageRendering="crisp-edges",d.style.imageRendering="pixelated",d.style["-ms-interpolation-mode"]="nearest-neighbor"):(d.style.Kk="",d.style["-ms-interpolation-mode"]=""),aa=window.devicePixelRatio||
1,0!==aa%1&&(F/=aa,X/=aa));1!==F&&(E.style.width=ka.width*F+"px");1!==X&&(E.style.height=ka.height*X+"px")}console.assert(a,"1st argument must be a DOM container");var d=a.getElementsByTagName("canvas")[0],f=d.getContext("2d",{alpha:!1}),k=a.getElementsByTagName("div")[0],l=document.createElement("div"),p,q,t=1,u=1,A=1,v,w=!1,y,z,D,H=!1,L=this;a=new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,225,237,
243,250,241,209,170,186,191,8976,172,189,188,161,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]);for(var T=new Uint16Array([32,9786,9787,9829,9830,9827,9824,8226,
9688,9675,9689,9794,9792,9834,9835,9788,9658,9668,8597,8252,182,167,9644,8616,8593,8595,8594,8592,8735,8596,9650,9660]),Q=[],I,M=0;256>M;M++)I=127<M?a[M-128]:32>M?T[M]:M,Q[M]=String.fromCharCode(I);f.imageSmoothingEnabled=!1;l.style.position="absolute";l.style.backgroundColor="#ccc";l.style.width="7px";l.style.display="inline-block";k.style.display="block";d.style.display="none";this.A=b;b.register("screen-set-mode",function(E){this.Uf(E)},this);b.register("screen-fill-buffer-end",function(E){this.$f(E)},
this);b.register("screen-put-char",function(E){this.Of(E[0],E[1],E[2],E[3],E[4])},this);b.register("screen-update-cursor",function(E){this.Gd(E[0],E[1])},this);b.register("screen-update-cursor-scanline",function(E){this.Hd(E[0],E[1])},this);b.register("screen-clear",function(){this.jg()},this);b.register("screen-set-size-text",function(E){this.Cd(E[0],E[1])},this);b.register("screen-set-size-graphical",function(E){this.Bd(E[0],E[1],E[2],E[3])},this);this.fb=function(){this.Cd(80,25);this.Bb()};this.Di=
function(){const E=new Image;if(w)E.src=d.toDataURL("image/png");else{const F=[9,16],X=document.createElement("canvas");X.width=z*F[0];X.height=D*F[1];const aa=X.getContext("2d");aa.imageSmoothingEnabled=!1;aa.font=window.getComputedStyle(k).font;aa.textBaseline="top";for(let ka=0;ka<z;ka++)for(let pa=0;pa<D;pa++){const va=3*(pa*z+ka);aa.fillStyle=c(y[va+1]);aa.fillRect(ka*F[0],pa*F[1],F[0],F[1]);aa.fillStyle=c(y[va+2]);aa.fillText(Q[y[va]],ka*F[0],pa*F[1])}"none"!==l.style.display&&(aa.fillStyle=
l.style.backgroundColor,aa.fillRect(q*F[0],p*F[1]+parseInt(l.style.marginTop,10)-1,parseInt(l.style.width,10),parseInt(l.style.height,10)));E.src=X.toDataURL("image/png")}try{window.open("").document.write(E.outerHTML)}catch(F){}};this.Of=function(E,F,X,aa,ka){E<D&&F<z&&(F=3*(E*z+F),n(0<=X&&256>X),y[F]=X,y[F+1]=aa,y[F+2]=ka,v[E]=1)};this.Bb=function(){H||requestAnimationFrame(w?O:U)};var U=function(){for(var E=0;E<D;E++)v[E]&&(L.g(E),v[E]=0);this.Bb()}.bind(this),O=function(){this.A.send("screen-fill-buffer");
this.Bb()}.bind(this);this.va=function(){H=!0};this.Uf=function(E){(w=E)?(k.style.display="none",d.style.display="block"):(k.style.display="block",d.style.display="none")};this.jg=function(){f.fillStyle="#000";f.fillRect(0,0,d.width,d.height)};this.Cd=function(E,F){if(E!==z||F!==D){v=new Int8Array(F);y=new Int32Array(E*F*3);z=E;for(D=F;k.childNodes.length>F;)k.removeChild(k.firstChild);for(;k.childNodes.length<F;)k.appendChild(document.createElement("div"));for(E=0;E<F;E++)this.g(E);e(k,t,u,!0)}};
this.Bd=function(E,F){d.style.display="block";d.width=E;d.height=F;A=640>=E&&2*E<window.innerWidth&&2*E<window.innerHeight?2:1;e(d,t*A,u*A,!1)};this.Vf=function(E,F){t=E;u=F;e(k,t,u,!0);e(d,t*A,u*A,!1)};this.Vf(t,u);this.Hd=function(E,F){E&32?l.style.display="none":(l.style.display="inline",l.style.height=Math.min(15,F-E)+"px",l.style.marginTop=Math.min(15,E)+"px")};this.Gd=function(E,F){if(E!==p||F!==q)v[E]=1,v[p]=1,p=E,q=F};this.g=function(E){var F=3*E*z,X;var aa=k.childNodes[E];var ka=document.createElement("div");
for(var pa=0;pa<z;){var va=document.createElement("span");var qb=y[F+1];var Ka=y[F+2];va.style.backgroundColor=c(qb);va.style.color=c(Ka);for(X="";pa<z&&y[F+1]===qb&&y[F+2]===Ka;){var G=y[F];X+=Q[G];n(Q[G]);pa++;F+=3;if(E===p)if(pa===q)break;else if(pa===q+1){ka.appendChild(l);break}}va.textContent=X;ka.appendChild(va)}aa.parentNode.replaceChild(ka,aa)};this.$f=function(E){E.forEach(F=>{f.putImageData(F.Xb,F.Sf-F.Ne,F.Tf-F.Oe,F.Ne,F.Oe,F.zf,F.yf)})};this.fb()};(function(){function a(){for(var v=location.search.substr(1).split("&"),w={},y=0;y<v.length;y++){var z=v[y].split("=");w[z[0]]=decodeURIComponent(z.slice(1).join("="))}return w}function b(v){document.title=v+" - Virtual x86 - debug";const w=document.querySelector("meta[name=description]");w&&(w.content="Running "+v)}function c(v){return document.getElementById(v)}function e(){function v(I){c("boot_options").style.display="none";b(I.name);z.filesystem=I.filesystem;I.state&&(c("reset").style.display=
"none",z.ld=I.state);z.qa=I.qa;z.ga=I.ga;z.N=I.N;z.Oc=I.Oc;z.Kb=I.Kb;z.md=I.md;z.ed=I.ed;z.Af=I.Af;z.Yb=I.Yb;z.Ld=I.Ld;z.Aa=I.state||void 0===z.Aa?I.Aa:z.Aa;z.G=!I.state&&z.G?z.G:I.G;z.fa=!I.state&&z.fa?z.fa:I.fa;z.id=I.id;void 0!==I.yc&&(z.yc=I.yc);I=parseInt(D.chunk_size,10);0<=I&&(I?(I=Math.min(4194304,Math.max(512,I)),I=1<<Math.ceil(Math.log2(I))):I=void 0,z.N&&(z.N.L=I),z.ga&&(z.ga.L=I));f(z,w)}function w(I){D.c&&setTimeout(function(){db(I,D.c+"\n")},25)}if(window.WebAssembly){var y=document.createElement("script");
y.src="build/xterm.js";y.async=!0;document.body.appendChild(y);var z={};c("start_emulation").onclick=function(){c("boot_options").style.display="none";t("custom");var I=c("floppy_image").files[0];if(I){var M=I;z.qa={buffer:I}}if(I=c("cd_image").files[0])M=I,z.ga={buffer:I};if(I=c("hda_image").files[0])M=I,z.N={buffer:I};if(I=c("hdb_image")&&c("hdb_image").files[0])M=I,z.af={buffer:I};c("multiboot_image")&&(I=c("multiboot_image").files[0])&&(M=I,z.Oc={buffer:I});M&&b(M.name);f(z)};d(z);var D=a();y=
D.cdn||(u?"images/":"//k.copy.sh/");y=[{id:"archlinux",name:"Arch Linux",G:536870912,fa:8388608,state:{url:y+"arch_state.bin.zst"},filesystem:{Me:y+"arch/"}},{id:"archlinux-boot",name:"Arch Linux",G:536870912,fa:8388608,filesystem:{Me:y+"arch/",Oh:{url:y+"fs.json"}},ed:"rw apm=off vga=0x344 video=vesafb:ypan,vremap:8 root=host9p rootfstype=9p rootflags=trans=virtio,cache=loose mitigations=off audit=0 init_on_free=on tsc=reliable random.trust_cpu=on nowatchdog init=/usr/bin/init-openrc net.ifnames=0 biosdevname=0",
Af:!0},{id:"copy/skiffos",name:"SkiffOS",ga:{url:y+"skiffos.iso",size:124672E3,async:!0,L:1048576,da:!u},G:536870912},{id:"serenity",name:"SerenityOS",N:{url:y+"serenity-v3/.img.zst",size:734003200,async:!0,L:1048576,da:!0},G:536870912,state:{url:y+"serenity_state-v4.bin.zst"},na:"https://serenityos.org/",Yb:!0},{id:"serenity-boot",name:"SerenityOS",N:{url:y+"serenity-v3/.img.zst",size:734003200,async:!0,L:1048576,da:!0},G:536870912,na:"https://serenityos.org/"},{id:"redox",name:"Redox",N:{url:y+
"redox_demo_i686_2022-11-26_643_harddrive.img",size:536870912,async:!0,L:1048576,da:!u},G:536870912,state:{url:y+"redox_state.bin.zst"},na:"https://www.redox-os.org/",Aa:!0},{id:"redox-boot",name:"Redox",N:{url:y+"redox_demo_i686_2022-11-26_643_harddrive.img",size:536870912,async:!0,L:1048576,da:!u},G:536870912,na:"https://www.redox-os.org/",Aa:!0},{id:"helenos",G:268435456,ga:{url:y+"HelenOS-0.11.2-ia32.iso",size:25765888,async:!1},name:"HelenOS",na:"http://www.helenos.org/"},{id:"fiwix",G:268435456,
N:{url:y+"fiwixos-doom-3.2-i386.img",size:1073741824,async:!0,L:1048576,da:!u},name:"FiwixOS",na:"https://www.fiwix.org/"},{id:"haiku",G:536870912,N:{url:y+"haiku-v3.img",size:1073741824,async:!0,L:1048576,da:!u},state:{url:y+"haiku_state-v3.bin.zst"},name:"Haiku",na:"https://www.haiku-os.org/"},{id:"haiku-boot",G:536870912,N:{url:y+"haiku-v3.img",size:1073741824,async:!0,L:1048576,da:!u},name:"Haiku",na:"https://www.haiku-os.org/"},{id:"msdos",N:{url:y+"msdos.img",size:8388608,async:!1},yc:306,name:"MS-DOS"},
{id:"freedos",qa:{url:y+"freedos722.img",size:737280,async:!1},name:"FreeDOS"},{id:"psychdos",N:{url:y+"psychdos.img",size:549453824,async:!0,L:262144,da:!u},name:"PsychDOS",na:"https://psychoslinux.gitlab.io/DOS/INDEX.HTM"},{id:"oberon",N:{url:y+"oberon.img",size:25165824,async:!1},name:"Oberon"},{id:"windows1",qa:{url:y+"windows101.img",size:1474560,async:!1},name:"Windows"},{id:"linux26",ga:{url:y+"linux.iso",size:6547456,async:!1},name:"Linux"},{id:"linux3",ga:{url:y+"linux3.iso",size:8624128,
async:!1},name:"Linux"},{id:"linux4",ga:{url:y+"linux4.iso",size:7731200,async:!1},name:"Linux",filesystem:{}},{id:"buildroot",Kb:{url:y+"buildroot-bzimage.bin",size:5166352,async:!1},name:"Buildroot Linux",filesystem:{},ed:"tsc=reliable mitigations=off random.trust_cpu=on"},{id:"nodeos",Kb:{url:y+"nodeos-kernel.bin",size:14452E3,async:!1},name:"NodeOS",ed:"tsc=reliable mitigations=off random.trust_cpu=on"},{id:"dsl",G:268435456,ga:{url:y+"dsl-4.11.rc2.iso",size:52824064,async:!1},name:"Damn Small Linux",
na:"http://www.damnsmalllinux.org/"},{id:"minix",name:"Minix",G:268435456,ga:{url:y+"minix-3.3.0.iso",size:605581312,async:!0,L:1048576,da:!u},na:"https://www.minix3.org/"},{id:"kolibrios",qa:{url:u?y+"kolibri.img":"//builds.kolibrios.org/eng/data/data/kolibri.img",size:1474560,async:!1},name:"KolibriOS",na:"https://kolibrios.org/en/"},{id:"kolibrios-fallback",qa:{url:y+"kolibri.img",size:1474560,async:!1},name:"KolibriOS"},{id:"openbsd",N:{url:y+"openbsd.img",size:1073741824,async:!0,L:1048576,da:!u},
state:{url:y+"openbsd_state.bin.zst"},G:268435456,name:"OpenBSD"},{id:"openbsd-boot",N:{url:y+"openbsd.img",size:1073741824,async:!0,L:1048576,da:!u},G:268435456,name:"OpenBSD"},{id:"netbsd",N:{url:y+"netbsd.img",size:511000064,async:!0,L:1048576,da:!u},G:268435456,name:"NetBSD"},{id:"solos",qa:{url:y+"os8.img",async:!1,size:1474560},name:"Sol OS",na:"http://oby.ro/os/"},{id:"bootchess",qa:{url:y+"bootchess.img",async:!1,size:1474560},name:"BootChess",na:"http://www.pouet.net/prod.php?which=64962"},
{id:"bootbasic",qa:{url:y+"bootbasic.img",async:!1,size:1474560},name:"bootBASIC",na:"https://github.com/nanochess/bootBASIC"},{id:"sectorlisp",qa:{url:y+"sectorlisp-friendly.bin",async:!1,size:512},name:"SectorLISP",na:"https://justine.lol/sectorlisp2/"},{id:"sectorforth",qa:{url:y+"sectorforth.img",async:!1,size:512},name:"sectorforth",na:"https://github.com/cesarblum/sectorforth"},{id:"floppybird",qa:{url:y+"floppybird.img",async:!1,size:1474560},name:"Floppy Bird",na:"http://mihail.co/floppybird"},
{id:"windows2000",G:536870912,N:{url:y+"windows2k.img",size:2147483648,async:!0,L:262144,da:!u},name:"Windows 2000",state:{url:y+"windows2k_state-v2.bin.zst"},Yb:!0},{id:"windows2000-boot",G:536870912,N:{url:y+"windows2k.img",size:2147483648,async:!0,L:262144,da:!u},yc:306,name:"Windows 2000"},{id:"windowsnt4",G:536870912,N:{url:y+"winnt4_noacpi.img",size:523837440,async:!0,L:262144,da:!u},name:"Windows NT 4.0",Ld:2},{id:"windowsnt3",G:268435456,N:{url:y+"winnt31.img",size:91226112,async:!0,L:262144,
da:!u},name:"Windows NT 3.1"},{id:"windows98",G:134217728,N:{url:y+"windows98.img",size:314572800,async:!0,L:262144,da:!u},name:"Windows 98",state:{url:y+"windows98_state.bin.zst"},Yb:!0},{id:"windows98-boot",G:134217728,N:{url:y+"windows98.img",size:314572800,async:!0,L:262144,da:!u},name:"Windows 98"},{id:"windows95",G:33554432,N:{url:y+"w95.img",size:242049024,async:!0,L:262144,da:!u},name:"Windows 95",state:{url:y+"windows95_state.bin.zst"}},{id:"windows95-boot",G:33554432,N:{url:y+"w95.img",
size:242049024,async:!0,L:262144,da:!u},name:"Windows 95"},{id:"windows30",G:67108864,ga:{url:y+"Win30.iso",async:!1},name:"Windows 3.0"},{id:"windows31",G:67108864,N:{url:y+"win31.img",async:!1,size:34463744},name:"Windows 3.1"},{id:"freebsd",G:268435456,N:{url:y+"freebsd.img",size:2147483648,async:!0,L:1048576,da:!u},state:{url:y+"freebsd_state.bin.zst"},name:"FreeBSD"},{id:"freebsd-boot",G:268435456,N:{url:y+"freebsd.img",size:2147483648,async:!0,L:1048576,da:!u},name:"FreeBSD"},{id:"reactos-livecd",
G:268435456,N:{url:y+"reactos-livecd-0.4.15-dev-73-g03c09c9-x86-gcc-lin-dbg.iso",size:250609664,async:!0,L:1048576,da:!u},name:"ReactOS",na:"https://reactos.org/"},{id:"reactos",G:536870912,N:{url:y+"reactos.img",size:524288E3,async:!0,L:1048576,da:!u},state:{url:y+"reactos_state.bin.zst"},Yb:!0,name:"ReactOS",na:"https://reactos.org/"},{id:"reactos-boot",G:536870912,N:{url:y+"reactos.img",size:524288E3,async:!0,L:1048576,da:!u},name:"ReactOS",na:"https://reactos.org/"},{id:"skift",ga:{url:y+"skift-20200910.iso",
size:64452608,async:!1},name:"Skift",na:"https://skiftos.org/"},{id:"snowdrop",qa:{url:y+"snowdrop.img",size:1474560,async:!1},name:"Snowdrop",na:"http://www.sebastianmihai.com/snowdrop/"},{id:"openwrt",N:{url:y+"openwrt-18.06.1-x86-legacy-combined-squashfs.img",size:19846474,async:!1},name:"OpenWrt"},{id:"qnx",qa:{url:y+"qnx-demo-network-4.05.img",size:1474560,async:!1},name:"QNX 4.05"},{id:"9front",G:134217728,N:{url:y+"9front-8963.f84cf1e60427675514fb056cc1723e45da01e043.386.iso",size:477452288,
async:!0,L:1048576,da:!u},state:{url:y+"9front_state-v2.bin.zst"},Aa:!0,name:"9front",na:"https://9front.org/"},{id:"9front-boot",G:134217728,N:{url:y+"9front-8963.f84cf1e60427675514fb056cc1723e45da01e043.386.iso",size:477452288,async:!0,L:1048576,da:!u},Aa:!0,name:"9front",na:"https://9front.org/"},{id:"mobius",qa:{url:y+"mobius-fd-release5.img",size:1474560,async:!1},name:"Mobius"},{id:"android",G:536870912,ga:{url:y+"android-x86-1.6-r2.iso",size:54661120,async:!0,L:1048576,da:!u},name:"Android"},
{id:"android4",G:536870912,ga:{url:y+"android_x86_nonsse3_4.4r1_20140904.iso",size:247463936,async:!0,L:1048576,da:!u},name:"Android"},{id:"tinycore",G:268435456,N:{url:y+"TinyCore-11.0.iso",async:!1},name:"Tinycore",na:"http://www.tinycorelinux.net/"},{id:"freenos",G:268435456,ga:{url:y+"FreeNOS-1.0.3.iso",async:!1,size:11014144},name:"FreeNOS",Aa:!0,na:"http://www.freenos.org/"}];var H="realmode cmpxchg8b port80 setjmp sieve hypercall init msr smap tsc_adjust tsc rmap_chain memory taskswitch taskswitch2 eventinj ioapic apic".split(" ");
for(var L of H)y.push({name:"Test case: "+L,id:"test-"+L,G:134217728,Oc:{url:"tests/kvm-unit-tests/x86/"+L+".flat"}});var T=D.profile;D.use_bochs_bios&&(z.rk=!0);L=parseInt(D.m,10);0<L&&(z.G=1048576*Math.max(16,L));L=parseInt(D.vram,10);0<L&&(z.fa=1048576*L);z.Ig=D.networking_proxy;z.audio="0"!==D.audio;z.Aa=D.acpi;for(L=0;L<y.length;L++){H=y[L];if(T===H.id){v(H);return}var Q=c("start_"+H.id);Q&&(Q.onclick=function(I,M,U){U.preventDefault();t(I.id);M.blur();v(I)}.bind(this,H,Q))}if("custom"===T){if(D["hda.url"]&&
(z.N={size:parseInt(D["hda.size"],10)||void 0,url:D["hda.url"],async:!0}),D["cdrom.url"]&&(z.ga={size:parseInt(D["cdrom.size"],10)||void 0,url:D["cdrom.url"],async:!0}),D["fda.url"]&&(z.qa={size:parseInt(D["fda.size"],10)||void 0,url:D["fda.url"],async:!1}),z.qa||z.ga||z.N)c("boot_options").style.display="none",f(z,w)}else if(/^[a-zA-Z0-9\-_]+\/[a-zA-Z0-9\-_]+$/g.test(T)){const I="https://v86-user-images.b-cdn.net/"+T;fetch(I+"/profile.json").then(M=>M.json()).then(M=>{function U(O){return O&&{url:I+
"/"+O.url,async:O.async,size:O.size}}v({id:M.id,name:M.name,G:M.memory_size,fa:M.vga_memory_size,Aa:M.acpi,yc:M.boot_order,N:U(M.hda),ga:U(M.cdrom),qa:U(M.fda),Oc:U(M.multiboot),Kb:U(M.bzimage),md:U(M.initrd)})}).catch(()=>alert("Profile not found: "+T))}}else alert("Your browser is not supported because it doesn't support WebAssembly")}function d(){var v=c("log_levels");if(v){for(var w=0;w<ia.length;w++){var y=ia[w][0];if(1!==y){var z=ia[w][1].toLowerCase(),D=document.createElement("input"),H=document.createElement("label");
D.type="checkbox";H.htmlFor=D.id="log_"+z;eb&y&&(D.checked=!0);D.sd=y;H.appendChild(D);H.appendChild(document.createTextNode(fb(z,4)+" "));v.appendChild(H);w===Math.floor(ia.length/2)&&v.appendChild(document.createTextNode("\n"))}}v.onchange=function(L){L=L.target;var T=L.sd;eb=L.checked?eb|T:eb&~T;L.blur()}}}function f(v,w){var y=v.G;y||(y=1048576*parseInt(c("memory_size").value,10),y||(alert("Invalid memory size - reset to 128MB"),y=134217728));var z=v.fa;z||(z=1048576*parseInt(c("video_memory_size").value,
10),z||(alert("Invalid video memory size - reset to 8MB"),z=8388608));if(!v.qa){var D=c("floppy_image").files[0];D&&(v.qa={buffer:D})}!v.Kb&&(D=c("bzimage").files[0])&&(v.Kb={buffer:D});!v.md&&(D=c("initrd").files[0])&&(v.md={buffer:D});D=void 0===v.Ig?c("networking_proxy").value:v.Ig;const H=void 0===v.audio?c("disable_audio").checked:!v.audio,L=void 0===v.Aa?c("enable_acpi").checked:v.Aa;if(v.rk)var T="bochs-bios.bin",Q="bochs-vgabios.bin";else T="seabios-debug.bin",Q="vgabios-debug.bin";if(!v.ld){var I=
{url:"bios/"+T};var M={url:"bios/"+Q}}var U=new gb({memory_size:y,vga_memory_size:z,screen_container:c("screen_container"),serial_container_xtermjs:c("terminal"),boot_order:v.yc||parseInt(c("boot_order").value,16)||0,network_relay_url:u?"ws://localhost:8080/":D,bios:I,vga_bios:M,fda:v.qa,hda:v.N,hdb:v.af,cdrom:v.ga,multiboot:v.Oc,bzimage:v.Kb,initrd:v.md,cmdline:v.ed,bzimage_initrd_from_filesystem:v.Af,acpi:L,initial_state:v.ld,filesystem:v.filesystem||{},disable_speaker:H,mac_address_translation:v.Yb,
cpuid_level:v.Ld,autostart:!0});window.emulator=U;hb(U,"emulator-ready",function(){p(U);if(U.sb.s.za.exports.profiler_is_enabled()){var O=document.createElement("pre");document.body.appendChild(O);setInterval(function(){if(U.od()){var E=ib.pk(U.sb.s);O.textContent=E}},1E3)}"dsl"===v.id||"helenos"===v.id?setTimeout(()=>{db(U,"\n")},3E3):("android"===v.id||"android4"===v.id)&&setTimeout(()=>{jb(U,[57424,57552]);db(U,"\n")},3E3);k(v,U);w&&w(U)});hb(U,"download-progress",function(O){var E=c("loading");
E.style.display="block";if(O.qe.endsWith(".wasm")){var F=O.qe.split("/");E.textContent="Fetching "+F[F.length-1]+" ..."}else if(O.pe===O.oe-1&&O.loaded>=O.total-2048)E.textContent="Done downloading. Starting now ...";else{F="Downloading images ";"number"===typeof O.pe&&O.oe&&(F+="["+(O.pe+1)+"/"+O.oe+"] ");if(O.total&&"number"===typeof O.loaded){O=Math.floor(O.loaded/O.total*100);O=Math.min(100,Math.max(0,O));var X=Math.floor(O/2);F=F+(O+"% [")+"#".repeat(X);F+=" ".repeat(50-X)+"]"}else F+=".".repeat(A++%
50);E.textContent=F}});hb(U,"download-error",function(O){var E=c("loading");E.style.display="block";E.textContent="Loading "+O.qe+" failed. Check your connection and reload the page to try again."})}function k(v,w){function y(){var G=Date.now(),ca=w.sb?w.sb.s.zi[0]>>>0:0;ca<Q&&(Q-=4294967296);var Y=ca-Q;Q=ca;U+=Y;if(ca=G-L)T+=ca,L=G,c("speed").textContent=(Y/1E3/ca).toFixed(1),c("avg_speed").textContent=(U/1E3/T).toFixed(1),G=c("running_time"),Y=T/1E3|0,G.textContent=60>Y?Y+"s":3600>Y?(Y/60|0)+"m "+
kb(Y%60,2)+"s":(Y/3600|0)+"h "+kb((Y/60|0)%60,2)+"m "+kb(Y%60,2)+"s"}function z(G,ca){var Y=c("get_"+ca+"_image");!G||104857600<G.size?Y.style.display="none":Y.onclick=function(){var ha=w.lc[ca];let wa=ha.file&&ha.file.name||v.id+("cdrom"===ca?".iso":".img");ha.zg?(ha=ha.zg(wa),lb(ha,wa)):ha.yb(function($a){$a?mb($a,wa):alert("The file could not be loaded. Maybe it's too big?")});Y.blur()}}function D(G){G.ctrlKey?window.onbeforeunload=function(){window.onbeforeunload=null;return"CTRL-W cannot be sent to the emulator."}:
window.onbeforeunload=null}c("boot_options").style.display="none";c("loading").style.display="none";c("runtime_options").style.display="block";c("runtime_infos").style.display="block";c("screen_container").style.display="block";v.filesystem?l(w):hb(w,"9p-attach",function(){l(w)});c("run").onclick=function(){w.od()?(c("run").value="Run",w.stop()):(c("run").value="Pause",w.sf());c("run").blur()};c("exit").onclick=function(){w.stop();location.href=location.pathname};c("lock_mouse").onclick=function(){if(!H)c("toggle_mouse").onclick();
nb();c("lock_mouse").blur()};var H=!0;c("toggle_mouse").onclick=function(){H=!H;w.l&&(w.l.We=H);c("toggle_mouse").value=(H?"Dis":"En")+"able mouse";c("toggle_mouse").blur()};var L=0,T=0,Q=0,I=null,M=!1,U=0;hb(w,"emulator-started",function(){L=Date.now();I=setInterval(y,1E3)});hb(w,"emulator-stopped",function(){y();null!==I&&clearInterval(I)});var O=0,E=0,F=[];hb(w,"9p-read-start",function(G){G=G[0];F.push(G);c("info_filesystem").style.display="block";c("info_filesystem_status").textContent="Loading ...";
c("info_filesystem_last_file").textContent=G});hb(w,"9p-read-end",function(G){O+=G[1];c("info_filesystem_bytes_read").textContent=O;const ca=G[0];F=F.filter(Y=>Y!==ca);F[0]?c("info_filesystem_last_file").textContent=F[0]:c("info_filesystem_status").textContent="Idle"});hb(w,"9p-write-end",function(G){E+=G[1];c("info_filesystem_bytes_written").textContent=E;F[0]||(c("info_filesystem_last_file").textContent=G[0])});var X=0,aa=0,ka=0,pa=0;hb(w,"ide-read-start",function(){c("info_storage").style.display=
"block";c("info_storage_status").textContent="Loading ..."});hb(w,"ide-read-end",function(G){X+=G[1];aa+=G[2];c("info_storage_status").textContent="Idle";c("info_storage_bytes_read").textContent=X;c("info_storage_sectors_read").textContent=aa});hb(w,"ide-write-end",function(G){ka+=G[1];pa+=G[2];c("info_storage_bytes_written").textContent=ka;c("info_storage_sectors_written").textContent=pa});var va=0,qb=0;hb(w,"eth-receive-end",function(G){qb+=G[0];c("info_network").style.display="block";c("info_network_bytes_received").textContent=
qb});hb(w,"eth-transmit-end",function(G){va+=G[0];c("info_network").style.display="block";c("info_network_bytes_transmitted").textContent=va});hb(w,"mouse-enable",function(G){M=G;c("info_mouse_enabled").textContent=G?"Yes":"No"});hb(w,"screen-set-mode",function(G){G?c("info_vga_mode").textContent="Graphical":(c("info_vga_mode").textContent="Text",c("info_res").textContent="-",c("info_bpp").textContent="-")});hb(w,"screen-set-size-graphical",function(G){c("info_res").textContent=G[0]+"x"+G[1];c("info_bpp").textContent=
G[4]});c("reset").onclick=function(){w.Qf();c("reset").blur()};z(v.N,"hda");z(v.af,"hdb");z(v.qa,"fda");z(v.tg,"fdb");z(v.ga,"cdrom");c("memory_dump").onclick=function(){const G=w.sb.s.Na;mb(new Uint8Array(G.buffer,G.byteOffset,G.length),"v86memory.bin");c("memory_dump").blur()};c("capture_network_traffic").onclick=function(){function G(Y,ha){var wa=ca,$a=wa.push,nf=performance.now()/1E3;const tc=[];let xa=0;for(;xa+15<ha.length;xa+=16){var Aa=kb(xa.toString(16).toUpperCase(),5)+"   ";for(var Ba=
0;16>Ba;Ba++)Aa+=kb(ha[xa+Ba].toString(16).toUpperCase(),2)+" ";Aa+="  ";for(Ba=0;16>Ba;Ba++){var Ga=ha[xa+Ba];Aa+=33<=Ga&&34!==Ga&&92!==Ga&&126>=Ga?String.fromCharCode(Ga):"."}tc.push(Aa)}for(Aa=kb(xa.toString(16).toUpperCase(),5)+"   ";xa<ha.length;xa++)Aa+=kb(ha[xa].toString(16).toUpperCase(),2)+" ";Ba=xa&15;Aa+="   ".repeat(16-Ba);Aa+="  ";for(Ga=0;Ga<Ba;Ga++){const sb=ha[xa+Ga];Aa+=33<=sb&&34!==sb&&92!==sb&&126>=sb?String.fromCharCode(sb):"."}tc.push(Aa);$a.call(wa,{direction:Y,time:nf,xi:"\n"+
tc.join("\n")+"\n"});c("capture_network_traffic").value=ca.length+" packets"}this.value="0 packets";let ca=[];w.Od.register("net0-receive",G.bind(this,"I"));hb(w,"net0-send",G.bind(this,"O"));this.onclick=function(){const Y=ca.map(({direction:ha,time:wa,xi:$a})=>ha+" "+wa.toFixed(6)+$a+"\n").join("");mb(Y,"traffic.hex");ca=[];this.value="0 packets"}};c("save_state").onclick=async function(){const G=await w.Ce();mb(G,"v86state.bin");c("save_state").blur()};c("load_state").onclick=function(){c("load_state_input").click();
c("load_state").blur()};c("load_state_input").onchange=async function(){var G=this.files[0];if(G){var ca=w.od();ca&&await w.stop();var Y=new FileReader;Y.onload=async function(ha){try{await w.Vd(ha.target.result)}catch(wa){throw alert("Something bad happened while restoring the state:\n"+wa+"\n\nNote that the current configuration must be the same as the original"),wa;}ca&&w.sf()};Y.readAsArrayBuffer(G);this.value=""}};c("ctrlaltdel").onclick=function(){jb(w,[29,56,83,157,184,211]);c("ctrlaltdel").blur()};
c("alttab").onclick=function(){jb(w,[56,15]);setTimeout(function(){jb(w,[184,143])},100);c("alttab").blur()};c("scale").onchange=function(){var G=parseFloat(this.value);(G||0<G)&&w.g&&w.g.Vf(G,G)};c("fullscreen").onclick=function(){if(w.g){var G=document.getElementById("screen_container");if(G){var ca=G.requestFullScreen||G.webkitRequestFullscreen||G.mozRequestFullScreen||G.msRequestFullScreen;ca&&(ca.call(G),(G=document.getElementsByClassName("phone_keyboard")[0])&&G.focus());try{navigator.keyboard.lock()}catch(Y){}nb()}}};
c("screen_container").onclick=function(){if(H&&M)nb(),c("lock_mouse").blur();else if(window.getSelection().isCollapsed){let G=document.getElementsByClassName("phone_keyboard")[0];G.style.top=document.body.scrollTop+100+"px";G.style.left=document.body.scrollLeft+100+"px";G.focus()}};const Ka=document.getElementsByClassName("phone_keyboard")[0];Ka.setAttribute("autocorrect","off");Ka.setAttribute("autocapitalize","off");Ka.setAttribute("spellcheck","false");Ka.tabIndex=0;c("screen_container").addEventListener("mousedown",
()=>{Ka.focus()},!1);c("take_screenshot").onclick=function(){w.g&&w.g.Di();c("take_screenshot").blur()};if(w.i){let G=!1;c("mute").onclick=function(){G?(w.i.gf.uf(1,void 0),G=!1,c("mute").value="Mute"):(w.i.gf.uf(0,void 0),G=!0,c("mute").value="Unmute");c("mute").blur()}}else c("mute").remove();window.addEventListener("keydown",D,!1);window.addEventListener("keyup",D,!1);window.addEventListener("blur",D,!1)}function l(v){c("filesystem_panel").style.display="block";c("filesystem_send_file").onchange=
function(){Array.prototype.forEach.call(this.files,function(w){var y=new ob(w);y.onload=function(){y.yb(async function(z){await v.Wh("/"+w.name,new Uint8Array(z))})};y.load()},this);this.value="";this.blur()};c("filesystem_get_file").onkeypress=async function(w){if(13===w.which){this.disabled=!0;try{var y=await v.Be(this.value)}catch(z){console.log(z)}this.disabled=!1;y?(w=this.value.replace(/\/$/,"").split("/"),w=w[w.length-1]||"root",mb(y,w),this.value=""):alert("Can't read file")}}}function p(v){if(v.sb){var w=
v.sb.s.debug;c("dump_gdt").onclick=w.fi.bind(w);c("dump_idt").onclick=w.gi.bind(w);c("dump_regs").onclick=w.sg.bind(w);c("dump_pt").onclick=w.hi.bind(w);c("dump_log").onclick=function(){mb(pb.join(""),"v86.log")};var y=v.sb.s;c("debug_panel").style.display="block";setInterval(function(){c("debug_panel").textContent=y.debug.ri().join("\n")+"\n"+y.debug.Y();c("dump_log").value="Dump log"+(pb.length?" ("+pb.length+" lines)":"")},1E3);window.h=v;window.s=y;window.g=mb}}function q(){location.reload()}
function t(v){window.history.pushState&&window.history.pushState({profile:v},"","?profile="+v)}var u=!location.hostname.endsWith("copy.sh"),A=0;window.addEventListener("load",e,!1);window.addEventListener("load",function(){setTimeout(function(){window.addEventListener("popstate",q)},0)});"complete"===document.readyState&&e()})();var eb=-15786961;function rb(a){this.ports=[];this.s=a;for(var b=0;65536>b;b++)this.ports[b]=tb(this);var c=a.G[0];for(b=0;b<<17<c;b++)a.l[b]=a.we[b]=void 0,a.Fb[b]=a.ve[b]=void 0;ub(this,c,4294967296-c,function(e){r("Read from unmapped memory space, addr="+K(e>>>0,8),32);return 255},function(e,d){r("Write to unmapped memory space, addr="+K(e>>>0,8)+" value="+K(d,2),32)},function(e){r("Read from unmapped memory space, addr="+K(e>>>0,8),32);return-1},function(e,d){r("Write to unmapped memory space, addr="+K(e>>>0,
8)+" value="+K(d>>>0,8),32)})}function tb(a){return{Ia:a.Ve,ta:a.Te,Wc:a.Ue,Jd:a.nb,$c:a.nb,Cb:a.nb,pa:void 0}}m=rb.prototype;m.Ve=function(){return 255};m.Te=function(){return 65535};m.Ue=function(){return-1};m.nb=function(){};
function N(a,b,c,e,d,f){function k(l){n(!1,"Overlapped read"+l+" "+K(b,4)+" ("+c.name+")");return-1>>>32-l|0}n("number"===typeof b);n("object"===typeof c);n(!e||"function"===typeof e);n(!d||"function"===typeof d);n(!f||"function"===typeof f);n(e||d||f);e||(e=k.bind(a,8));d||(d=k.bind(a,16));f||(f=k.bind(a,32));e&&(a.ports[b].Ia=e);d&&(a.ports[b].ta=d);f&&(a.ports[b].Wc=f);a.ports[b].pa=c}
function P(a,b,c,e,d,f){function k(l){n(!1,"Overlapped write"+l+" "+K(b)+" ("+c.name+")")}n("number"===typeof b);n("object"===typeof c);n(!e||"function"===typeof e);n(!d||"function"===typeof d);n(!f||"function"===typeof f);n(e||d||f);e||(e=k.bind(a,8));d||(d=k.bind(a,16));f||(f=k.bind(a,32));e&&(a.ports[b].Jd=e);d&&(a.ports[b].$c=d);f&&(a.ports[b].Cb=f);a.ports[b].pa=c}
m.Ad=function(a,b,c,e,d,f){function k(){return c.call(this)|e.call(this)<<8}function l(){return d.call(this)|f.call(this)<<8}function p(){return c.call(this)|e.call(this)<<8|d.call(this)<<16|f.call(this)<<24}n(4===arguments.length||6===arguments.length);d&&f?(N(this,a,b,c,k,p),N(this,a+1,b,e),N(this,a+2,b,d,l),N(this,a+3,b,f)):(N(this,a,b,c,k),N(this,a+1,b,e))};
m.ac=function(a,b,c,e,d,f){function k(q){c.call(this,q&255);e.call(this,q>>8&255)}function l(q){d.call(this,q&255);f.call(this,q>>8&255)}function p(q){c.call(this,q&255);e.call(this,q>>8&255);d.call(this,q>>16&255);f.call(this,q>>>24)}n(4===arguments.length||6===arguments.length);d&&f?(P(this,a,b,c,k,p),P(this,a+1,b,e),P(this,a+2,b,d,l),P(this,a+3,b,f)):(P(this,a,b,c,k),P(this,a+1,b,e))};m.Ei=function(a){var b=this.s.l[a>>>17];return b(a)|b(a+1)<<8|b(a+2)<<16|b(a+3)<<24};
m.Fi=function(a,b){var c=this.s.we[a>>>17];c(a,b&255);c(a+1,b>>8&255);c(a+2,b>>16&255);c(a+3,b>>>24)};function ub(a,b,c,e,d,f,k){r("mmap_register addr="+K(b>>>0,8)+" size="+K(c,8),32);n(0===(b&131071));n(c&&0===(c&131071));f||(f=a.Ei.bind(a));k||(k=a.Fi.bind(a));for(b>>>=17;0<c;b++)a.s.l[b]=e,a.s.we[b]=d,a.s.Fb[b]=f,a.s.ve[b]=k,c-=131072}
var vb={4:"PORT_DMA_ADDR_2",5:"PORT_DMA_CNT_2",10:"PORT_DMA1_MASK_REG",11:"PORT_DMA1_MODE_REG",12:"PORT_DMA1_CLEAR_FF_REG",13:"PORT_DMA1_MASTER_CLEAR",32:"PORT_PIC1_CMD",33:"PORT_PIC1_DATA",64:"PORT_PIT_COUNTER0",65:"PORT_PIT_COUNTER1",66:"PORT_PIT_COUNTER2",67:"PORT_PIT_MODE",96:"PORT_PS2_DATA",97:"PORT_PS2_CTRLB",100:"PORT_PS2_STATUS",112:"PORT_CMOS_INDEX",113:"PORT_CMOS_DATA",128:"PORT_DIAG",129:"PORT_DMA_PAGE_2",146:"PORT_A20",160:"PORT_PIC2_CMD",161:"PORT_PIC2_DATA",178:"PORT_SMI_CMD",179:"PORT_SMI_STATUS",
212:"PORT_DMA2_MASK_REG",214:"PORT_DMA2_MODE_REG",218:"PORT_DMA2_MASTER_CLEAR",240:"PORT_MATH_CLEAR",368:"PORT_ATA2_CMD_BASE",496:"PORT_ATA1_CMD_BASE",632:"PORT_LPT2",744:"PORT_SERIAL4",760:"PORT_SERIAL2",884:"PORT_ATA2_CTRL_BASE",888:"PORT_LPT1",1E3:"PORT_SERIAL3",1008:"PORT_FD_BASE",1010:"PORT_FD_DOR",1012:"PORT_FD_STATUS",1013:"PORT_FD_DATA",1014:"PORT_HD_DATA",1015:"PORT_FD_DIR",1016:"PORT_SERIAL1",3320:"PORT_PCI_CMD",3321:"PORT_PCI_REBOOT",3324:"PORT_PCI_DATA",1026:"PORT_BIOS_DEBUG",1296:"PORT_QEMU_CFG_CTL",
1297:"PORT_QEMU_CFG_DATA",45056:"PORT_ACPI_PM_BASE",45312:"PORT_SMB_BASE",35072:"PORT_BIOS_APM"};function wb(a){return vb[a]?"  ("+vb[a]+")":""};function xb(a,b){this.i=this.g=!1;this.j=0;this.h=null;this.s=new yb(a,b,()=>{this.C&&zb(this,0)});this.A=a;a.register("cpu-init",this.fb,this);a.register("cpu-run",this.sf,this);a.register("cpu-stop",this.stop,this);a.register("cpu-restart",this.Qf,this);this.l()}m=xb.prototype;m.sf=function(){this.i=!1;this.g||(this.g=!0,this.A.send("emulator-started"));zb(this,0)};
function Ab(a){if(a.i||!a.g)a.i=a.g=!1,a.A.send("emulator-stopped");else{a.C=!1;a:{var b=a.s;if(b.j[0]){var c=Bb(b);if(b.j[0]){b=c;break a}}for(var e=c=Cb();1>e-c;){e=b;var d=Cb();e.yk();e.Cf+=Cb()-d;e.rg++;e=Cb();d=Db(b,e);Eb(b);if(b.j[0]){b=d;break a}}b=0}zb(a,b)}}function zb(a,b){const c=++a.j;a.C=!0;a.B(b,c)}m.stop=function(){this.g&&(this.i=!0)};m.va=function(){this.o()};m.Qf=function(){this.s.Gb();Fb(this.s)};m.fb=function(a){this.s.fb(a,this.A);this.A.send("emulator-ready")};
if("undefined"!==typeof process)xb.prototype.B=function(a,b){1>a?global.setImmediate(c=>{c===this.j&&Ab(this)},b):setTimeout(c=>{c===this.j&&Ab(this)},a,b)},xb.prototype.l=function(){},xb.prototype.o=function(){};else if("undefined"!==typeof Worker){function a(){globalThis.onmessage=function(b){const c=b.data.t;1>c?postMessage(b.data.ph):setTimeout(()=>postMessage(b.data.ph),c)}}xb.prototype.l=function(){const b=URL.createObjectURL(new Blob(["("+a.toString()+")()"],{type:"text/javascript"}));this.h=
new Worker(b);this.h.onmessage=c=>{c.data===this.j&&Ab(this)};URL.revokeObjectURL(b)};xb.prototype.B=function(b,c){this.h.postMessage({t:b,ph:c})};xb.prototype.o=function(){this.h.terminate();this.h=null}}else xb.prototype.B=function(a){setTimeout(()=>{Ab(this)},a)},xb.prototype.l=function(){},xb.prototype.o=function(){};xb.prototype.Ce=function(){return this.s.Ce()};xb.prototype.Vd=function(a){return this.s.Vd(a)};
if("object"===typeof performance&&performance.now)var Cb=performance.now.bind(performance);else if("function"===typeof require){const {performance:a}=require("perf_hooks");Cb=a.now.bind(a)}else"object"===typeof process&&process.hrtime?Cb=function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E6}:Cb=Date.now;var ob,Gb,Hb,Ib,Jb,Kb,Lb;function fb(a,b){return(a||0===a?a+"":"").padEnd(b," ")}function kb(a,b){return(a||0===a?a+"":"").padStart(b,"0")}function R(a,b,c,e){return new Proxy({},{get:function(d,f){d=new a(b.buffer,c,e);const k=d[f];if("function"===typeof k)return k.bind(d);n(/^\d+$/.test(f)||"buffer"===f||"length"===f||"BYTES_PER_ELEMENT"===f||"byteOffset"===f);return k},set:function(d,f,k){n(/^\d+$/.test(f));(new a(b.buffer,c,e))[f]=k;return!0}})}
function K(a,b){return"0x"+kb((a?a.toString(16):"").toUpperCase(),b||1)}if("undefined"!==typeof crypto&&crypto.getRandomValues){let a=new Int32Array(1);var Mb=function(){crypto.getRandomValues(a);return a[0]}}else if("undefined"!==typeof require){const a=require("crypto");Mb=function(){return a.Rk(4).readInt32LE(0)}}else n(!1,"Unsupported platform: No cryptographic random values");
(function(){if("function"===typeof Math.clz32)Gb=function(e){n(0<e);n(256>e);return 31-Math.clz32(e)},Hb=function(e){n(0<e);return 31-Math.clz32(e)};else{for(var a=new Int8Array(256),b=0,c=-2;256>b;b++)b&b-1||c++,a[b]=c;Gb=function(e){n(0<e);n(256>e);return a[e]};Hb=function(e){e>>>=0;n(0<e);var d=e>>>16;if(d){var f=d>>>8;return f?24+a[f]:16+a[d]}return(f=e>>>8)?8+a[f]:a[e]}}})();
function Nb(a){var b=new Uint8Array(a),c,e;n(0===(a&a-1));this.length=0;this.push=function(d){this.length!==a&&this.length++;b[e]=d;e=e+1&a-1};this.shift=function(){if(this.length){var d=b[c];c=c+1&a-1;this.length--;return d}return-1};this.clear=function(){this.length=e=c=0};this.clear()}function Ob(){this.size=65536;this.data=new Float32Array(65536);this.length=this.end=this.start=0;n(!0)}
Ob.prototype.push=function(a){this.length===this.size?this.start=this.start+1&this.size-1:this.length++;this.data[this.end]=a;this.end=this.end+1&this.size-1};Ob.prototype.shift=function(){if(this.length){var a=this.data[this.start];this.start=this.start+1&this.size-1;this.length--;return a}};
function Pb(a,b){var c=new Float32Array(b);b>a.length&&(b=a.length);var e=a.start+b,d=a.data.subarray(a.start,e);c.set(d);e>=a.size&&(e-=a.size,c.set(a.data.subarray(0,e),d.length));a.start=e;a.length-=b;return c}Ob.prototype.clear=function(){this.length=this.end=this.start=0};function mb(a,b){a instanceof Array||(a=[a]);lb(new Blob(a),b)}
function lb(a,b){var c=document.createElement("a");c.download=b;c.href=window.URL.createObjectURL(a);c.dataset.downloadurl=["application/octet-stream",c.download,c.href].join(":");document.createEvent?(a=document.createEvent("MouseEvent"),a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(a)):c.click();window.URL.revokeObjectURL(c.href)}
function Qb(a){"number"===typeof a?this.view=new Uint8Array(a+7>>3):a instanceof ArrayBuffer?this.view=new Uint8Array(a):n(!1,"v86util.Bitmap: Invalid argument")}Qb.prototype.set=function(a,b){const c=a>>3;a=1<<(a&7);this.view[c]=b?this.view[c]|a:this.view[c]&~a};Qb.prototype.get=function(a){return this.view[a>>3]>>(a&7)&1};Qb.prototype.yb=function(){return this.view.buffer};var Tb="undefined"===typeof XMLHttpRequest?Rb:Sb;
function Sb(a,b,c){function e(){const p=c||0;setTimeout(()=>{Sb(a,b,p+1)},1E3*([1,1,2,3,5,8,13,21][p]||34))}var d=new XMLHttpRequest;d.open(b.method||"get",a,!0);d.responseType=b.bd?"json":"arraybuffer";if(b.headers)for(var f=Object.keys(b.headers),k=0;k<f.length;k++){var l=f[k];d.setRequestHeader(l,b.headers[l])}b.Ud&&(f=b.Ud.start,d.setRequestHeader("Range","bytes="+f+"-"+(f+b.Ud.length-1)),d.onreadystatechange=function(){200===d.status&&d.abort()});d.onload=function(){4===d.readyState&&(200!==
d.status&&206!==d.status?(console.error("Loading the image "+a+" failed (status %d)",d.status),500<=d.status&&600>d.status&&e()):d.response&&b.done&&b.done(d.response,d))};d.onerror=function(p){console.error("Loading the image "+a+" failed",p);e()};b.progress&&(d.onprogress=function(p){b.progress(p)});d.send(null)}
function Rb(a,b){let c=require("fs");b.Ud?(n(!b.bd),c.open(a,"r",(e,d)=>{if(e)throw e;let f=b.Ud.length;var k=Buffer.allocUnsafe(f);c.read(d,k,0,f,b.Ud.start,(l,p)=>{if(l)throw l;n(p===f);b.done&&b.done(new Uint8Array(k));c.close(d,q=>{if(q)throw q;})})})):c.readFile(a,{encoding:b.bd?"utf-8":null},function(e,d){e?console.log("Could not read file:",a,e):(e=d,b.bd?e=JSON.parse(e):e=(new Uint8Array(e)).buffer,b.done(e))})};(function(){function a(k){n(k instanceof ArrayBuffer);this.buffer=k;this.byteLength=k.byteLength;this.onload=void 0}function b(k,l,p){this.filename=k;this.byteLength=l;this.g=new Map;this.i=new Set;this.L=p;this.B=!!p;this.onload=void 0}function c(k,l,p,q,t){const u=k.match(/\.[^\.]+(\.zst)?$/);this.j=u?u[0]:"";this.h=k.substring(0,k.length-this.j.length);this.D=this.j.endsWith(".zst");this.h.endsWith("/")||(this.h+="-");this.g=new Map;this.i=new Set;this.byteLength=l;this.L=p;this.F=!!q;this.C=t;
this.B=!!p;this.onload=void 0}function e(k){this.file=k;this.byteLength=k.size;1073741824<k.size&&console.warn("SyncFileBuffer: Allocating buffer of "+(k.size>>20)+" MB ...");this.buffer=new ArrayBuffer(k.size);this.onload=void 0}function d(k){this.file=k;this.byteLength=k.size;this.g=new Map;this.i=new Set;this.onload=void 0}Ib=a;Jb=b;Kb=c;Lb=d;ob=e;a.prototype.load=function(){this.onload&&this.onload({buffer:this.buffer})};a.prototype.get=function(k,l,p){n(k+l<=this.byteLength);p(new Uint8Array(this.buffer,
k,l))};a.prototype.set=function(k,l,p){n(k+l.byteLength<=this.byteLength);(new Uint8Array(this.buffer,k,l.byteLength)).set(l);p()};a.prototype.yb=function(k){k(this.buffer)};a.prototype.Y=function(){const k=[];k[0]=this.byteLength;k[1]=new Uint8Array(this.buffer);return k};a.prototype.H=function(k){this.byteLength=k[0];this.buffer=k[1].slice().buffer};b.prototype.load=function(){void 0!==this.byteLength?this.onload&&this.onload(Object.create(null)):f(this.filename,(k,l)=>{if(k)throw Error("Cannot use: "+
this.filename+". "+k);n(0<=l);this.byteLength=l;this.onload&&this.onload(Object.create(null))})};b.prototype.h=function(k,l){var p=l/256;k/=256;for(var q=0;q<p;q++)if(!this.g.get(k+q))return;if(1===p)return this.g.get(k);l=new Uint8Array(l);for(q=0;q<p;q++)l.set(this.g.get(k+q),256*q);return l};b.prototype.get=function(k,l,p){n(k+l<=this.byteLength);n(0===k%256);n(0===l%256);n(l);var q=this.h(k,l);if(q)p(q);else{var t=k,u=l;this.L&&(t=k-k%this.L,u=Math.ceil((k-t+l)/this.L)*this.L);Tb(this.filename,
{done:function(A){A=new Uint8Array(A);this.j(t,u,A);t===k&&u===l?p(A):p(A.subarray(k-t,k-t+l))}.bind(this),Ud:{start:t,length:u}})}};b.prototype.set=function(k,l,p){var q=l.length;n(k+l.byteLength<=this.byteLength);n(0===k%256);n(0===q%256);n(q);k/=256;q/=256;for(var t=0;t<q;t++){var u=this.g.get(k+t);if(void 0===u)this.g.set(k+t,l.slice(256*t,256*(t+1)));else{const A=l.subarray(256*t,256*(t+1));n(u.byteLength===A.length);u.set(A)}this.i.add(k+t)}p()};b.prototype.j=function(k,l,p){k/=256;l/=256;for(var q=
0;q<l;q++){const t=this.g.get(k+q);t?p.set(t,256*q):this.B&&this.g.set(k+q,p.slice(256*q,256*(q+1)))}};b.prototype.yb=function(k){k()};b.prototype.Y=function(){const k=[],l=[];for(let [p,q]of this.g)n(isFinite(p)),this.i.has(p)&&l.push([p,q]);k[0]=l;return k};b.prototype.H=function(k){k=k[0];this.g.clear();this.i.clear();for(let [l,p]of k)n(isFinite(l)),this.g.set(l,p),this.i.add(l)};c.prototype.load=function(){void 0===this.byteLength&&n(!1);this.onload&&this.onload(Object.create(null))};c.prototype.get=
function(k,l,p){n(k+l<=this.byteLength);n(0===k%256);n(0===l%256);n(l);var q=this.l(k,l);if(q)p(q);else if(this.L){const u=Math.floor(k/this.L),A=k-u*this.L;n(0<=A);const v=Math.ceil((A+l)/this.L),w=new Uint8Array(v*this.L);let y=0;for(let z=0;z<v;z++){var t=(u+z)*this.L;q=this.F?this.h+(u+z+"").padStart(8,"0")+this.j:this.h+t+"-"+(t+this.L)+this.j;(t=this.l(t,this.L))?(w.set(t,z*this.L),y++,y===v&&p(w.subarray(A,A+l))):Tb(q,{done:async function(D){D=new Uint8Array(D);this.D&&(D=await this.C(this.L,
D),D=new Uint8Array(D));w.set(D,z*this.L);this.o((u+z)*this.L,this.L|0,D);y++;y===v&&p(w.subarray(A,A+l))}.bind(this)})}}else Tb(this.h+k+"-"+(k+l)+this.j,{done:function(u){n(u.byteLength===l);u=new Uint8Array(u);this.o(k,l,u);p(u)}.bind(this)})};c.prototype.l=b.prototype.h;c.prototype.set=b.prototype.set;c.prototype.o=b.prototype.j;c.prototype.Y=b.prototype.Y;c.prototype.H=b.prototype.H;e.prototype.load=function(){this.g(0)};e.prototype.g=function(k){var l=new FileReader;l.onload=function(p){p=new Uint8Array(p.target.result);
(new Uint8Array(this.buffer,k)).set(p);this.g(k+4194304)}.bind(this);k<this.byteLength?l.readAsArrayBuffer(this.file.slice(k,Math.min(k+4194304,this.byteLength))):(this.file=void 0,this.onload&&this.onload({buffer:this.buffer}))};e.prototype.get=a.prototype.get;e.prototype.set=a.prototype.set;e.prototype.yb=a.prototype.yb;e.prototype.Y=a.prototype.Y;e.prototype.H=a.prototype.H;d.prototype.load=function(){this.onload&&this.onload(Object.create(null))};d.prototype.get=function(k,l,p){n(0===k%256);n(0===
l%256);n(l);var q=this.h(k,l);q?p(q):(q=new FileReader,q.onload=function(t){t=new Uint8Array(t.target.result);this.j(k,l,t);p(t)}.bind(this),q.readAsArrayBuffer(this.file.slice(k,k+l)))};d.prototype.h=b.prototype.h;d.prototype.set=b.prototype.set;d.prototype.j=b.prototype.j;d.prototype.Y=b.prototype.Y;d.prototype.H=b.prototype.H;d.prototype.yb=function(k){k()};d.prototype.zg=function(k){for(var l=[],p=Array.from(this.g.keys()).sort(function(v,w){return v-w}),q=0,t=0;t<p.length;t++){var u=p[t],A=this.g.get(u);
u*=256;n(u>=q);u!==q&&(l.push(this.file.slice(q,u)),q=u);l.push(A);q+=A.length}q!==this.file.size&&l.push(this.file.slice(q));k=new File(l,k);n(k.size===this.file.size);return k};var f="undefined"===typeof XMLHttpRequest?function(k,l){require("fs").stat(k,(p,q)=>{p?l(p):l(null,q.size)})}:function(k,l){Tb(k,{done:(p,q)=>{p=q.getResponseHeader("Content-Range")||"";(q=p.match(/\/(\d+)\s*$/))?l(null,+q[1]):l("`Range: bytes=...` header not supported (Got `"+p+"`)")},headers:{Range:"bytes=0-0"}})}})();function Ub(a,b,c,e,d,f){this.ja=new Vb(this,a,b,e,d,f);this.ka=new Vb(this,a,c,!1,d,f);this.ca=this.ja;this.s=a;0===d?(this.g=496,this.ba=14,this.Oa=240):1===d?(this.g=368,this.ba=15,this.Oa=248):n(!1,"IDE device with nr "+d+" ignored");this.i=this.g|516;this.h=46080;this.J=[134,128,16,112,5,0,160,2,0,128,1,1,0,0,0,0,this.g&255|1,this.g>>8,0,0,this.i&255|1,this.i>>8,0,0,0,0,0,0,0,0,0,0,this.h&255|1,this.h>>8,0,0,0,0,0,0,0,0,0,0,67,16,212,130,0,0,0,0,0,0,0,0,0,0,0,0,this.ba,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.gb=[{size:8},{size:4},void 0,void 0,{size:16}];this.name="ide"+d;this.l=2;N(a.u,this.g|7,this,function(){r("lower irq",32768);Wb(this.s,this.ba);return this.fh()});N(a.u,this.i|2,this,this.fh);P(a.u,this.i|2,this,this.xk);N(a.u,this.g|0,this,function(){return Xb(this.ca,1)},function(){return Xb(this.ca,2)},function(){return Xb(this.ca,
4)});N(a.u,this.g|1,this,function(){r("Read error: "+K(this.ca.error&255)+" slave="+(this.ca===this.ka),32768);return this.ca.error&255});N(a.u,this.g|2,this,function(){r("Read bytecount: "+K(this.ca.$&255),32768);return this.ca.$&255});N(a.u,this.g|3,this,function(){r("Read sector: "+K(this.ca.xa&255),32768);return this.ca.xa&255});N(a.u,this.g|4,this,function(){r("Read 1F4: "+K(this.ca.ma&255),32768);return this.ca.ma&255});N(a.u,this.g|5,this,function(){r("Read 1F5: "+K(this.ca.oa&255),32768);
return this.ca.oa&255});N(a.u,this.g|6,this,function(){r("Read 1F6",32768);return this.ca.Sb&255});P(a.u,this.g|0,this,function(k){Yb(this.ca,k,1)},function(k){Yb(this.ca,k,2)},function(k){Yb(this.ca,k,4)});P(a.u,this.g|1,this,function(k){r("1F1/lba_count: "+K(k),32768);this.ja.qd=(this.ja.qd<<8|k)&65535;this.ka.qd=(this.ka.qd<<8|k)&65535});P(a.u,this.g|2,this,function(k){r("1F2/bytecount: "+K(k),32768);this.ja.$=(this.ja.$<<8|k)&65535;this.ka.$=(this.ka.$<<8|k)&65535});P(a.u,this.g|3,this,function(k){r("1F3/sector: "+
K(k),32768);this.ja.xa=(this.ja.xa<<8|k)&65535;this.ka.xa=(this.ka.xa<<8|k)&65535});P(a.u,this.g|4,this,function(k){r("1F4/sector low: "+K(k),32768);this.ja.ma=(this.ja.ma<<8|k)&65535;this.ka.ma=(this.ka.ma<<8|k)&65535});P(a.u,this.g|5,this,function(k){r("1F5/sector high: "+K(k),32768);this.ja.oa=(this.ja.oa<<8|k)&65535;this.ka.oa=(this.ka.oa<<8|k)&65535});P(a.u,this.g|6,this,function(k){var l=k&16;r("1F6/drive: "+K(k,2),32768);l?(r("Slave",32768),this.ca=this.ka):this.ca=this.ja;this.ja.Sb=k;this.ka.Sb=
k;this.ja.Jc=this.ka.Jc=k>>6&1;this.ja.head=this.ka.head=k&15});this.j=this.sa=this.tc=0;P(a.u,this.g|7,this,function(k){r("lower irq",32768);Wb(this.s,this.ba);var l=this.ca;r("ATA Command: "+K(k)+" slave="+(l.Sb>>4&1),32768);if(l.buffer)switch(l.j=k,l.error=0,k){case 8:r("ATA device reset",32768);l.i=0;l.g=0;l.h=0;Zb(l);l.T();break;case 16:l.status=80;l.ma=0;l.T();break;case 248:l.status=80;var p=l.l-1;l.xa=p&255;l.ma=p>>8&255;l.oa=p>>16&255;l.Sb=l.Sb&240|p>>24&15;l.T();break;case 39:l.status=80;
p=l.l-1;l.xa=p&255;l.ma=p>>8&255;l.oa=p>>16&255;l.xa|=p>>24<<8&65280;l.T();break;case 32:case 36:case 41:case 196:$b(l,k);break;case 48:case 52:case 57:case 197:var q=52===k||57===k;p=ac(l,q);q=bc(l,q);k=48===k||52===k;var t=p*l.o,u=q*l.o;r("ATA write lba="+K(q)+" mode="+(l.Jc?"lba":"chs")+" lbacount="+K(p)+" bytecount="+K(t),32768);u+t>l.buffer.byteLength?(n(!1,"ATA write: Outside of disk"),l.status=255,l.T()):(l.status=88,cc(l,t),l.g=k?512:Math.min(t,512*l.K),l.W=u);break;case 144:l.T();l.error=
257;l.status=80;break;case 145:l.status=80;l.T();break;case 160:l.I&&(l.status=88,dc(l,12),l.g=12,l.$=1,l.T());break;case 161:r("ATA identify packet device",32768);l.I?(ec(l),l.status=88,l.ma=20,l.oa=235):l.status=65;l.T();break;case 198:r("Logical sectors per DRQ Block: "+K(l.$&255),32768);l.K=l.$&255;l.status=80;l.T();break;case 37:case 200:q=37===k;p=ac(l,q);q=bc(l,q);k=p*l.o;t=q*l.o;r("ATA DMA read lba="+K(q)+" lbacount="+K(p)+" bytecount="+K(k),32768);t+k>l.buffer.byteLength?(n(!1,"ATA read: Outside of disk"),
l.status=255,l.T()):(l.status=88,l.pa.sa|=1);break;case 53:case 202:q=53===k;p=ac(l,q);q=bc(l,q);k=p*l.o;t=q*l.o;r("ATA DMA write lba="+K(q)+" lbacount="+K(p)+" bytecount="+K(k),32768);t+k>l.buffer.byteLength?(n(!1,"ATA DMA write: Outside of disk"),l.status=255,l.T()):(l.status=88,l.pa.sa|=1);break;case 64:r("read verify sectors",32768);l.status=80;l.T();break;case 218:r("Unimplemented: get media status",32768);l.status=65;l.error=4;l.T();break;case 224:r("ATA standby immediate",32768);l.status=80;
l.T();break;case 225:r("ATA idle immediate",32768);l.status=80;l.T();break;case 231:r("ATA flush cache",32768);l.status=80;l.T();break;case 236:r("ATA identify device",32768);if(l.I){l.status=65;l.error=4;l.T();break}ec(l);l.status=88;l.T();break;case 234:r("flush cache ext",32768);l.status=80;l.T();break;case 239:r("set features: "+K(l.$&255),32768);l.status=80;l.T();break;case 222:l.status=80;l.T();break;case 245:r("security freeze lock",32768);l.status=80;l.T();break;case 249:r("Unimplemented: set max address",
32768);l.status=65;l.error=4;break;default:n(!1,"New ATA cmd on 1F7: "+K(k)),l.status=65,l.error=4}else r("abort: No buffer",32768),l.error=4,l.status=65,l.T()});N(a.u,this.h|4,this,void 0,void 0,this.bi);P(a.u,this.h|4,this,void 0,void 0,this.di);N(a.u,this.h,this,this.ng,void 0,this.ci);P(a.u,this.h,this,this.pg,void 0,this.ei);N(a.u,this.h|2,this,this.og);P(a.u,this.h|2,this,this.qg);N(a.u,this.h|8,this,function(){r("DMA read 0x8",32768);return 0});N(a.u,this.h|10,this,function(){r("DMA read 0xA",
32768);return 0});fc(a.v.Ta,this);Object.seal(this)}m=Ub.prototype;m.fh=function(){if(this.ca.buffer){var a=this.ca.status;r("ATA read status: "+K(a,2),32768);return a}return 0};m.xk=function(a){r("set device control: "+K(a,2)+" interrupts "+(a&2?"disabled":"enabled"),32768);a&4&&(r("Reset via control port",32768),Wb(this.s,this.ba),Zb(this.ja),Zb(this.ka));this.l=a};m.bi=function(){r("dma get address: "+K(this.tc,8),32768);return this.tc};
m.di=function(a){r("dma set address: "+K(a,8),32768);this.tc=a};m.og=function(){r("DMA read status: "+K(this.sa),32768);return this.sa};m.qg=function(a){r("DMA set status: "+K(a),32768);this.sa&=~(a&6)};m.ci=function(){return this.ng()|this.og()<<16};m.ng=function(){r("DMA read command: "+K(this.j),32768);return this.j};m.ei=function(a){r("DMA write command: "+K(a),32768);this.pg(a&255);this.qg(a>>16&255)};
m.pg=function(a){r("DMA write command8: "+K(a),32768);let b=this.j;this.j=a&9;if((b&1)!==(a&1))if(0===(a&1))this.sa&=-2;else switch(this.sa|=1,this.ca.j){case 37:case 200:gc(this.ca);break;case 202:case 53:hc(this.ca);break;case 160:ic(this.ca);break;default:r("Spurious dma command write, current command: "+K(this.ca.j),32768),n(!1)}};m.T=function(){0===(this.l&2)&&(r("push irq",32768),this.sa|=4,this.s.Sa(this.ba))};
m.Y=function(){var a=[];a[0]=this.ja;a[1]=this.ka;a[2]=this.g;a[3]=this.ba;a[4]=this.Oa;a[5]=this.i;a[6]=this.h;a[7]=this.name;a[8]=this.l;a[9]=this.tc;a[10]=this.sa;a[11]=this.ca===this.ja;a[12]=this.j;return a};m.H=function(a){this.ja.H(a[0]);this.ka.H(a[1]);this.g=a[2];this.ba=a[3];this.Oa=a[4];this.i=a[5];this.h=a[6];this.name=a[7];this.l=a[8];this.tc=a[9];this.sa=a[10];this.ca=a[11]?this.ja:this.ka;this.j=a[12]};
function Vb(a,b,c,e,d,f){this.pa=a;this.A=f;this.X=d;this.s=b;this.buffer=c;this.o=e?2048:512;this.I=e;this.F=this.C=this.D=this.l=0;this.buffer&&(this.l=this.buffer.byteLength/this.o,this.l!==(this.l|0)&&(r("Warning: Disk size not aligned with sector size",32768),this.l=Math.ceil(this.l)),e?(this.D=1,this.C=0):(this.D=16,this.C=63),this.F=this.l/this.D/this.C,this.F!==(this.F|0)&&(r("Warning: Rounding up cylinder count. Choose different head number",32768),this.F=Math.floor(this.F)),a=b.v.Yc,n(!0),
S(a,57,a.kc[57]|1<<4*this.X),n(!0),S(a,18,a.kc[18]&15|240),S(a,27,this.F&255),S(a,28,this.F>>8&255),S(a,29,this.D&255),S(a,30,255),S(a,31,255),S(a,32,200),S(a,33,this.F&255),S(a,34,this.F>>8&255),S(a,35,this.C&255));this.B={ih:0,jh:0,gg:0,hg:0,Eg:!1};this.buffer=c;this.Sb=this.head=this.oa=this.ma=this.qd=this.xa=this.$=this.Jc=0;this.status=80;this.K=128;this.i=this.error=0;this.data=new Uint8Array(65536);this.V=new Uint16Array(this.data.buffer);this.P=new Int32Array(this.data.buffer);this.g=this.h=
0;this.U=this.j=-1;this.la=this.W=0;this.S=new Set;this.aa=new Set;Object.seal(this)}function Zb(a){a.I?(a.status=0,a.$=1,a.error=1,a.xa=1,a.ma=20,a.oa=235):(a.status=81,a.$=1,a.error=1,a.xa=1,a.ma=0,a.oa=0);for(const b of a.S)a.aa.add(b);a.S.clear()}m=Vb.prototype;m.T=function(){this.pa.T()};m.ke=function(){this.status=80;n(this.h<=this.data.length);var a=this.data.subarray(0,this.h);n(0===this.h%512);jc(this,this.j,this.h/512);this.T();this.buffer.set(this.W,a,function(){});kc(this,this.h)};
function lc(a,b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],e=b[7]<<8|b[8],d=e*a.o,f=c*a.o;r("CD read lba="+K(c)+" lbacount="+K(e)+" bytecount="+K(d)+" flags="+K(b[1]),32768);a.h=0;var k=a.oa<<8&65280|a.ma&255;r(K(a.oa,2)+" "+K(a.ma,2),32768);a.ma=a.oa=0;65535===k&&k--;k>d&&(k=d);f>=a.buffer.byteLength?(n(!1,"CD read: Outside of disk  end="+K(f+d)+" size="+K(a.buffer.byteLength)),a.status=255,a.T()):0===d?(a.status=80,a.i=0):(d=Math.min(d,a.buffer.byteLength-f),a.status=208,mc(a),a.ea(f,d,l=>{r("cd read: data arrived",
32768);nc(a,l);a.status=88;a.$=a.$&-8|2;a.T();k&=-4;a.g=k;a.g>a.h&&(a.g=a.h);a.ma=a.g&255;a.oa=a.g>>8&255;oc(a,d)}))}
function pc(a,b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],e=b[7]<<8|b[8],d=e*a.o,f=c*a.o;r("CD read DMA lba="+K(c)+" lbacount="+K(e)+" bytecount="+K(d)+" flags="+K(b[1]),32768);f>=a.buffer.byteLength?(n(!1,"CD read: Outside of disk  end="+K(f+d)+" size="+K(a.buffer.byteLength)),a.status=255,a.T()):(a.status=208,mc(a),a.ea(f,d,k=>{r("atapi_read_dma: Data arrived");oc(a,d);a.status=88;a.$=a.$&-8|2;nc(a,k);ic(a)}))}
function ic(a){if(0===(a.pa.sa&1))r("do_atapi_dma: Status not set",32768);else if(0===(a.status&8))r("do_atapi_dma: DRQ not set",32768);else{r("atapi dma transfer len="+a.h,32768);var b=a.pa.tc,c=0,e=a.data;do{var d=a.s.h(b),f=a.s.ta(b+4),k=a.s.Ia(b+7)&128;f||(f=65536);r("dma read dest="+K(d)+" count="+K(f)+" datalen="+K(a.h),32768);ta(a.s,e.subarray(c,Math.min(c+f,a.h)),d);c+=f;b+=8;if(c>=a.h&&!k){r("leave early end="+ +k+" offset="+K(c)+" data_length="+K(a.h)+" cmd="+K(a.j),32768);break}}while(!k);
r("end offset="+c,32768);a.status=80;a.pa.sa&=-2;a.$=a.$&-8|3;a.T()}}
function Xb(a,b){if(a.i<a.g){n(a.i+b-1<a.g);n(0===a.i%b,K(a.i)+" "+b);var c=1===b?a.data[a.i]:2===b?a.V[a.i>>>1]:a.P[a.i>>>2];a.i+=b;0===(a.i&(0===(a.g&4095)?4095:255))&&r("Read 1F0: "+K(a.data[a.i],2)+" cur="+K(a.i)+" cnt="+K(a.h),32768);a.i>=a.g&&(r("read_end cmd="+K(a.j)+" data_pointer="+K(a.i)+" end="+K(a.g)+" length="+K(a.h),32768),160===a.j?a.g===a.h?(a.status=80,a.$=a.$&-8|3,a.T()):(a.status=88,a.$=a.$&-8|2,a.T(),b=a.oa<<8&65280|a.ma&255,a.g+b>a.h?(a.ma=a.h-a.g&255,a.oa=a.h-a.g>>8&255,a.g=
a.h):a.g+=b,r("data_end="+K(a.g),32768)):(a.error=0,a.i>=a.h?a.status=80:(196===a.j||41===a.j?(b=Math.min(a.K,(a.h-a.g)/512),n(0===b%1)):(n(32===a.j||36===a.j),b=1),jc(a,a.j,b),a.g+=512*b,a.status=88),a.T()));return c}r("Read 1F0: empty",32768);a.i+=b;return 0}
function Yb(a,b,c){n(0===a.i%c);if(a.i>=a.g)r("Redundant write to data port: "+K(b)+" count="+K(a.g)+" cur="+K(a.i),32768);else if((0===(a.i+c&(0===(a.g&4095)?4095:255))||20>a.g)&&r("Data port: "+K(b>>>0)+" count="+K(a.g)+" cur="+K(a.i),32768),1===c?a.data[a.i++]=b:2===c?(a.V[a.i>>>1]=b,a.i+=2):(a.P[a.i>>>2]=b,a.i+=4),n(a.i<=a.g),a.i===a.g)if(160===a.j){r("ATAPI Command: "+K(a.data[0])+" slave="+(a.Sb>>4&1),32768);a.i=0;a.U=a.data[0];switch(a.U){case 0:r("test unit ready",32768);dc(a,0);a.g=a.h;a.status=
80;break;case 3:dc(a,a.data[4]);a.g=a.h;a.status=88;a.data[0]=240;a.data[2]=5;a.data[7]=8;break;case 18:b=a.data[4];a.status=88;r("inquiry: "+K(a.data[1],2)+" length="+b,32768);a.data.set([5,128,1,49,31,0,0,0,83,79,78,89,32,32,32,32,67,68,45,82,79,77,32,67,68,85,45,49,48,48,48,32,49,46,49,97]);a.g=a.h=Math.min(36,b);break;case 26:dc(a,a.data[4]);a.g=a.h;a.status=88;break;case 30:dc(a,0);a.g=a.h;a.status=80;break;case 37:b=a.l-1;nc(a,new Uint8Array([b>>24&255,b>>16&255,b>>8&255,b&255,0,0,a.o>>8&255,
a.o&255]));a.g=a.h;a.status=88;break;case 40:a.qd&1?pc(a,a.data):lc(a,a.data);break;case 66:b=a.data[8];dc(a,Math.min(8,b));a.g=a.h;r("read q subcode: length="+b,32768);a.status=88;break;case 67:b=a.data[8]|a.data[7]<<8;c=a.data[9]>>6;dc(a,b);a.g=a.h;r("read toc: "+K(c,2)+" length="+b+" "+(a.data[1]&2)+" "+K(a.data[6]),32768);0===c?(b=a.l,a.data.set(new Uint8Array([0,18,1,1,0,20,1,0,0,0,0,0,0,22,170,0,b>>24,b>>16&255,b>>8&255,b&255]))):1===c?a.data.set(new Uint8Array([0,10,1,1,0,0,0,0,0,0,0,0])):
n(!1,"Unimplemented format: "+c);a.status=88;break;case 70:b=a.data[8]|a.data[7]<<8;b=Math.min(b,32);dc(a,b);a.g=a.h;a.data[0]=b-4>>24&255;a.data[1]=b-4>>16&255;a.data[2]=b-4>>8&255;a.data[3]=b-4&255;a.data[6]=8;a.data[10]=3;a.status=88;break;case 81:dc(a,0);a.g=a.h;a.status=80;break;case 82:r("Unimplemented ATAPI command: "+K(a.data[0]),32768);a.status=81;a.h=0;a.error=80;break;case 90:b=a.data[8]|a.data[7]<<8;c=a.data[2];r("mode sense: "+K(c)+" length="+b,32768);42===c&&dc(a,Math.min(30,b));a.g=
a.h;a.status=88;break;case 189:dc(a,a.data[9]|a.data[8]<<8);a.g=a.h;a.data[5]=1;a.status=88;break;case 74:a.status=81;a.h=0;a.error=80;r("Unimplemented ATAPI command: "+K(a.data[0]),32768);break;case 190:r("Unimplemented ATAPI command: "+K(a.data[0]),32768);dc(a,0);a.g=a.h;a.status=80;break;default:a.status=81,a.h=0,a.error=80,r("Unimplemented ATAPI command: "+K(a.data[0]),32768),n(!1)}a.$=a.$&-8|2;0===(a.status&128)&&a.T();0===(a.status&128)&&0===a.h&&(a.$|=1,a.status&=-9)}else r("write_end data_pointer="+
K(a.i)+" data_length="+K(a.h),32768),a.i>=a.h?a.ke():(n(48===a.j||52===a.j||197===a.j,"Unexpected command: "+K(a.j)),a.status=88,a.g+=512,a.T())}
function jc(a,b,c){r("Advance sectors="+c+" old_bytecount="+a.$,32768);a.$-=c;36===b||41===b||52===b||57===b||37===b||53===b?(b=c+qc(a),a.xa=b&255|b>>16&65280,a.ma=b>>8&255,a.oa=b>>16&255):a.Jc?(b=c+rc(a),a.xa=b&255,a.ma=b>>8&255,a.oa=b>>16&255,a.head=a.head&-16|b&15):(b=c+sc(a),c=b/(a.D*a.C)|0,a.ma=c&255,a.oa=c>>8&255,a.head=(b/a.C|0)%a.D&15,a.xa=b%a.C+1&255,n(b===sc(a)))}
function $b(a,b){var c=36===b||41===b,e=ac(a,c);c=bc(a,c);var d=32===b||36===b,f=e*a.o,k=c*a.o;r("ATA read cmd="+K(b)+" mode="+(a.Jc?"lba":"chs")+" lba="+K(c)+" lbacount="+K(e)+" bytecount="+K(f),32768);k+f>a.buffer.byteLength?(n(!1,"ATA read: Outside of disk"),a.status=255,a.T()):(a.status=192,mc(a),a.ea(k,f,l=>{r("ata_read: Data arrived",32768);nc(a,l);a.status=88;a.g=d?512:Math.min(f,512*a.K);jc(a,b,d?1:Math.min(e,a.C));a.T();oc(a,f)}))}
function gc(a){var b=37===a.j,c=ac(a,b);b=bc(a,b);var e=c*a.o,d=b*a.o;n(b<a.buffer.byteLength);mc(a);var f=a.pa.tc;a.ea(d,e,k=>{r("do_ata_read_sectors_dma: Data arrived",32768);var l=a.pa.tc,p=0;n(f===l);do{var q=a.s.h(l),t=a.s.ta(l+4),u=a.s.Ia(l+7)&128;t||(t=65536,r("dma: prd count was 0",32768));r("dma read transfer dest="+K(q)+" prd_count="+K(t),32768);ta(a.s,k.subarray(p,p+t),q);p+=t;l+=8}while(!u);n(p===e);jc(a,a.j,c);a.status=80;a.pa.sa&=-2;a.j=-1;a.T();oc(a,e)})}
function hc(a){var b=53===a.j,c=ac(a,b),e=bc(a,b);b=c*a.o;e*=a.o;var d=a.pa.tc,f=0;r("prdt addr: "+K(d,8),32768);const k=new Uint8Array(b);do{var l=a.s.h(d),p=a.s.ta(d+4),q=a.s.Ia(d+7)&128;p||(p=65536,r("dma: prd count was 0",32768));r("dma write transfer dest="+K(l)+" prd_count="+K(p),32768);l=a.s.Na.subarray(l,l+p);n(l.length===p);k.set(l,f);f+=p;d+=8}while(!q);n(f===k.length);a.buffer.set(e,k,()=>{r("dma write completed",32768);jc(a,a.j,c);a.status=80;a.T();a.pa.sa&=-2;a.j=-1});kc(a,b)}
function sc(a){var b=a.ma&255|a.oa<<8&65280,c=a.head,e=a.xa&255;r("get_chs: c="+b+" h="+c+" s="+e,32768);return(b*a.D+c)*a.C+e-1}function rc(a){return a.xa&255|a.ma<<8&65280|a.oa<<16&16711680|(a.head&15)<<24}function qc(a){return(a.xa&255|a.ma<<8&65280|a.oa<<16&16711680|a.xa>>8<<24&4278190080)>>>0}function bc(a,b){return b?qc(a):a.Jc?rc(a):sc(a)}function ac(a,b){b?(a=a.$,0===a&&(a=65536)):(a=a.$&255,0===a&&(a=256));return a}
function ec(a){if(a.Sb&16)dc(a,0);else{for(var b=0;512>b;b++)a.data[b]=0;b=Math.min(16383,a.F);nc(a,[64,a.I?133:0,b,b>>8,0,0,a.D,a.D>>8,a.C/512,a.C/512>>8,0,2,a.C,a.C>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,4,0,0,0,0,0,0,0,0,0,56,118,32,54,68,72,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,128,0,1,0,0,2,0,0,0,2,0,2,7,0,b,b>>8,a.D,a.D>>8,a.C,0,a.l&255,a.l>>8&255,a.l>>16&255,a.l>>24&255,0,0,a.l&255,a.l>>8&255,a.l>>16&255,
a.l>>24&255,0,0,160===a.j?0:7,160===a.j?0:4,0,0,30,0,30,0,30,0,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,0,0,0,0,0,0,116,0,64,0,64,0,116,0,64,0,0,0,0,0,0,0,0,0,0,1,96,0,0,0,0,0,0,0,0,0,0,0,0,a.l&255,a.l>>8&255,a.l>>16&255,a.l>>24&255]);a.h=512;a.g=512}}function dc(a,b){cc(a,b);for(var c=0;c<b+3>>2;c++)a.P[c]=0}function cc(a,b){a.data.length<b&&(a.data=new Uint8Array(b+3&-4),a.V=new Uint16Array(a.data.buffer),a.P=new Int32Array(a.data.buffer));a.h=b;a.i=0}
function nc(a,b){cc(a,b.length);a.data.set(b)}function mc(a){a.B.Eg=!0;a.A.send("ide-read-start")}function oc(a,b){a.B.Eg=!1;var c=b/a.o|0;a.B.ih+=c;a.B.gg+=b;a.A.send("ide-read-end",[a.X,b,c])}function kc(a,b){var c=b/a.o|0;a.B.jh+=c;a.B.hg+=b;a.A.send("ide-write-end",[a.X,b,c])}m.ea=function(a,b,c){const e=this.la++;this.S.add(e);this.buffer.get(a,b,d=>{if(this.aa.delete(e))n(!this.S.has(e));else{var f=this.S.delete(e);n(f);c(d)}})};
m.Y=function(){var a=[];a[0]=this.$;a[1]=this.F;a[2]=this.oa;a[3]=this.ma;a[4]=this.i;a[5]=0;a[6]=0;a[7]=0;a[8]=0;a[9]=this.Sb;a[10]=this.error;a[11]=this.head;a[12]=this.D;a[13]=this.I;a[14]=this.Jc;a[15]=this.qd;a[16]=this.data;a[17]=this.h;a[18]=this.xa;a[19]=this.l;a[20]=this.o;a[21]=this.K;a[22]=this.C;a[23]=this.status;a[24]=this.W;a[25]=this.j;a[26]=this.g;a[27]=this.U;a[28]=this.buffer;return a};
m.H=function(a){this.$=a[0];this.F=a[1];this.oa=a[2];this.ma=a[3];this.i=a[4];this.Sb=a[9];this.error=a[10];this.head=a[11];this.D=a[12];this.I=a[13];this.Jc=a[14];this.qd=a[15];this.data=a[16];this.h=a[17];this.xa=a[18];this.l=a[19];this.o=a[20];this.K=a[21];this.C=a[22];this.status=a[23];this.W=a[24];this.j=a[25];this.g=a[26];this.U=a[27];this.V=new Uint16Array(this.data.buffer);this.P=new Int32Array(this.data.buffer);this.buffer&&this.buffer.H(a[28])};function uc(a){this.pb=new Uint8Array(4);this.g=new Uint8Array(4);this.vd=new Uint8Array(4);this.wd=new Uint8Array(4);this.Pc=new Int32Array(this.pb.buffer);new Int32Array(this.g.buffer);this.Lf=new Int32Array(this.vd.buffer);this.Ng=new Int32Array(this.wd.buffer);this.Nb=[];this.v=[];this.s=a;for(var b=0;256>b;b++)this.Nb[b]=void 0,this.v[b]=void 0;this.u=a.u;P(a.u,3324,this,function(c){vc(this,this.Pc[0],c)},function(c){wc(this,this.Pc[0],c)},function(c){var e=this.Pc[0];n(0===(e&3));var d=e>>8&
65535;e&=255;var f=this.Nb[d],k=this.v[d];if(f)if(16<=e&&40>e){var l=e-16>>2,p=k.gb[l];r("BAR"+l+" exists="+(p?"y":"n")+" changed to "+K(c>>>0)+" dev="+K(d>>3,2)+" ("+k.name+") ",2048);p?(n(!(p.size&p.size-1),"bar size should be power of 2"),d=e>>2,k=f[d]&1,-1===(c|3|p.size-1)?(c=~(p.size-1)|k,0===k&&(f[d]=c)):0===k&&(l=p.Kg,(c&-16)!==(l&-16)&&r("Warning: Changing memory bar not supported, ignored",2048),f[d]=l),1===k&&(n(1===k),k=f[d]&65534,l=c&65534,r("io bar changed from "+K(k>>>0,8)+" to "+K(l>>>
0,8)+" size="+p.size,2048),xc(this,p,k,l),f[d]=c|1)):f[e>>2]=0;r("BAR effective value: "+K(f[e>>2]>>>0),2048)}else 48===e?(r("PCI write rom address dev="+K(d>>3,2)+" ("+k.name+") value="+K(c>>>0,8),2048),f[e>>2]=k.Mg?-1===(c|2047)?-k.Mg|0:k.Ii|0:0):4===e?r("PCI write dev="+K(d>>3,2)+" ("+k.name+") addr="+K(e,4)+" value="+K(c>>>0,8),2048):(r("PCI write dev="+K(d>>3,2)+" ("+k.name+") addr="+K(e,4)+" value="+K(c>>>0,8),2048),f[e>>>2]=c)});P(a.u,3325,this,function(c){vc(this,this.Pc[0]+1|0,c)});P(a.u,
3326,this,function(c){vc(this,this.Pc[0]+2|0,c)},function(c){wc(this,this.Pc[0]+2|0,c)});P(a.u,3327,this,function(c){vc(this,this.Pc[0]+3|0,c)});a.u.Ad(3324,this,function(){return this.vd[0]},function(){return this.vd[1]},function(){return this.vd[2]},function(){return this.vd[3]});a.u.Ad(3320,this,function(){return this.wd[0]},function(){return this.wd[1]},function(){return this.wd[2]},function(){return this.wd[3]});a.u.ac(3320,this,function(c){this.pb[0]=c&252},function(c){2===(this.pb[1]&6)&&6===
(c&6)?(r("CPU reboot via PCI"),yc(a)):this.pb[1]=c},function(c){this.pb[2]=c},function(c){this.pb[3]=c;var e=this.pb[2]<<8|this.pb[1],d=this.pb[0]&252;c="query enabled="+(this.pb[3]>>7);c+=" bdf="+K(e,4);c+=" dev="+K(e>>3&31,2);c+=" addr="+K(d,2);var f=this.Nb[e];void 0!==f?(this.Ng[0]=-2147483648,this.Lf[0]=d<f.byteLength?f[d>>2]:0,c+=" "+K(this.Pc[0]>>>0,8)+" -> "+K(this.Lf[0]>>>0,8),d>=f.byteLength&&(c+=" (undef)"),c+=" ("+this.v[e].name+")",r(c,2048)):(this.Lf[0]=-1,this.Ng[0]=0)});fc(this,{Oa:0,
J:[134,128,55,18,0,0,0,0,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0],gb:[],name:"82441FX PMC"});this.i={Oa:8,J:[134,128,0,112,7,0,0,2,0,0,1,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],gb:[],name:"82371SB PIIX3 ISA"};this.j=fc(this,this.i);this.h=new Uint8Array(this.j.buffer)}
uc.prototype.Y=function(){for(var a=[],b=0;256>b;b++)a[b]=this.Nb[b];a[256]=this.pb;a[257]=this.g;a[258]=this.vd;a[259]=this.wd;return a};
uc.prototype.H=function(a){for(var b=0;256>b;b++){var c=this.v[b],e=a[b];if(c&&e){for(var d=0;d<c.gb.length;d++){var f=e[4+d];if(f&1){var k=c.gb[d];xc(this,k,k.Kg&65534,f&65534)}}this.Nb[b].set(e)}else c&&r("Warning: While restoring PCI device: Device exists in current configuration but not in snapshot ("+c.name+")"),e&&r("Warning: While restoring PCI device: Device doesn't exist in current configuration but does in snapshot (device "+K(b,2)+")")}this.pb.set(a[256]);this.g.set(a[257]);this.vd.set(a[258]);
this.wd.set(a[259])};function vc(a,b,c){var e=b>>8&65535;b&=255;var d=new Uint8Array(a.Nb[e].buffer);a=a.v[e];d&&(n(!(16<=b&&44>b||48<=b&&52>b),"PCI: Expected 32-bit write, got 8-bit (addr: "+K(b)+")"),r("PCI write8 dev="+K(e>>3,2)+" ("+a.name+") addr="+K(b,4)+" value="+K(c,2),2048),d[b]=c)}
function wc(a,b,c){n(0===(b&1));var e=b>>8&65535;b&=255;var d=new Uint16Array(a.Nb[e].buffer);a=a.v[e];d&&(16<=b&&44>b?r("Warning: PCI: Expected 32-bit write, got 16-bit (addr: "+K(b)+")"):(n(!(48<=b&&52>b),"PCI: Expected 32-bit write, got 16-bit (addr: "+K(b)+")"),r("PCI writ16 dev="+K(e>>3,2)+" ("+a.name+") addr="+K(b,4)+" value="+K(c,4),2048),d[b>>>1]=c))}
function fc(a,b){n(void 0!==b.Oa);n(void 0!==b.J);n(void 0!==b.gb);var c=b.Oa;r("PCI register bdf="+K(c)+" ("+b.name+")",2048);n(!a.v[c]);n(64<=b.J.length);n(c<a.v.length);var e=new Int32Array(64);e.set(new Int32Array((new Uint8Array(b.J)).buffer));a.Nb[c]=e;a.v[c]=b;c=e.slice(4,10);for(var d=0;d<b.gb.length;d++){var f=b.gb[d];if(f){var k=c[d],l=k&1;f.Kg=k;f.entries=[];if(0!==l)for(n(1===l),k&=-2,l=0;l<f.size;l++)f.entries[l]=a.u.ports[k+l]}}return e}
function xc(a,b,c,e){var d=b.size;r("Move io bars: from="+K(c)+" to="+K(e)+" count="+d,2048);for(var f=a.u.ports,k=0;k<d;k++){var l=f[c+k];4096<=c+k&&(f[c+k]=tb(a.u));l.Ia===a.u.Ve&&l.ta===a.u.Te&&l.Wc===a.u.Ue&&l.Jd===a.u.nb&&l.$c===a.u.nb&&l.Cb===a.u.nb&&r("Warning: Bad IO bar: Source not mapped, port="+K(c+k,4),2048);l=b.entries[k];var p=f[e+k];n(l&&p);4096<=e+k&&(f[e+k]=l);p.Ia!==a.u.Ve&&p.ta!==a.u.Te&&p.Wc!==a.u.Ue&&p.Jd!==a.u.nb&&p.$c!==a.u.nb&&p.Cb!==a.u.nb||r("Warning: Bad IO bar: Target already mapped, port="+
K(e+k,4),2048)}}uc.prototype.Da=function(a){var b=this.Nb[a];n(b);this.s.Sa(this.h[96+((b[15]>>8&255)-1+((a>>3)-1&255)&3)])};function zc(a,b){var c=a.Nb[b];n(c);Wb(a.s,a.h[96+((c[15]>>8&255)+(b>>3&255)-2&3)])};function Ac(a,b){this.u=a.u;this.s=a;this.lb=a.v.lb;this.h=0;this.F=new Uint8Array(10);this.I=0;this.j=null;this.g=new Uint8Array(10);this.l=this.i=0;this.K=b;this.P=this.C=this.V=this.aa=this.X=this.W=0;this.S=1;this.o=0;if(b){var c={[163840]:{type:1,rb:40,qb:8,ob:1},[184320]:{type:1,rb:40,qb:9,ob:1},[204800]:{type:1,rb:40,qb:10,ob:1},[327680]:{type:1,rb:40,qb:8,ob:2},[368640]:{type:1,rb:40,qb:9,ob:2},[409600]:{type:1,rb:40,qb:10,ob:2},[737280]:{type:3,rb:80,qb:9,ob:2},[1228800]:{type:2,rb:80,qb:15,
ob:2},[1474560]:{type:4,rb:80,qb:18,ob:2},[1763328]:{type:5,rb:82,qb:21,ob:2},[2949120]:{type:5,rb:80,qb:36,ob:2},512:{type:1,rb:1,qb:1,ob:1}};let d=b.byteLength;var e=c[d];e||(d=1474560<b.byteLength?2949120:1474560,e=c[d],r("Warning: Unkown floppy size: "+b.byteLength+", assuming "+d));S(a.v.Yc,16,e.type<<4);a=e.qb;b=e.ob;e=e.rb;this.B=a;this.D=b;this.U=e}else S(a.v.Yc,16,64),this.U=this.D=this.B=0;N(this.u,1008,this,this.Pj);N(this.u,1010,this,this.Qj);N(this.u,1012,this,this.Sj);N(this.u,1013,
this,this.Tj);N(this.u,1015,this,this.Vj);P(this.u,1010,this,this.Rj);P(this.u,1013,this,this.Uj)}m=Ac.prototype;m.Y=function(){var a=[];a[0]=this.h;a[1]=this.F;a[2]=this.I;a[4]=this.g;a[5]=this.i;a[6]=this.l;a[8]=this.W;a[9]=this.X;a[10]=this.aa;a[11]=this.V;a[12]=this.C;a[13]=this.P;a[14]=this.S;a[15]=this.o;a[16]=this.B;a[17]=this.D;a[18]=this.U;return a};
m.H=function(a){this.h=a[0];this.F=a[1];this.I=a[2];this.j=a[3];this.g=a[4];this.i=a[5];this.l=a[6];this.W=a[8];this.X=a[9];this.aa=a[10];this.V=a[11];this.C=a[12];this.P=a[13];this.S=a[14];this.o=a[15];this.B=a[16];this.D=a[17];this.U=a[18]};m.Pj=function(){r("3F0 read",8192);return 0};m.Sj=function(){r("3F4 read",8192);var a=128;this.i<this.l&&(a|=80);0===(this.o&8)&&(a|=32);return a};m.Vj=function(){r("3F7 read",8192);return 0};
m.Tj=function(){if(this.i<this.l)return r("3F5 read: "+this.g[this.i],8192),Wb(this.s,6),this.g[this.i++];r("3F5 read, empty",8192);return 255};
m.Uj=function(a){if(this.K)if(r("3F5 write "+K(a),8192),0<this.h){if(this.F[this.I++]=a,this.h--,0===this.h){a="3F5 command received: ";for(var b=0;b<this.I;b++)a+=K(this.F[b])+" ";r(a,8192);this.j.call(this,this.F)}}else{switch(a){case 3:this.j=this.oi;this.h=2;break;case 4:this.j=this.Sh;this.h=1;break;case 5:case 69:case 197:this.j=function(c){Bc(this,!0,c)};this.h=8;break;case 230:this.j=function(c){Bc(this,!1,c)};this.h=8;break;case 7:this.j=this.Rh;this.h=1;break;case 8:r("floppy check interrupt status",
8192);this.i=0;this.l=2;this.g[0]=32;this.g[1]=this.C;break;case 74:this.j=this.ik;this.h=1;break;case 15:this.h=2;this.j=this.Eh;break;case 14:r("dump registers",8192);this.g[0]=128;this.i=0;this.l=1;this.h=0;break;default:n(!1,"Unimplemented floppy command call "+K(a))}this.I=0}};m.Qj=function(){r("read 3F2: DOR",8192);return this.o};
m.Rj=function(a){4===(a&4)&&0===(this.o&4)&&this.s.Sa(6);r("start motors: "+K(a>>4),8192);r("enable dma: "+!!(a&8),8192);r("reset fdc: "+!!(a&4),8192);r("drive select: "+(a&3),8192);r("DOR = "+K(a),8192);this.o=a};m.Sh=function(){r("check drive status",8192);this.i=0;this.l=1;this.g[0]=32};m.Eh=function(a){r("seek",8192);n(0===(a[0]&3),"Unhandled seek drive");this.C=a[1];this.P=a[0]>>2&1;this.Da()};m.Rh=function(){r("floppy calibrate",8192);this.Da()};
function Bc(a,b,c){var e=c[2],d=c[1],f=c[3],k=128<<c[4],l=c[5]-c[3]+1,p=((e+a.D*d)*a.B+f-1)*k;r("Floppy "+(b?"Write":"Read"),8192);r("from "+K(p)+" length "+K(l*k),8192);r(d+" / "+e+" / "+f,8192);c[4]||r("FDC: sector count is zero, use data length instead",8192);a.K&&(b?a.lb.ke(a.K,p,l*k,2,a.done.bind(a,c,d,e,f)):Cc(a.lb,a.K,p,l*k,a.done.bind(a,c,d,e,f)))}
m.done=function(a,b,c,e,d){d||(e++,e>this.B&&(e=1,c++,c>=this.D&&(c=0,b++)),this.C=b,this.P=c,this.S=e,this.i=0,this.l=7,this.g[0]=c<<2|32,this.g[1]=0,this.g[2]=0,this.g[3]=b,this.g[4]=c,this.g[5]=e,this.g[6]=a[4],this.Da())};m.oi=function(a){r("floppy fix drive data "+a,8192)};m.ik=function(a){r("floppy read sector id "+a,8192);this.i=0;this.l=7;this.g[0]=0;this.g[1]=0;this.g[2]=0;this.g[3]=0;this.g[4]=0;this.g[5]=0;this.g[6]=0;this.Da()};m.Da=function(){this.o&8&&this.s.Sa(6)};function ta(a,b,c){n(b&&0<=b.length);b.length&&(n(!a.cf(c)),n(!a.cf(c+b.length-1)),a.Ai(c,c+b.length),a.Na.set(b,c))};function Dc(a){this.s=a;this.o=new Uint8Array(8);this.B=new Uint8Array(8);this.g=new Uint16Array(8);this.j=new Uint16Array(8);this.h=new Uint16Array(8);this.l=new Uint16Array(8);this.jc=new Uint8Array(8);this.C=new Uint8Array(8);this.xf=[];this.i=0;a=a.u;P(a,0,this,this.Rc.bind(this,0));P(a,2,this,this.Rc.bind(this,1));P(a,4,this,this.Rc.bind(this,2));P(a,6,this,this.Rc.bind(this,3));P(a,1,this,this.Tc.bind(this,0));P(a,3,this,this.Tc.bind(this,1));P(a,5,this,this.Tc.bind(this,2));P(a,7,this,this.Tc.bind(this,
3));N(a,0,this,this.Qc.bind(this,0));N(a,2,this,this.Qc.bind(this,1));N(a,4,this,this.Qc.bind(this,2));N(a,6,this,this.Qc.bind(this,3));N(a,1,this,this.Sc.bind(this,0));N(a,3,this,this.Sc.bind(this,1));N(a,5,this,this.Sc.bind(this,2));N(a,7,this,this.Sc.bind(this,3));P(a,192,this,this.Rc.bind(this,4));P(a,196,this,this.Rc.bind(this,5));P(a,200,this,this.Rc.bind(this,6));P(a,204,this,this.Rc.bind(this,7));P(a,194,this,this.Tc.bind(this,4));P(a,198,this,this.Tc.bind(this,5));P(a,202,this,this.Tc.bind(this,
6));P(a,206,this,this.Tc.bind(this,7));N(a,192,this,this.Qc.bind(this,4));N(a,196,this,this.Qc.bind(this,5));N(a,200,this,this.Qc.bind(this,6));N(a,204,this,this.Qc.bind(this,7));N(a,194,this,this.Sc.bind(this,4));N(a,198,this,this.Sc.bind(this,5));N(a,202,this,this.Sc.bind(this,6));N(a,206,this,this.Sc.bind(this,7));P(a,135,this,this.Vc.bind(this,0));P(a,131,this,this.Vc.bind(this,1));P(a,129,this,this.Vc.bind(this,2));P(a,130,this,this.Vc.bind(this,3));P(a,143,this,this.Vc.bind(this,4));P(a,139,
this,this.Vc.bind(this,5));P(a,137,this,this.Vc.bind(this,6));P(a,138,this,this.Vc.bind(this,7));N(a,135,this,this.Uc.bind(this,0));N(a,131,this,this.Uc.bind(this,1));N(a,129,this,this.Uc.bind(this,2));N(a,130,this,this.Uc.bind(this,3));N(a,143,this,this.Uc.bind(this,4));N(a,139,this,this.Uc.bind(this,5));N(a,137,this,this.Uc.bind(this,6));N(a,138,this,this.Uc.bind(this,7));P(a,1159,this,this.zd.bind(this,0));P(a,1155,this,this.zd.bind(this,1));P(a,1153,this,this.zd.bind(this,2));P(a,1154,this,this.zd.bind(this,
3));P(a,1163,this,this.zd.bind(this,5));P(a,1161,this,this.zd.bind(this,6));P(a,1162,this,this.zd.bind(this,7));N(a,1159,this,this.yd.bind(this,0));N(a,1155,this,this.yd.bind(this,1));N(a,1153,this,this.yd.bind(this,2));N(a,1154,this,this.yd.bind(this,3));N(a,1163,this,this.yd.bind(this,5));N(a,1161,this,this.yd.bind(this,6));N(a,1162,this,this.yd.bind(this,7));P(a,10,this,this.bh.bind(this,0));P(a,212,this,this.bh.bind(this,4));P(a,15,this,this.ah.bind(this,0));P(a,222,this,this.ah.bind(this,4));
N(a,15,this,this.$g.bind(this,0));N(a,222,this,this.$g.bind(this,4));P(a,11,this,this.Zg.bind(this,0));P(a,214,this,this.Zg.bind(this,4));P(a,12,this,this.Yg);P(a,216,this,this.Yg)}m=Dc.prototype;m.Y=function(){return[this.o,this.B,this.g,this.j,this.h,this.l,this.jc,this.C,this.i]};m.H=function(a){this.o=a[0];this.B=a[1];this.g=a[2];this.j=a[3];this.h=a[4];this.l=a[5];this.jc=a[6];this.C=a[7];this.i=a[8]};
m.Tc=function(a,b){r("count write ["+a+"] = "+K(b),16);this.h[a]=Ec(this,this.h[a],b,!1);this.l[a]=Ec(this,this.l[a],b,!0)};m.Sc=function(a){r("count read ["+a+"] -> "+K(this.h[a]),16);return Fc(this,this.h[a])};m.Rc=function(a,b){r("addr write ["+a+"] = "+K(b),16);this.g[a]=Ec(this,this.g[a],b,!1);this.j[a]=Ec(this,this.j[a],b,!0)};m.Qc=function(a){r("addr read ["+a+"] -> "+K(this.g[a]),16);return Fc(this,this.g[a])};m.zd=function(a,b){r("pagehi write ["+a+"] = "+K(b),16);this.B[a]=b};
m.yd=function(a){r("pagehi read ["+a+"]",16);return this.B[a]};m.Vc=function(a,b){r("page write ["+a+"] = "+K(b),16);this.o[a]=b};m.Uc=function(a){r("page read ["+a+"]",16);return this.o[a]};m.bh=function(a,b){a=(b&3)+a;b=b&4?1:0;r("singlechannel mask write ["+a+"] = "+b,16);Gc(this,a,b)};m.ah=function(a,b){r("multichannel mask write: "+K(b),16);for(var c=0;4>c;c++)Gc(this,a+c,b&1<<c)};
m.$g=function(a){var b=0|this.jc[a+0];b|=this.jc[a+1]<<1;b|=this.jc[a+2]<<2;b|=this.jc[a+3]<<3;r("multichannel mask read: "+K(b),16);return b};m.Zg=function(a,b){a=(b&3)+a;r("mode write ["+a+"] = "+K(b),16);this.C[a]=b};m.Yg=function(){r("flipflop reset",16);this.i=0};function Gc(a,b,c){if(a.jc[b]!==c&&(a.jc[b]=c,!c))for(r("firing on_unmask("+b+")",16),c=0;c<a.xf.length;c++)a.xf[c].Ze.call(a.xf[c].Xf,b)}
function Cc(a,b,c,e,d){var f=a.h[2]+1,k=Hc(a,2);r("DMA write channel 2",16);r("to "+K(k)+" len "+K(f),16);e<f&&r("DMA should read more than provided: "+K(e)+" "+K(f),16);if(c+f>b.byteLength)r("DMA read outside of buffer",16),d(!0);else{var l=a.s;a.g[2]+=f;b.get(c,f,function(p){ta(l,p,k);d(!1)})}}
m.ke=function(a,b,c,e,d){var f=this.h[e]+1&65535,k=5<=e?2:1,l=f*k,p=Hc(this,e),q=!1,t=!1,u=this.C[e]&16;r("DMA write channel "+e,16);r("to "+K(p)+" len "+K(l),16);c<l?(r("DMA should read more than provided",16),f=Math.floor(c/k),l=f*k,q=!0):c>l&&(r("DMA attempted to read more than provided",16),t=!0);b+l>a.byteLength?(r("DMA write outside of buffer",16),d(!0)):(this.g[e]+=f,this.h[e]-=f,!q&&u&&(r("DMA autoinit",16),this.g[e]=this.j[e],this.h[e]=this.l[e]),a.set(b,this.s.Na.subarray(p,p+l),()=>{t&&
u?(r("DMA continuing from start",16),this.ke(a,b+l,c-l,e,d)):d(!1)}))};function Hc(a,b){var c=a.g[b];5<=b&&(c<<=1);c=c&65535|a.o[b]<<16;return c|=a.B[b]<<24}function Ec(a,b,c,e){e||(a.i^=1);return a.i?b&-256|c:b&-65281|c<<8}function Fc(a,b){a.i^=1;return a.i?b&255:b>>8&255};function Ic(a,b){this.s=a;this.A=b;this.j=new Float64Array(3);this.h=new Uint16Array(3);this.g=new Uint8Array(4);this.i=new Uint8Array(4);this.gd=new Uint8Array(4);this.B=new Uint8Array(4);this.l=new Uint8Array(4);this.o=new Uint16Array(3);this.ab=new Uint16Array(3);N(a.u,97,this,function(){var c=Cb(),e=66.66666666666667*c&1;c=Jc(this,2,c);return e<<4|c<<5});P(a.u,97,this,function(c){c&1?this.A.send("pcspeaker-enable"):this.A.send("pcspeaker-disable")});N(a.u,64,this,function(){return Kc(this,0)});
N(a.u,65,this,function(){return Kc(this,1)});N(a.u,66,this,function(){return Kc(this,2)});P(a.u,64,this,function(c){Lc(this,0,c)});P(a.u,65,this,function(c){Lc(this,1,c)});P(a.u,66,this,function(c){Lc(this,2,c);this.A.send("pcspeaker-update",[this.gd[2],this.ab[2]])});P(a.u,67,this,this.C)}Ic.prototype.Y=function(){var a=[];a[0]=this.g;a[1]=this.i;a[2]=this.gd;a[3]=this.B;a[4]=this.l;a[5]=this.o;a[6]=this.ab;a[7]=this.j;a[8]=this.h;return a};
Ic.prototype.H=function(a){this.g=a[0];this.i=a[1];this.gd=a[2];this.B=a[3];this.l=a[4];this.o=a[5];this.ab=a[6];this.j=a[7];this.h=a[8]};Ic.prototype.Bb=function(a,b){var c=100;b||(this.i[0]&&Jc(this,0,a)?(this.h[0]=Mc(this,0,a),this.j[0]=a,r("pit interrupt. new value: "+this.h[0],512),Wb(this.s,0),this.s.Sa(0),0===this.gd[0]&&(this.i[0]=0)):Wb(this.s,0),this.i[0]&&(c=(this.h[0]-Math.floor(1193.1816666*(a-this.j[0])))/1193.1816666));return c};
function Mc(a,b,c){if(!a.i[b])return 0;var e=c-a.j[b],d=Math.floor(1193.1816666*e);c=a.h[b]-d;r("diff="+e+" dticks="+d+" value="+c+" reload="+a.ab[b],512);a=a.ab[b];c>=a?(r("Warning: Counter"+b+" value "+c+" is larger than reload "+a,512),c%=a):0>c&&(c=c%a+a);return c}function Jc(a,b,c){c-=a.j[b];return 0>c?(r("Warning: PIT timer difference is negative, resetting (timer "+b+")"),!0):a.h[b]<Math.floor(1193.1816666*c)}
function Kc(a,b){var c=a.l[b];if(c)return a.l[b]--,2===c?a.o[b]&255:a.o[b]>>8;c=a.g[b];3===a.gd[b]&&(a.g[b]^=1);a=Mc(a,b,Cb());return c?a&255:a>>8}function Lc(a,b,c){a.ab[b]=a.g[b]?a.ab[b]&-256|c:a.ab[b]&255|c<<8;3===a.B[b]&&a.g[b]||(a.ab[b]||(a.ab[b]=65535),a.h[b]=a.ab[b],a.i[b]=!0,a.j[b]=Cb(),r("counter"+b+" reload="+K(a.ab[b])+" tick="+(a.ab[b]||65536)/1193.1816666+"ms",512));3===a.B[b]&&(a.g[b]^=1)}
Ic.prototype.C=function(a){var b=a>>1&7,c=a&1,e=a>>6&3;a=a>>4&3;1===e&&r("Unimplemented timer1",512);3===e?r("Unimplemented read back",512):0===a?(this.l[e]=2,b=Mc(this,e,Cb()),r("latch: "+b,512),this.o[e]=b?b-1:0):(6<=b&&(b&=-5),r("Control: mode="+b+" ctr="+e+" read_mode="+a+" bcd="+c,512),this.g[e]=1===a?0:1,0===e&&Wb(this.s,0),0!==b&&3!==b&&2!==b&&r("Unimplemented counter mode: "+K(b),512),this.gd[e]=b,this.B[e]=a,2===e&&this.A.send("pcspeaker-update",[this.gd[2],this.ab[2]]))};var Nc=Uint32Array.from([655360,655360,720896,753664]),Oc=Uint32Array.from([131072,65536,32768,32768]);
function Pc(a,b,c){this.s=a;this.A=b;this.fa=c;this.F=0;this.Cc=14;this.Bc=15;this.K=80;this.Ib=25;this.Ie=this.Ka=this.Xd=this.vc=0;this.Pd=[];this.Mc=this.ya=0;this.Eb=new Uint8Array(25);this.D=this.P=this.Lc=this.S=this.h=this.j=this.Gb=this.Hb=this.La=0;this.Ec=!0;this.Ga=!1;setTimeout(()=>{b.send("screen-set-mode",this.Ga)},0);this.ib=new Int32Array(256);this.i=0;this.ue=45253;this.Ua=this.Ja=0;this.Pa=!1;this.Ea=32;this.Ed=this.vb=0;this.J=[52,18,17,17,3,1,0,0,0,0,0,3,0,0,0,0,8,14680064,57344,
224,0,0,0,0,0,0,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,190,254,0,0,0,0,0,0,0,0,0,0,0,0];this.Oa=144;this.gb=[{size:c}];this.Mg=65536;this.Ii=4272947200;this.name="vga";this.B={Cg:!1,jk:0,kk:0,fg:0};this.cb=this.Fb=this.$a=this.o=0;this.W=255;this.Mb=new Uint8Array(16);this.g=-1;this.dc=32;this.Ac=this.eb=this.fd=this.Wa=0;this.Va=-1;this.fc=15;this.Db=this.ic=0;this.aa=-1;this.ub=this.sc=this.Hc=0;this.Fc=255;this.la=this.V=this.U=this.tb=this.Gc=this.ec=0;this.l=this.pd=255;c=a.u;
P(c,960,this,this.tj);N(c,960,this,this.Ug,this.sj);N(c,961,this,this.Vg);P(c,962,this,this.uj);c.ac(964,this,this.wj,this.yj);N(c,964,this,this.vj);N(c,965,this,this.xj);c.ac(974,this,this.Jj,this.Lj);N(c,974,this,this.Ij);N(c,975,this,this.Kj);N(c,966,this,this.zj);P(c,966,this,this.Aj);P(c,967,this,this.Cj);N(c,967,this,this.Bj);P(c,968,this,this.Ej);N(c,968,this,this.Dj);P(c,969,this,this.Gj);N(c,969,this,this.Fj);N(c,972,this,this.Hj);c.ac(980,this,this.Nj,this.Oj);N(c,980,this,this.Mj);N(c,
981,this,this.Wg,()=>{r("Warning: 16-bit read from 3D5",256);return this.Wg()});N(c,970,this,function(){r("3CA read",256);return 0});N(c,986,this,this.Xg);N(c,954,this,this.Xg);this.X=-1;this.I=0;P(c,462,this,void 0,this.Ki);P(c,463,this,void 0,this.Mi);N(c,463,this,void 0,this.Li);void 0===this.fa||262144>this.fa?(this.fa=262144,r("vga memory size rounded up to "+this.fa,256)):this.fa&65535&&(this.fa|=65535,this.fa++);const e=a.Dh(this.fa);this.Wf=R(Uint8Array,a.Qa,e,this.fa);this.he=this.fa;this.ge=
0;this.je=this.fa;this.ie=0;this.Xb=null;b.register("screen-fill-buffer",function(){if(this.Ga){if(0===this.Xb.data.byteLength){var f=new Uint8ClampedArray(this.s.Qa.buffer,this.Bf,4*this.Ka*this.Ie);this.Xb=new ImageData(f,this.Ka,this.Ie);Qc(this)}if(this.Pa){f=0;var k=this.Ua;if(8===this.Ea)for(var l=new Int32Array(this.s.Qa.buffer,this.Bf,this.vc*this.Xd),p=new Uint8Array(this.s.Qa.buffer,this.Wf.byteOffset,this.fa),q=0;q<l.length;q++){var t=this.ib[p[q]];l[q]=t&65280|t<<16|t>>16|4278190080}else this.s.Hh(this.Ea,
this.Ed),q=15===this.Ea?2:this.Ea/8,f=((this.s.Gh[0]/q|0)-this.Ed)/this.Ja|0,k=(((this.s.Fh[0]/q|0)-this.Ed)/this.Ja|0)+1;f<k&&(f=Math.max(f,0),k=Math.min(k,this.Ua),this.A.send("screen-fill-buffer-end",[{Xb:this.Xb,Sf:0,Tf:f,Ne:0,Oe:f,zf:this.Ja,yf:k-f}]))}else{f=Math.min(this.ie|15,524287);q=Rc(this);t=~this.La&3;k=this.sc&96;l=this.Wa&64;for(p=this.je&-16;p<=f;){var u=p>>>q;if(t){var A=p/this.Ka|0,v=p-this.Ka*A;switch(t){case 1:u=(A&1)<<13;A>>>=1;break;case 2:u=(A&1)<<14;A>>>=1;break;case 3:u=
(A&3)<<13,A>>>=2}u|=(A*this.Ka+v>>>q)+this.ya}A=this.nf[u];v=this.pf[u];var w=this.qf[u],y=this.rf[u];u=new Uint8Array(8);switch(k){case 0:A<<=0;v<<=1;w<<=2;y<<=3;for(var z=7;0<=z;z--)u[7-z]=A>>z&1|v>>z&2|w>>z&4|y>>z&8;break;case 32:u[0]=A>>6&3|w>>4&12;u[1]=A>>4&3|w>>2&12;u[2]=A>>2&3|w>>0&12;u[3]=A>>0&3|w<<2&12;u[4]=v>>6&3|y>>4&12;u[5]=v>>4&3|y>>2&12;u[6]=v>>2&3|y>>0&12;u[7]=v>>0&3|y<<2&12;break;case 64:case 96:u[0]=A>>4&15,u[1]=A>>0&15,u[2]=v>>4&15,u[3]=v>>0&15,u[4]=w>>4&15,u[5]=w>>0&15,u[6]=y>>
4&15,u[7]=y>>0&15}if(l)for(A=z=0;4>z;z++,p++,A+=2)this.Td[p]=u[A]<<4|u[A+1];else for(z=0;8>z;z++,p++)this.Td[p]=u[z]}l=this.he;f=Math.min(this.ge,524287);k=new Int32Array(this.s.Qa.buffer,this.Bf,this.Ka*this.Ie);q=255;t=0;this.Wa&128&&(q&=207,t|=this.Ac<<4&48);if(this.Wa&64)for(;l<=f;l++)p=this.Td[l]&q|t,p=this.ib[p],k[l]=p&65280|p<<16|p>>16|4278190080;else for(q&=63,t|=this.Ac<<4&192;l<=f;l++)p=this.Mb[this.Td[l]&this.fd]&q|t,p=this.ib[p],k[l]=p&65280|p<<16|p>>16|4278190080;this.A.send("screen-fill-buffer-end",
this.Pd)}this.he=this.fa;this.ge=0;this.je=this.fa;this.ie=0}Sc(this)},this);this.C=new Uint8Array(262144);this.nf=new Uint8Array(this.C.buffer,0,65536);this.pf=new Uint8Array(this.C.buffer,65536,65536);this.qf=new Uint8Array(this.C.buffer,131072,65536);this.rf=new Uint8Array(this.C.buffer,196608,65536);this.Td=new Uint8Array(524288);var d=this;ub(c,655360,131072,function(f){return Tc(d,f)},function(f,k){if(d.Pa&&d.Ga&&d.Ec)d.s.Jd((f-655360|d.vb)+3758096384|0,k);else{var l=d.tb>>2&3;f-=Nc[l];if(0>
f||f>=Oc[l])r("vga write outside memory space: addr:"+K(f)+", value:"+K(k),256);else if(d.Ga){var p=k;k=Uc(d.Fc);var q=Vc(d.ec);l=Vc(d.Gc);switch(d.sc&3){case 0:p=(p|p<<8)>>>(d.ub&7)&255;var t=Uc(p);p=Vc(d.ec);t=Wc(d,(t|l&p)&(~l|p),d.i);t=k&t|~k&d.i;break;case 1:t=d.i;break;case 2:t=Vc(p);t=Wc(d,t,d.i);t=k&t|~k&d.i;break;case 3:p=(p|p<<8)>>>(d.ub&7)&255,k&=Uc(p),t=k&q|~k&d.i}k=15;switch(d.ic&12){case 0:k=5<<(f&1);f&=-2;break;case 8:case 12:k=1<<(f&3),f&=-4}k&=d.fc;k&1&&(d.nf[f]=t>>0&255);k&2&&(d.pf[f]=
t>>8&255);k&4&&(d.qf[f]=t>>16&255);k&8&&(d.rf[f]=t>>24&255);k=Xc(d,f);t=k+7;k<d.je&&(d.je=k);t>d.ie&&(d.ie=t);k<d.he&&(d.he=k);t>d.ge&&(d.ge=t)}else d.fc&3&&(t=f,l=(t>>1)-d.ya,f=l/d.K|0,l%=d.K,t&1?(q=k,p=d.C[t&-2]):(p=k,q=d.C[t|1]),d.A.send("screen-put-char",[f,l,p,d.ib[d.W&d.Mb[q>>4&15]],d.ib[d.W&d.Mb[q&15]]]),d.C[t]=k)}});fc(a.v.Ta,this)}m=Pc.prototype;
m.Y=function(){var a=[];a[0]=this.fa;a[1]=this.F;a[2]=this.Cc;a[3]=this.Bc;a[4]=this.K;a[5]=this.Ib;a[6]=this.C;a[7]=this.cb;a[8]=this.ya;a[9]=this.Ga;a[10]=this.ib;a[11]=this.i;a[12]=this.U;a[13]=this.V;a[14]=this.tb;a[15]=this.Ja;a[16]=this.Ua;a[17]=this.La;a[18]=this.Pa;a[19]=this.Ea;a[20]=this.vb;a[21]=this.Ed;a[22]=this.o;a[23]=this.$a;a[24]=this.Fb;a[25]=this.Mb;a[26]=this.Va;a[27]=this.fc;a[28]=this.ic;a[29]=this.aa;a[30]=this.Hc;a[31]=this.sc;a[32]=this.ub;a[33]=this.Fc;a[34]=this.la;a[35]=
this.pd;a[36]=this.l;a[37]=this.X;a[38]=this.I;a[39]=this.Wf;a[40]=this.Ec;a[41]=this.g;a[42]=this.P;a[43]=this.ec;a[44]=this.Gc;a[45]=this.Mc;a[46]=this.Eb;a[47]=this.Hb;a[48]=this.Gb;a[49]=this.j;a[50]=this.h;a[51]=this.S;a[52]=this.Lc;a[53]=this.P;a[54]=this.dc;a[55]=this.Wa;a[56]=this.fd;a[57]=this.eb;a[58]=this.Ac;a[59]=this.Db;a[60]=this.D;a[61]=this.Td;a[62]=this.W;return a};
m.H=function(a){this.fa=a[0];this.F=a[1];this.Cc=a[2];this.Bc=a[3];this.K=a[4];this.Ib=a[5];a[6]&&this.C.set(a[6]);this.cb=a[7];this.ya=a[8];this.Ga=a[9];this.ib=a[10];this.i=a[11];this.U=a[12];this.V=a[13];this.tb=a[14];this.Ja=a[15];this.Ua=a[16];this.La=a[17];this.Pa=a[18];this.Ea=a[19];this.vb=a[20];this.Ed=a[21];this.o=a[22];this.$a=a[23];this.Fb=a[24];this.Mb=a[25];this.Va=a[26];this.fc=a[27];this.ic=a[28];this.aa=a[29];this.Hc=a[30];this.sc=a[31];this.ub=a[32];this.Fc=a[33];this.la=a[34];this.pd=
a[35];this.l=a[36];this.X=a[37];this.I=a[38];this.Wf.set(a[39]);this.Ec=a[40];this.g=a[41];this.P=a[42];this.ec=a[43];this.Gc=a[44];this.Mc=a[45];this.Eb.set(a[46]);this.Hb=a[47];this.Gb=a[48];this.j=a[49];this.h=a[50];this.S=a[51];this.Lc=a[52];this.P=a[53];this.dc=a[54];this.Wa=a[55];this.fd=a[56];this.eb=a[57];this.Ac=a[58];this.Db=a[59];this.D=a[60];a[61]&&this.Td.set(a[61]);this.W=void 0===a[62]?255:a[62];this.A.send("screen-set-mode",this.Ga);this.Ga?(this.Xd=this.vc=0,this.Pa?(this.Bd(this.Ja,
this.Ua,this.Ea,this.Ja,this.Ua),Qc(this)):(Yc(this),Qc(this),Zc(this))):(this.Cd(this.K,this.Ib),this.Hd(),this.Gd());$c(this)};
function Tc(a,b){if(a.Pa&&a.Ec)return a.s.Ia((b-655360|a.vb)+3758096384|0);var c=a.tb>>2&3;b-=Nc[c];if(0>b||b>=Oc[c])return r("vga read outside memory space: addr:"+K(b),256),0;a.i=a.nf[b];a.i|=a.pf[b]<<8;a.i|=a.qf[b]<<16;a.i|=a.rf[b]<<24;if(a.sc&8)return c=255,a.V&1&&(c&=a.nf[b]^~(a.U&1?255:0)),a.V&2&&(c&=a.pf[b]^~(a.U&2?255:0)),a.V&4&&(c&=a.qf[b]^~(a.U&4?255:0)),a.V&8&&(c&=a.rf[b]^~(a.U&8?255:0)),c;c=a.Hc;a.Ga?a.ic&8?(c=b&3,b&=-4):a.sc&16&&(c=b&1,b&=-2):c=0;return a.C[c<<16|b]}
function Uc(a){return a|a<<8|a<<16|a<<24}function Vc(a){return(a&1?255:0)|(a&2?255:0)<<8|(a&4?255:0)<<16|(a&8?255:0)<<24}function Wc(a,b,c){switch(a.ub&24){case 8:return b&c;case 16:return b|c;case 24:return b^c}return b}function ad(a){for(var b=a.ya<<1,c,e,d=0;d<a.Ib;d++)for(var f=0;f<a.K;f++)c=a.C[b],e=a.C[b|1],a.A.send("screen-put-char",[d,f,c,a.ib[a.W&a.Mb[e>>4&15]],a.ib[a.W&a.Mb[e&15]]]),b+=2}
m.Gd=function(){var a=(this.F-this.ya)/this.K|0,b=(this.F-this.ya)%this.K;a=Math.min(this.Ib-1,a);this.A.send("screen-update-cursor",[a,b])};function $c(a){r("complete redraw",256);a.Ga?a.Pa?a.s.Jg():(a.he=0,a.ge=524288):ad(a)}function Zc(a){r("complete replot",256);a.Ga&&!a.Pa&&(a.je=0,a.ie=524288,$c(a))}m.va=function(){};function Rc(a){var b=128+(~a.S&a.La&64);b-=a.S&64;b-=a.Wa&64;return b>>>6}
function Xc(a,b){var c=Rc(a);if(~a.La&3){var e=b-a.ya;e&=a.La<<13|-24577;e<<=c;var d=e/a.Ka|0;e%=a.Ka;switch(a.La&3){case 2:d=d<<1|b>>13&1;break;case 1:d=d<<1|b>>14&1;break;case 0:d=d<<2|b>>13&3}return d*a.Ka+e+(a.ya<<c)}return b<<c}function bd(a,b){a.la&128&&(b>>>=1);b=Math.ceil(b/(1+(a.la&31)));a.La&1||(b<<=1);a.La&2||(b<<=1);return b}m.Cd=function(a,b){this.K=a;this.Ib=b;this.A.send("screen-set-size-text",[a,b])};
m.Bd=function(a,b,c,e,d){if(!this.B.Cg||this.B.fg!==c||this.vc!==a||this.Xd!==b||this.Ka!==e||this.Ie!==d){this.vc=a;this.Xd=b;this.Ka=e;this.Ie=d;this.B.fg=c;this.B.Cg=!0;this.B.jk=a;this.B.kk=b;if("undefined"!==typeof ImageData){const f=e*d,k=this.s.Ch(f)>>>0;this.Bf=k;this.Xb=new ImageData(new Uint8ClampedArray(this.s.Qa.buffer,k,4*f),e,d);this.s.Jg()}this.A.send("screen-set-size-graphical",[a,b,e,d,c])}};
function Yc(a){if(!a.Pa){var b=Math.min(1+a.Hb,a.Gb),c=Math.min(1+a.j,a.h);if(b&&c)if(a.Ga){b<<=3;var e=a.P<<4;a.Wa&64&&(b>>>=1,e>>>=1);var d=a.P<<2;a.S&64?d<<=1:a.La&64&&(d>>>=1);a.Bd(b,bd(a,c),8,e,Math.ceil(Oc[0]/d));Sc(a);Qc(a)}else a.la&128&&(c>>>=1),c=c/(1+(a.la&31))|0,b&&c&&a.Cd(b,c)}}
function Qc(a){a.Ga||ad(a);if(a.Pa)a.Pd=[];else if(a.Ka&&a.vc)if(!a.dc||a.Db&32)a.Pd=[],a.A.send("screen-clear");else{var b=a.Mc,c=a.eb;a.Wa&64&&(c>>>=1);var e=a.Lc>>5&3,d=Xc(a,b+e);b=d/a.Ka|0;var f=d%a.Ka+c;d=bd(a,1+a.D);d=Math.min(d,a.Xd);var k=a.Xd-d;a.Pd=[];f=-f;for(var l=0;f<a.vc;f+=a.Ka,l++)a.Pd.push({Xb:a.Xb,Sf:f,Tf:0,Ne:0,Oe:b+l,zf:a.Ka,yf:d});b=0;a.Wa&32||(b=Xc(a,e)+c);f=-b;for(l=0;f<a.vc;f+=a.Ka,l++)a.Pd.push({Xb:a.Xb,Sf:f,Tf:d,Ne:0,Oe:l,zf:a.Ka,yf:k})}}
function Sc(a){a.l|=8;a.Mc!==a.ya&&(a.Mc=a.ya,Qc(a))}m.Hd=function(){this.A.send("screen-update-cursor-scanline",[this.Cc,this.Bc])};
m.tj=function(a){if(-1===this.g)r("attribute controller index register: "+K(a),256),this.g=a&31,r("attribute actual index: "+K(this.g),256),this.dc!==(a&32)&&(this.dc=a&32,Qc(this));else{if(16>this.g)r("internal palette: "+K(this.g)+" -> "+K(a),256),this.Mb[this.g]=a,this.Wa&64||$c(this);else switch(this.g){case 16:r("3C0 / attribute mode control: "+K(a),256);if(this.Wa!==a){var b=this.Wa;this.Wa=a;var c=0<(a&1);this.Pa||this.Ga===c||(this.Ga=c,this.A.send("screen-set-mode",this.Ga));(b^a)&64&&Zc(this);
Yc(this);$c(this)}break;case 18:r("3C0 / color plane enable: "+K(a),256);this.fd!==a&&(this.fd=a,$c(this));break;case 19:r("3C0 / horizontal panning: "+K(a),256);this.eb!==a&&(this.eb=a&15,Qc(this));break;case 20:r("3C0 / color select: "+K(a),256);this.Ac!==a&&(this.Ac=a,$c(this));break;default:r("3C0 / attribute controller write "+K(this.g)+": "+K(a),256)}this.g=-1}};m.Ug=function(){r("3C0 read",256);return this.g|this.dc};m.sj=function(){r("3C0 read16",256);return this.Ug()&255|this.Vg()<<8&65280};
m.Vg=function(){if(16>this.g)return r("3C1 / internal palette read: "+K(this.g)+" -> "+K(this.Mb[this.g]),256),this.Mb[this.g]&255;switch(this.g){case 16:return r("3C1 / attribute mode read: "+K(this.Wa),256),this.Wa;case 18:return r("3C1 / color plane enable read: "+K(this.fd),256),this.fd;case 19:return r("3C1 / horizontal panning read: "+K(this.eb),256),this.eb;case 20:return r("3C1 / color select read: "+K(this.Ac),256),this.Ac;default:r("3C1 / attribute controller read "+K(this.g),256)}return 255};
m.uj=function(a){r("3C2 / miscellaneous output register = "+K(a),256);this.pd=a};m.wj=function(a){this.Va=a};m.vj=function(){return this.Va};m.yj=function(a){switch(this.Va){case 1:r("clocking mode: "+K(a),256);var b=this.Db;this.Db=a;(b^a)&32&&Qc(this);break;case 2:r("plane write mask: "+K(a),256);this.fc=a;break;case 4:r("sequencer memory mode: "+K(a),256);this.ic=a;break;default:r("3C5 / sequencer write "+K(this.Va)+": "+K(a),256)}};
m.xj=function(){r("3C5 / sequencer read "+K(this.Va),256);switch(this.Va){case 1:return this.Db;case 2:return this.fc;case 4:return this.ic;case 6:return 18}return 0};m.Aj=function(a){this.W=a};m.zj=function(){return this.W};m.Cj=function(a){r("3C7 write: "+K(a),256);this.Fb=3*a;this.cb&=0};m.Bj=function(){return this.cb};m.Ej=function(a){this.$a=3*a;this.cb|=3};m.Dj=function(){return this.$a/3&255};
m.Gj=function(a){var b=this.$a/3|0,c=this.$a%3,e=this.ib[b];if(0===(this.I&32)){a&=63;const d=a&1;a=a<<2|d<<1|d}0===c?e=e&-16711681|a<<16:1===c?e=e&-65281|a<<8:(e=e&-256|a,r("dac set color, index="+K(b)+" value="+K(e),256));this.ib[b]!==e&&(this.ib[b]=e,$c(this));this.$a++};m.Fj=function(){r("3C9 read",256);var a=this.ib[this.Fb/3|0]>>8*(2-this.Fb%3)&255;this.Fb++;return this.I&32?a:a>>2};m.Hj=function(){r("3CC read",256);return this.pd};m.Jj=function(a){this.aa=a};m.Ij=function(){return this.aa};
m.Lj=function(a){switch(this.aa){case 0:this.ec=a;r("plane set/reset: "+K(a),256);break;case 1:this.Gc=a;r("plane set/reset enable: "+K(a),256);break;case 2:this.U=a;r("color compare: "+K(a),256);break;case 3:this.ub=a;r("plane rotate: "+K(a),256);break;case 4:this.Hc=a;r("plane read: "+K(a),256);break;case 5:var b=this.sc;this.sc=a;r("planar mode: "+K(a),256);(b^a)&96&&Zc(this);break;case 6:r("miscellaneous graphics register: "+K(a),256);this.tb!==a&&(this.tb=a,Yc(this));break;case 7:this.V=a;r("color don't care: "+
K(a),256);break;case 8:this.Fc=a;r("planar bitmap: "+K(a),256);break;default:r("3CF / graphics write "+K(this.aa)+": "+K(a),256)}};m.Kj=function(){r("3CF / graphics read "+K(this.aa),256);switch(this.aa){case 0:return this.ec;case 1:return this.Gc;case 2:return this.U;case 3:return this.ub;case 4:return this.Hc;case 5:return this.sc;case 6:return this.tb;case 7:return this.V;case 8:return this.Fc}return 0};m.Nj=function(a){r("3D4 / crtc index: "+a,256);this.o=a};
m.Mj=function(){r("3D4 read / crtc index: "+this.o,256);return this.o};
m.Oj=function(a){switch(this.o){case 1:r("3D5 / hdisp enable end write: "+K(a),256);this.Hb!==a&&(this.Hb=a,Yc(this));break;case 2:this.Gb!==a&&(this.Gb=a,Yc(this));break;case 7:r("3D5 / overflow register write: "+K(a),256);var b=this.j;this.j&=255;this.j=this.j|a<<3&512|a<<7&256;b!=this.j&&Yc(this);this.D=this.D&767|a<<4&256;b=this.h;this.h=this.h&767|a<<5&256;b!==this.h&&Yc(this);Qc(this);break;case 8:r("3D5 / preset row scan write: "+K(a),256);this.Lc=a;Qc(this);break;case 9:r("3D5 / max scan line write: "+
K(a),256);this.la=a;this.D=this.D&511|a<<3&512;b=this.h;this.h=this.h&511|a<<4&512;b!==this.h&&Yc(this);Qc(this);break;case 10:r("3D5 / cursor scanline start write: "+K(a),256);this.Cc=a;this.Hd();break;case 11:r("3D5 / cursor scanline end write: "+K(a),256);this.Bc=a;this.Hd();break;case 12:(this.ya>>8&255)!==a&&(this.ya=this.ya&255|a<<8,Qc(this),~this.La&3&&Zc(this));r("3D5 / start addr hi write: "+K(a)+" -> "+K(this.ya,4),256);break;case 13:(this.ya&255)!==a&&(this.ya=this.ya&65280|a,Qc(this),
~this.La&3&&Zc(this));r("3D5 / start addr lo write: "+K(a)+" -> "+K(this.ya,4),256);break;case 14:r("3D5 / cursor address hi write: "+K(a),256);this.F=this.F&255|a<<8;this.Gd();break;case 15:r("3D5 / cursor address lo write: "+K(a),256);this.F=this.F&65280|a;this.Gd();break;case 18:r("3D5 / vdisp enable end write: "+K(a),256);(this.j&255)!==a&&(this.j=this.j&768|a,Yc(this));break;case 19:r("3D5 / offset register write: "+K(a),256);this.P!==a&&(this.P=a,Yc(this),~this.La&3&&Zc(this));break;case 20:r("3D5 / underline location write: "+
K(a),256);this.S!==a&&(b=this.S,this.S=a,Yc(this),(b^a)&64&&Zc(this));break;case 21:r("3D5 / vertical blank start write: "+K(a),256);(this.h&255)!==a&&(this.h=this.h&768|a,Yc(this));break;case 23:r("3D5 / crtc mode write: "+K(a),256);this.La!==a&&(b=this.La,this.La=a,Yc(this),(b^a)&67&&Zc(this));break;case 24:r("3D5 / line compare write: "+K(a),256);this.D=this.D&768|a;Qc(this);break;default:this.o<this.Eb.length&&(this.Eb[this.o]=a),r("3D5 / CRTC write "+K(this.o)+": "+K(a),256)}};
m.Wg=function(){r("3D5 read "+K(this.o),256);switch(this.o){case 1:return this.Hb;case 2:return this.Gb;case 7:return this.j>>7&2|this.h>>5&8|this.D>>4&16|this.j>>3&64;case 8:return this.Lc;case 9:return this.la;case 10:return this.Cc;case 11:return this.Bc;case 12:return this.ya&255;case 13:return this.ya>>8;case 14:return this.F>>8;case 15:return this.F&255;case 18:return this.j&255;case 19:return this.P;case 20:return this.S;case 21:return this.h&255;case 23:return this.La;case 24:return this.D&
255}return this.o<this.Eb.length?this.Eb[this.o]:0};m.Xg=function(){r("3DA read - status 1 and clear attr index",256);var a=this.l;this.Ga?(this.l^=1,this.l&=1):(this.l&1&&(this.l^=8),this.l^=1);this.g=-1;return a};m.Ki=function(a){this.X=a};
m.Mi=function(a){r("1CF / dispi write "+K(this.X)+": "+K(a),256);switch(this.X){case 0:45248<=a&&45253>=a?this.ue=a:r("Invalid version value: "+K(a),256);break;case 1:this.Ja=a;2560<this.Ja&&(r("svga_width reduced from "+this.Ja+" to 2560",256),this.Ja=2560);break;case 2:this.Ua=a;1600<this.Ua&&(r("svga_height reduced from "+this.Ua+" to 1600",256),this.Ua=1600);break;case 3:this.Ea=a;break;case 4:this.Pa=1===(a&1);this.I=a;break;case 5:r("SVGA bank offset: "+K(a<<16),256);this.vb=a<<16;break;case 9:const b=
a*this.Ja;r("SVGA offset: "+K(b)+" y="+K(a),256);this.Ed!==b&&(this.Ed=b,$c(this))}!this.Pa||this.Ja&&this.Ua||(r("SVGA: disabled because of invalid width/height: "+this.Ja+"x"+this.Ua,256),this.Pa=!1);n(4!==this.Ea,"unimplemented svga bpp: 4");n(4===this.Ea||8===this.Ea||15===this.Ea||16===this.Ea||24===this.Ea||32===this.Ea,"unexpected svga bpp: "+this.Ea);r("SVGA: enabled="+this.Pa+", "+this.Ja+"x"+this.Ua+"x"+this.Ea,256);this.Pa&&4===this.X&&(this.Bd(this.Ja,this.Ua,this.Ea,this.Ja,this.Ua),
this.A.send("screen-set-mode",!0),this.Ec=this.Ga=!0);this.Pa||(this.vb=0);Qc(this)};m.Li=function(){r("1CF / dispi read "+K(this.X),256);return cd(this,this.X)};function cd(a,b){switch(b){case 0:return a.ue;case 1:return a.I&2?2560:a.Ja;case 2:return a.I&2?1600:a.Ua;case 3:return a.I&2?32:a.Ea;case 4:return a.I;case 5:return a.vb>>>16;case 6:return a.vc?a.vc:1;case 8:return 0;case 10:return a.fa/65536|0}return 255};function dd(a,b){this.s=a;this.A=b;this.Id=this.Dc=!1;this.re=!0;this.td=this.$b=this.Zb=0;this.la=!0;this.S=this.P=this.F=this.K=this.U=this.I=this.le=!1;this.ia=new Nb(1024);this.l=0;this.Zc=100;this.i=this.j=0;this.C=!1;this.cc=0;this.Xc=4;this.B=!1;this.g=new Nb(1024);this.D=this.o=!1;this.A.register("keyboard-code",function(c){this.le&&(r("adding kbd code: "+K(c),64),this.ia.push(c),this.Da())},this);this.A.register("mouse-click",function(c){this.re&&this.Id&&(this.td=c[0]|c[2]<<1|c[1]<<2,this.Dc&&
ed(this,0,0))},this);this.A.register("mouse-delta",function(c){var e=c[1];if(this.re&&this.Id){var d=this.Xc*this.Zc/80;this.Zb+=c[0]*d;this.$b+=e*d;this.Dc&&(c=this.Zb|0,e=this.$b|0,c||e)&&(this.Zb-=c,this.$b-=e,ed(this,c,e))}},this);this.A.register("mouse-wheel",function(c){this.cc-=c[0];this.cc-=2*c[1];this.cc=Math.min(7,Math.max(-8,this.cc));ed(this,0,0)},this);this.h=5;this.aa=0;this.W=this.V=this.X=!1;N(a.u,96,this,this.bk);N(a.u,100,this,this.dk);P(a.u,96,this,this.ck);P(a.u,100,this,this.ek)}
m=dd.prototype;m.Y=function(){var a=[];a[0]=this.Dc;a[1]=this.Id;a[2]=this.re;a[3]=this.Zb;a[4]=this.$b;a[5]=this.td;a[6]=this.la;a[7]=this.le;a[8]=this.I;a[9]=this.U;a[10]=this.K;a[11]=this.F;a[12]=this.P;a[13]=this.S;a[15]=this.l;a[16]=this.Zc;a[17]=this.Xc;a[18]=this.B;a[20]=this.h;a[21]=this.X;a[22]=this.V;a[23]=this.aa;a[24]=this.W;a[25]=this.i;a[26]=this.j;a[27]=this.C;return a};
m.H=function(a){this.Dc=a[0];this.Id=a[1];this.re=a[2];this.Zb=a[3];this.$b=a[4];this.td=a[5];this.la=a[6];this.le=a[7];this.I=a[8];this.U=a[9];this.K=a[10];this.F=a[11];this.P=a[12];this.S=a[13];this.l=a[15];this.Zc=a[16];this.Xc=a[17];this.B=a[18];this.h=a[20];this.X=a[21];this.V=a[22];this.aa=a[23];this.W=a[24];this.i=a[25]||0;this.j=a[26]||0;this.C=a[27]||!1;this.D=this.o=!1;this.ia.clear();this.g.clear();this.A.send("mouse-enable",this.Id)};
m.Da=function(){this.o||(this.ia.length?fd(this):this.g.length&&gd(this))};function gd(a){a.o=!0;a.D=!0;a.h&2&&(r("Mouse irq",64),Wb(a.s,12),a.s.Sa(12))}function fd(a){a.o=!0;a.D=!1;a.h&1&&(r("Keyboard irq",64),Wb(a.s,1),a.s.Sa(1))}function ed(a,b,c){a.g.push((0>c)<<5|(0>b)<<4|8|a.td);a.g.push(b);a.g.push(c);4===a.i?(a.g.push(0|a.cc&15),a.cc=0):3===a.i&&(a.g.push(a.cc&255),a.cc=0);a.Da()}
m.bk=function(){this.o=!1;if(!this.ia.length&&!this.g.length)return r("Port 60 read: Empty",64),this.l;this.D?(Wb(this.s,12),this.l=this.g.shift(),r("Port 60 read (mouse): "+K(this.l),64)):(Wb(this.s,1),this.l=this.ia.shift(),r("Port 60 read (kbd)  : "+K(this.l),64));(this.ia.length||this.g.length)&&this.Da();return this.l};m.dk=function(){var a=16;this.o&&(a|=1);this.D&&(a|=32);r("port 64 read: "+K(a),64);return a};
m.ck=function(a){r("port 60 write: "+K(a),64);if(this.V)this.h=a,this.V=!1,r("Keyboard command register = "+K(this.h),64);else if(this.X)this.X=!1,this.g.clear(),this.g.push(a),gd(this);else if(this.U){this.U=!1;this.g.clear();this.g.push(250);this.Zc=a;switch(this.j){case -1:60===a?(this.C=!0,this.j=0):(this.C=!1,this.j=200===a?1:0);break;case 0:200===a&&(this.j=1);break;case 1:this.j=100===a?2:200===a?3:0;break;case 2:80===a&&(this.i=3);this.j=-1;break;case 3:80===a&&(this.i=4),this.j=-1}r("mouse sample rate: "+
K(a)+", mouse id: "+K(this.i),64);this.Zc||(r("invalid sample rate, reset to 100",64),this.Zc=100);gd(this)}else if(this.S)this.S=!1,this.g.clear(),this.g.push(250),3<a?(this.Xc=4,r("invalid resolution, resetting to 4",64)):(this.Xc=1<<a,r("resolution: "+this.Xc,64)),gd(this);else if(this.K)this.K=!1,this.ia.push(250),fd(this);else if(this.F)this.F=!1,this.ia.push(250),fd(this),a||this.ia.push(2);else if(this.P)this.P=!1,this.ia.push(250),fd(this);else if(this.I){if(this.I=!1,r("Port 60 data register write: "+
K(a),64),this.re){this.ia.clear();this.g.clear();this.g.push(250);switch(a){case 230:r("Scaling 1:1",64);this.B=!1;break;case 231:r("Scaling 2:1",64);this.B=!0;break;case 232:this.S=!0;break;case 233:ed(this,0,0);break;case 235:r("unimplemented request single packet",64);ed(this,0,0);break;case 242:r("required id: "+K(this.i),64);this.g.push(this.i);this.td=this.Zb=this.$b=0;this.Da();break;case 243:this.U=!0;break;case 244:this.Id=this.Dc=!0;this.A.send("mouse-enable",!0);this.td=this.Zb=this.$b=
0;break;case 245:this.Dc=!1;break;case 246:this.Dc=!1;this.Zc=100;this.B=!1;this.Xc=4;break;case 255:r("Mouse reset",64);this.g.push(170);this.g.push(0);this.Id=!0;this.A.send("mouse-enable",!0);this.Dc=!1;this.Zc=100;this.B=!1;this.Xc=4;this.C||(this.i=0);this.td=this.Zb=this.$b=0;break;default:r("Unimplemented mouse command: "+K(a),64)}gd(this)}}else if(this.W)this.W=!1,this.aa=a;else{r("Port 60 data register write: "+K(a),64);this.g.clear();this.ia.clear();this.ia.push(250);switch(a){case 237:this.K=
!0;break;case 240:this.F=!0;break;case 242:this.ia.push(171);this.ia.push(83);break;case 243:this.P=!0;break;case 244:r("kbd enable scanning",64);this.le=!0;break;case 245:r("kbd disable scanning",64);this.le=!1;break;case 246:break;case 255:this.ia.clear();this.ia.push(250);this.ia.push(170);this.ia.push(0);break;default:r("Unimplemented keyboard command: "+K(a),64)}fd(this)}};
m.ek=function(a){r("port 64 write: "+K(a),64);switch(a){case 32:this.ia.clear();this.g.clear();this.ia.push(this.h);fd(this);break;case 96:this.V=!0;break;case 209:this.W=!0;break;case 211:this.X=!0;break;case 212:this.I=!0;break;case 167:r("Disable second port",64);this.h|=32;break;case 168:r("Enable second port",64);this.h&=-33;break;case 169:this.ia.clear();this.g.clear();this.ia.push(0);fd(this);break;case 170:this.ia.clear();this.g.clear();this.ia.push(85);fd(this);break;case 171:this.ia.clear();
this.g.clear();this.ia.push(0);fd(this);break;case 173:r("Disable Keyboard",64);this.h|=16;break;case 174:r("Enable Keyboard",64);this.h&=-17;break;case 254:r("CPU reboot via PS2");yc(this.s);break;default:r("port 64: Unimplemented command byte: "+K(a),64)}};function hd(a,b){this.i=this.g=this.R=this.C=this.j=0;this.h=-1;this.ja=b;this.D=void 0===this.ja;this.ka=void 0;this.name=this.D?"master":"slave ";this.F=!1;this.I=this.state=0;this.o=1;this.B=this.K=0;this.s=a;this.D?(this.ka=new hd(this.s,this),this.l=function(){if(0<=this.h)Eb(this.s);else{var c=this.g&this.j;if(c){c&=-c;var e=this.K?this.j:-1;this.R&&(this.R&-this.R&e)<=c?r("master> higher prio: isr="+K(this.R,2)+" mask="+K(this.j&255,2)+" irq="+K(c,2),128):(n(0!==c),e=Gb(c),n(c===1<<e),this.h=
e,Eb(this.s))}}},this.de=function(){if(-1!==this.h)if(0===this.g)this.h=-1;else{n(this.g);n(0<=this.h);var c=1<<this.h;0===(this.B&c)&&(this.g&=~c);this.o||(this.R|=c);2===this.h?this.ka.de():this.s.I(this.C|this.h);this.h=-1;this.l()}}):(this.l=function(){if(0<=this.h)Eb(this.s);else{var c=this.g&this.j;if(c){c&=-c;var e=this.K?this.j:-1;this.R&&(this.R&-this.R&e)<=c||(n(0!==c),e=Gb(c),n(c===1<<e),this.h=e,this.ja.Zd(2))}}},this.de=function(){if(-1!==this.h)if(0===this.g)this.h=-1,this.ja.i&=-5,
this.s.I(this.C|7);else{n(this.g);n(0<=this.h);var c=1<<this.h;0===(this.B&c)&&(this.g&=~c);this.o||(this.R|=c);this.ja.i&=-5;this.s.I(this.C|this.h);this.h=-1;this.l()}});this.D?(a=32,b=1232):(a=160,b=1233);P(this.s.u,a,this,this.Oi);N(this.s.u,a,this,this.Ni);P(this.s.u,a|1,this,this.Qi);N(this.s.u,a|1,this,this.Pi);P(this.s.u,b,this,this.ak);N(this.s.u,b,this,this.$j);this.D?(this.Zd=function(c){n(0<=c&&16>c);8<=c?this.ka.Zd(c-8):(c=1<<c,0===(this.i&c)&&(this.g|=c,this.i|=c,this.l()))},this.ee=
function(c){n(0<=c&&16>c);8<=c?this.ka.ee(c-8):(c=1<<c,this.i&c&&(this.i&=~c,this.g&=~c,this.l()))}):(this.Zd=function(c){n(0<=c&&8>c);c=1<<c;0===(this.i&c)&&(this.g|=c,this.i|=c,this.l())},this.ee=function(c){n(0<=c&&8>c);c=1<<c;this.i&c&&(this.i&=~c,this.g&=~c,this.l())})}m=hd.prototype;m.Y=function(){var a=[];a[0]=this.j;a[1]=this.C;a[2]=this.R;a[3]=this.g;a[4]=this.D;a[5]=this.ka;a[6]=this.F;a[7]=this.state;a[8]=this.I;a[9]=this.o;a[10]=this.B;return a};
m.H=function(a){this.j=a[0];this.C=a[1];this.R=a[2];this.g=a[3];this.D=a[4];this.ka&&this.ka.H(a[5]);this.F=a[6];this.state=a[7];this.I=a[8];this.o=a[9];this.B=a[10]};
m.Oi=function(a){if(a&16)r("icw1 = "+K(a),128),this.i=this.j=this.g=this.R=0,this.o=1,this.h=-1,this.F=a&1,this.state=1;else if(a&8)r("ocw3: "+K(a),128),a&2&&(this.I=a&1),a&4&&n(!1,"unimplemented: polling"),a&64&&(this.K=32===(a&32),r("special mask mode: "+this.K,128));else{r("eoi: "+K(a)+" ("+this.name+")",128);var b=a>>5;1===b?(this.R&=this.R-1,r("new isr: "+K(this.R,2),128)):3===b?this.R&=~(1<<(a&7)):192===(a&200)?r("lowest priority: "+K(a&7),128):(r("Unknown eoi: "+K(a),128),n(!1),this.R&=this.R-
1);this.l()}};m.Ni=function(){if(this.I)return r("read port 20h (isr): "+K(this.R),128),this.R;r("read port 20h (irr): "+K(this.g),128);return this.g};m.Qi=function(a){0===this.state?this.F?(this.F=!1,this.o=a&2,r("icw4: "+K(a)+" autoeoi="+this.o,128),0===(a&1)&&n(!1,"unimplemented: not 8086 mode")):(this.j=~a,this.l()):1===this.state?(this.C=a,r("interrupts are mapped to "+K(this.C)+" ("+this.name+")",128),this.state++):2===this.state&&(this.state=0,r("icw3: "+K(a),128))};
m.Pi=function(){r("21h read "+K(~this.j&255),128);return~this.j&255};m.$j=function(){r("elcr read: "+K(this.B,2),128);return this.B};m.ak=function(a){r("elcr write: "+K(a,2),128);this.B=a};function id(a){this.s=a;this.zc=0;this.kc=new Uint8Array(128);this.D=this.g=Date.now();this.o=this.j=0;this.C=!1;this.B=.9765625;this.l=38;this.h=2;this.Jf=this.i=0;P(a.u,112,this,function(b){this.zc=b&127;this.Jf=b>>7});P(a.u,113,this,this.Vh);N(a.u,113,this,this.Uh)}m=id.prototype;m.Y=function(){var a=[];a[0]=this.zc;a[1]=this.kc;a[2]=this.g;a[3]=this.D;a[4]=this.j;a[5]=this.o;a[6]=this.C;a[7]=this.B;a[8]=this.l;a[9]=this.h;a[10]=this.i;a[11]=this.Jf;return a};
m.H=function(a){this.zc=a[0];this.kc=a[1];this.g=a[2];this.D=a[3];this.j=a[4];this.o=a[5];this.C=a[6];this.B=a[7];this.l=a[8];this.h=a[9];this.i=a[10];this.Jf=a[11]};m.Bb=function(a){a=Date.now();this.g+=a-this.D;this.D=a;this.C&&this.j<a?(this.s.Sa(8),this.i|=192,this.j+=this.B*Math.ceil((a-this.j)/this.B)):this.o&&this.o<a&&(this.s.Sa(8),this.i|=160,this.o=0);let b=100;this.C&&this.j&&(b=Math.min(b,Math.max(0,this.j-a)));this.o&&(b=Math.min(b,Math.max(0,this.o-a)));return b};
function jd(a,b){if(a.h&4)a=b;else{a=b;for(var c=b=0,e;a;)e=a%10,c|=e<<4*b,b++,a=(a-e)/10;a=c}return a}function kd(a,b){if(!(a.h&4)){a=b&15;const c=b>>4&15;n(256>b);n(10>a);n(10>c);b=a+10*c}return b}
m.Uh=function(){var a=this.zc;switch(a){case 0:return jd(this,(new Date(this.g)).getUTCSeconds());case 2:return jd(this,(new Date(this.g)).getUTCMinutes());case 4:return jd(this,(new Date(this.g)).getUTCHours());case 7:return jd(this,(new Date(this.g)).getUTCDate());case 8:return jd(this,(new Date(this.g)).getUTCMonth()+1);case 9:return jd(this,(new Date(this.g)).getUTCFullYear()%100);case 10:return 999<=Cb()%1E3?this.l|128:this.l;case 11:return this.h;case 12:return Wb(this.s,8),r("cmos reg C read",
65536),a=this.i,this.i&=-241,a;case 13:return 0;case 50:return jd(this,(new Date(this.g)).getUTCFullYear()/100|0);default:return r("cmos read from index "+K(a),65536),this.kc[this.zc]}};
m.Vh=function(a){switch(this.zc){case 10:this.l=a&127;this.B=1E3/(32768>>(this.l&15)-1);r("Periodic interrupt, a="+K(this.l,2)+" t="+this.B,65536);break;case 11:this.h=a;this.h&64&&(this.j=Date.now());if(this.h&32){a=new Date;const b=kd(this,this.kc[1]),c=kd(this,this.kc[3]),e=kd(this,this.kc[5]),d=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),e,c,b));r("RTC alarm scheduled for "+d+" hh:mm:ss="+e+":"+c+":"+b+" ms_from_now="+(d-a),65536);this.o=+d}this.h&16&&r("Unimplemented: updated interrupt",
65536);r("cmos b="+K(this.h,2),65536);break;case 1:case 3:case 5:S(this,this.zc,a);break;default:r("cmos write index "+K(this.zc)+": "+K(a),65536)}this.C=64===(this.h&64)&&0<(this.l&15)};function S(a,b,c){r("cmos "+K(b)+" <- "+K(c),65536);n(128>b);a.kc[b]=c};function ld(a,b,c){this.A=c;this.s=a;this.g=4;this.pc=this.hc=0;this.Nc=96;this.oc=this.ne=0;this.Wb=1;this.ba=this.tf=this.jf=this.hf=0;this.input=new Nb(4096);this.i="";switch(b){case 1016:this.h=0;this.ba=4;break;case 760:this.h=1;this.ba=3;break;case 1E3:this.h=2;this.ba=4;break;case 744:this.ba=this.h=3;break;default:r("Invalid serial port: "+K(b),16384),this.h=0,this.ba=4}this.A.register("serial"+this.h+"-input",function(e){r("input: "+K(e),16384);this.input.push(e);this.Nc|=1;this.ne&1?md(this,
12):md(this,4)},this);a=a.u;P(a,b,this,function(e){nd(this,e)},function(e){nd(this,e&255);nd(this,e>>8)});P(a,b|1,this,function(e){this.pc&128?(this.hc=this.hc&255|e<<8,r("baud rate: "+K(this.hc),16384)):(0===(this.oc&2)&&e&2&&md(this,2),this.oc=e&15,r("interrupt enable: "+K(e),16384),od(this))});N(a,b,this,function(){if(this.pc&128)return this.hc&255;var e=this.input.shift();-1===e?r("Read input empty",16384):r("Read input: "+K(e),16384);0===this.input.length&&(this.Nc&=-2,pd(this,12),pd(this,4));
return e});N(a,b|1,this,function(){return this.pc&128?this.hc>>8:this.oc&15});N(a,b|2,this,function(){var e=this.Wb&15;r("read interrupt identification: "+K(this.Wb),16384);2==this.Wb&&pd(this,2);this.ne&1&&(e|=192);return e});P(a,b|2,this,function(e){r("fifo control: "+K(e),16384);this.ne=e});N(a,b|3,this,function(){r("read line control: "+K(this.pc),16384);return this.pc});P(a,b|3,this,function(e){r("line control: "+K(e),16384);this.pc=e});N(a,b|4,this,function(){return this.hf});P(a,b|4,this,function(e){r("modem control: "+
K(e),16384);this.hf=e});N(a,b|5,this,function(){r("read line status: "+K(this.Nc),16384);return this.Nc});P(a,b|5,this,function(){r("Factory test write",16384)});N(a,b|6,this,function(){r("read modem status: "+K(this.jf),16384);return this.jf});P(a,b|6,this,function(){r("Unkown register write (base+6)",16384)});N(a,b|7,this,function(){return this.tf});P(a,b|7,this,function(e){this.tf=e})}
ld.prototype.Y=function(){var a=[];a[0]=this.g;a[1]=this.hc;a[2]=this.pc;a[3]=this.Nc;a[4]=this.ne;a[5]=this.oc;a[6]=this.Wb;a[7]=this.hf;a[8]=this.jf;a[9]=this.tf;a[10]=this.ba;return a};ld.prototype.H=function(a){this.g=a[0];this.hc=a[1];this.pc=a[2];this.Nc=a[3];this.ne=a[4];this.oc=a[5];this.Wb=a[6];this.hf=a[7];this.jf=a[8];this.tf=a[9];this.ba=a[10]};
function od(a){a.g&4096&&a.oc&1?(a.Wb=12,a.s.Sa(a.ba)):a.g&16&&a.oc&1?(a.Wb=4,a.s.Sa(a.ba)):a.g&4&&a.oc&2?(a.Wb=2,a.s.Sa(a.ba)):a.g&1&&a.oc&8?(a.Wb=0,a.s.Sa(a.ba)):(a.Wb=1,Wb(a.s,a.ba))}function md(a,b){a.g|=1<<b;od(a)}function pd(a,b){a.g&=~(1<<b);od(a)}
function nd(a,b){a.pc&128?a.hc=a.hc&-256|b:(r("data: "+K(b),16384),md(a,2),255!==b&&(b=String.fromCharCode(b),a.A.send("serial"+a.h+"-output-char",b),a.i+=b,"\n"===b&&(r("SERIAL: "+a.i.trimRight().replace(/[\x00-\x08\x0b-\x1f\x7f\x80-\xff]/g,"")),a.i="")))};function qd(a){this.s=a;var b=a.u;fc(a.v.Ta,{Oa:56,J:[134,128,19,113,7,0,128,2,8,0,128,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,1,0,0],gb:[],name:"acpi"});this.g=this.h=0;this.status=1;this.ye=this.xd=0;this.i=rd(this,Cb());this.Vb=new Uint8Array(4);N(b,45056,this,void 0,function(){r("ACPI pm1_status read",262144);return this.xd});P(b,45056,this,void 0,function(c){r("ACPI pm1_status write: "+K(c,4),262144);this.xd&=~c});N(b,45058,this,void 0,
function(){r("ACPI pm1_enable read",262144);return this.ye});P(b,45058,this,void 0,function(c){r("ACPI pm1_enable write: "+K(c),262144);this.ye=c});N(b,45060,this,void 0,function(){r("ACPI status read",262144);return this.status});P(b,45060,this,void 0,function(c){r("ACPI status write: "+K(c),262144);this.status=c});N(b,45064,this,void 0,void 0,function(){return rd(this,Cb())&16777215});N(b,45024,this,function(){r("Read gpe#0",262144);return this.Vb[0]});N(b,45025,this,function(){r("Read gpe#1",262144);
return this.Vb[1]});N(b,45026,this,function(){r("Read gpe#2",262144);return this.Vb[2]});N(b,45027,this,function(){r("Read gpe#3",262144);return this.Vb[3]});P(b,45024,this,function(c){r("Write gpe#0: "+K(c),262144);this.Vb[0]=c});P(b,45025,this,function(c){r("Write gpe#1: "+K(c),262144);this.Vb[1]=c});P(b,45026,this,function(c){r("Write gpe#2: "+K(c),262144);this.Vb[2]=c});P(b,45027,this,function(c){r("Write gpe#3: "+K(c),262144);this.Vb[3]=c})}
qd.prototype.Bb=function(a){a=rd(this,a);var b=0!==((a^this.i)&8388608);this.ye&1&&b?(r("ACPI raise irq",262144),this.xd|=1,this.s.Sa(9)):Wb(this.s,9);this.i=a;return 100};function rd(a,b){b=Math.round(3579.545*b);b===a.h?3579.545>a.g&&a.g++:(n(b>a.h),a.h+a.g<=b?(a.g=0,a.h=b):r("Warning: Overshot pmtimer, waiting; current="+b+" last="+a.h+" offset="+a.g,262144));return a.h+a.g}qd.prototype.Y=function(){var a=[];a[0]=this.status;a[1]=this.xd;a[2]=this.ye;a[3]=this.Vb;return a};
qd.prototype.H=function(a){this.status=a[0];this.xd=a[1];this.ye=a[2];this.Vb=a[3]};var sd="Fixed (0);Lowest Prio (1);SMI (2);Reserved (3);NMI (4);INIT (5);Reserved (6);ExtINT (7)".split(";"),td=["physical","logical"];
function ud(a){this.s=a;this.X=this.la=0;this.aa=1;this.g=this.o=0;this.l=Cb();this.P=this.U=this.S=this.V=this.h=65536;this.I=this.F=this.B=0;this.i=new Int32Array(8);this.R=new Int32Array(8);this.j=new Int32Array(8);this.W=254;this.D=-1;this.C=this.error=this.K=0;ub(a.u,4276092928,1048576,b=>{r("Unsupported read8 from apic: "+K(b>>>0),524288);var c=b&3;return this.Wc(b&-4)>>8*c&255},(b,c)=>{r("Unsupported write8 from apic: "+K(b)+" <- "+K(c),524288);r(Error().stack,void 0);n(!1)},b=>this.Wc(b),
(b,c)=>this.Cb(b,c))}m=ud.prototype;
m.Wc=function(a){a=a-4276092928|0;switch(a){case 32:return r("APIC read id",524288),this.la;case 48:return r("APIC read version",524288),327700;case 128:return this.B;case 208:return r("Read local destination",524288),this.K;case 224:return r("Read destination format",524288),this.D;case 240:return this.W;case 256:case 272:case 288:case 304:case 320:case 336:case 352:case 368:return a=a-256>>4,r("Read isr "+a+": "+K(this.R[a]>>>0,8),524288),this.R[a];case 384:case 400:case 416:case 432:case 448:case 464:case 480:case 496:return a=a-
384>>4,r("Read tmr "+a+": "+K(this.j[a]>>>0,8),524288),this.j[a];case 512:case 528:case 544:case 560:case 576:case 592:case 608:case 624:return a=a-512>>4,r("Read irr "+a+": "+K(this.i[a]>>>0,8),524288),this.i[a];case 640:return r("Read error: "+K(this.C>>>0,8),524288),this.C;case 768:return this.F;case 784:return r("APIC read icr1",524288),this.I;case 800:return r("read timer lvt",524288),this.h;case 832:return r("read lvt perf counter",524288),this.V;case 848:return r("read lvt int0",524288),this.S;
case 864:return r("read lvt int1",524288),this.U;case 880:return r("read lvt error",524288),this.P;case 992:return r("read timer divider",524288),this.X;case 896:return r("read timer initial count",524288),this.o;case 912:return r("read timer current count: "+K(this.g>>>0,8),524288),this.g;default:return r("APIC read "+K(a),524288),n(!1),0}};
m.Cb=function(a,b){a=a-4276092928|0;switch(a){case 48:r("APIC write version: "+K(b>>>0,8)+", ignored",524288);break;case 128:this.B=b&255;vd(this);break;case 176:b=wd(this);if(-1!==b){xd(this.R,b);if(yd(this.j,b)){a=this.s.v.Ic;for(var c=0;24>c;c++){var e=a.g[c];(e&255)===b&&e&16384&&(r("Clear remote IRR for irq="+K(c),524288),a.g[c]&=-16385,zd(a,c))}}vd(this)}else r("Bad eoi: No isr set",524288);break;case 208:r("Set local destination: "+K(b>>>0,8),524288);this.K=b&4278190080;break;case 224:r("Set destination format: "+
K(b>>>0,8),524288);this.D=b|16777215;break;case 240:r("Set spurious vector: "+K(b>>>0,8),524288);this.W=b;break;case 640:r("Write error: "+K(b>>>0,8),524288);this.C=this.error;this.error=0;break;case 768:a=b&255;c=b>>8&7;e=b>>15&1;var d=b>>18&3;r("APIC write icr0: "+K(b,8)+" vector="+K(a,2)+" destination_mode="+td[b>>11&1]+" delivery_mode="+sd[c]+" destination_shorthand="+["no","self","all with self","all without self"][d],524288);this.F=b&-4097;0===d?Ad(this,a,c,e):1===d?Ad(this,a,0,e):2===d?Ad(this,
a,c,e):3!==d&&n(!1);break;case 784:r("APIC write icr1: "+K(b>>>0,8),524288);this.I=b;break;case 800:r("timer lvt: "+K(b>>>0,8),524288);this.h=b;break;case 832:r("lvt perf counter: "+K(b>>>0,8),524288);this.V=b;break;case 848:r("lvt int0: "+K(b>>>0,8),524288);this.S=b;break;case 864:r("lvt int1: "+K(b>>>0,8),524288);this.U=b;break;case 880:r("lvt error: "+K(b>>>0,8),524288);this.P=b;break;case 992:r("timer divider: "+K(b>>>0,8),524288);this.X=b;b=b&3|(b&8)>>1;this.aa=7===b?0:b+1;break;case 896:r("timer initial: "+
K(b>>>0,8),524288);this.o=b>>>0;this.g=b>>>0;this.l=Cb();break;case 912:r("timer current: "+K(b>>>0,8),524288);n(!1,"read-only register");break;default:r("APIC write32 "+K(a)+" <- "+K(b>>>0,8),524288),n(!1)}};
m.Bb=function(a){if(0===this.g)return 100;const b=1E6/(1<<this.aa);a=(a-this.l)*b>>>0;this.l+=a/b;this.g-=a;0>=this.g&&(a=this.h&393216,131072===a?(this.g%=this.o,0>=this.g&&(this.g+=this.o),n(0!==this.g),0===(this.h&65536)&&Ad(this,this.h&255,0,!1)):0===a&&(this.g=0,r("APIC timer one shot end",524288),0===(this.h&65536)&&Ad(this,this.h&255,0,!1)));return Math.max(0,this.g/b)};
function Ad(a,b,c,e){5!==c&&4!==c&&((16>b||255===b)&&n(!1,"TODO: Invalid vector"),yd(a.i,b)?r("Not delivered: irr already set, vector="+K(b,2),524288):(Bd(a.i,b),e?Bd(a.j,b):xd(a.j,b),vd(a)))}function Cd(a){a=Dd(a.i);n(255!==a);n(16<=a||-1===a);return a}function wd(a){a=Dd(a.R);n(255!==a);n(16<=a||-1===a);return a}function vd(a){var b=Cd(a);-1!==b&&(wd(a)>=b||(b&240)<=(a.B&240)||Eb(a.s))}
m.de=function(){var a=Cd(this);-1===a||wd(this)>=a||(a&240)<=(this.B&240)||(xd(this.i,a),Bd(this.R,a),this.s.I(a),vd(this))};m.Y=function(){var a=[];a[0]=this.la;a[1]=this.X;a[2]=this.aa;a[3]=this.o;a[4]=this.g;a[5]=this.l;a[6]=this.h;a[7]=this.V;a[8]=this.S;a[9]=this.U;a[10]=this.P;a[11]=this.B;a[12]=this.F;a[13]=this.I;a[14]=this.i;a[15]=this.R;a[16]=this.j;a[17]=this.W;a[18]=this.D;a[19]=this.K;a[20]=this.error;a[21]=this.C;return a};
m.H=function(a){this.la=a[0];this.X=a[1];this.aa=a[2];this.o=a[3];this.g=a[4];this.l=a[5];this.h=a[6];this.V=a[7];this.S=a[8];this.U=a[9];this.P=a[10];this.B=a[11];this.F=a[12];this.I=a[13];this.i=a[14];this.R=a[15];this.j=a[16];this.W=a[17];this.D=a[18];this.K=a[19];this.error=a[20];this.C=a[21]};function yd(a,b){n(0<=b&&256>b);return a[b>>5]>>(b&31)&1}function Bd(a,b){n(0<=b&&256>b);a[b>>5]|=1<<(b&31)}function xd(a,b){n(0<=b&&256>b);a[b>>5]&=~(1<<(b&31))}
function Dd(a){for(var b=7;0<=b;b--){var c=a[b];if(c)return Hb(c>>>0)|b<<5}return-1};function Ed(a){this.s=a;this.g=new Int32Array(24);this.o=new Int32Array(24);for(var b=0;b<this.g.length;b++)this.g[b]=65536;this.i=this.h=this.l=this.j=0;n(!0);ub(a.u,4273995776,131072,c=>{c=c-4273995776|0;if(16<=c&&20>c)return c-=16,r("ioapic read8 byte "+c+" "+K(this.j),524288),this.read(this.j)>>8*c&255;r("Unexpected IOAPIC register read: "+K(c>>>0),524288);n(!1);return 0},c=>{n(!1,"unsupported write8 from ioapic: "+K(c>>>0))},c=>{c=c-4273995776|0;if(0===c)return this.j;if(16===c)return this.read(this.j);
r("Unexpected IOAPIC register read: "+K(c>>>0),524288);n(!1);return 0},(c,e)=>{c=c-4273995776|0;0===c?this.j=e:16===c?this.write(this.j,e):(r("Unexpected IOAPIC register write: "+K(c>>>0)+" <- "+K(e>>>0,8),524288),n(!1))})}
function zd(a,b){var c=1<<b;if(0!==(a.h&c)){var e=a.g[b];if(0===(e&65536)){var d=e>>8&7,f=e&255,k=32768===(e&32768);if(0===(e&32768))a.h&=~c;else if(a.g[b]|=16384,e&16384){r("No route: level interrupt and remote IRR still set",524288);return}0===d||1===d?Ad(a.s.v.ad,f,d,k):n(!1,"TODO");a.g[b]&=-4097}}}m=Ed.prototype;m.Zd=function(a){if(24<=a)n(!1,"Bad irq: "+a);else{var b=1<<a;0===(this.i&b)&&(this.i|=b,65536!==(this.g[a]&98304)&&(this.h|=b,zd(this,a)))}};
m.ee=function(a){if(24<=a)n(!1,"Bad irq: "+a);else{var b=1<<a;(this.i&b)===b&&(this.i&=~b,this.g[a]&32768&&(this.h&=~b))}};
m.read=function(a){if(0===a)return r("IOAPIC Read id",524288),this.l<<24;if(1===a)return r("IOAPIC Read version",524288),1507345;if(2===a)return r("IOAPIC Read arbitration id",524288),this.l<<24;if(16<=a&&64>a){var b=a-16>>1;a&1?(a=this.o[b],r("IOAPIC Read destination irq="+K(b)+" -> "+K(a,8),524288)):(a=this.g[b],r("IOAPIC Read config irq="+K(b)+" -> "+K(a,8),524288));return a}r("IOAPIC register read outside of range "+K(a),524288);n(!1);return 0};
m.write=function(a,b){if(0===a)this.l=b>>>24&15;else if(1===a||2===a)r("Invalid write: "+a,524288);else if(16<=a&&64>a){var c=a-16>>1;a&1?(this.o[c]=b&4278190080,r("Write destination "+K(b>>>0,8)+" irq="+K(c)+" dest="+K(b>>>24,2),524288)):(this.g[c]=b&110591|this.g[c]&-110592,r("Write config "+K(b>>>0,8)+" irq="+K(c)+" vector="+K(b&255,2)+" deliverymode="+sd[b>>8&7]+" destmode="+td[b>>11&1]+" is_level="+(b>>15&1)+" disabled="+(b>>16&1),524288),zd(this,c))}else r("IOAPIC register write outside of range "+
K(a)+": "+K(b>>>0,8),524288),n(!1)};m.Y=function(){var a=[];a[0]=this.g;a[1]=this.o;a[2]=this.j;a[3]=this.l;a[4]=this.h;a[5]=this.i;return a};m.H=function(a){this.g=a[0];this.o=a[1];this.j=a[2];this.l=a[3];this.h=a[4];this.i=a[5]};function Fd(a){this.message=a}Fd.prototype=Error();const Gd={Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array};
function Hd(a,b){if("object"!==typeof a||null===a)return n("function"!==typeof a),a;if(a instanceof Array)return a.map(f=>Hd(f,b));a.constructor===Object&&(console.log(a),n(a.constructor!==Object,"Expected non-object"));if(a.BYTES_PER_ELEMENT){var c=new Uint8Array(a.buffer,a.byteOffset,a.length*a.BYTES_PER_ELEMENT);a=a.constructor.name.replace("bound ","");n(Gd[a]);return{__state_type__:a,buffer_id:b.push(c)-1}}a.Y||console.log("Object without get_state: ",a);c=a.Y();a=[];for(var e=0;e<c.length;e++){var d=
c[e];n("function"!==typeof d);a[e]=Hd(d,b)}return a}function Id(a,b){if("object"!==typeof a||null===a)return n("function"!==typeof a),a;if(a instanceof Array){for(var c=0;c<a.length;c++)a[c]=Id(a[c],b);return a}c=a.__state_type__;n(void 0!==c);const e=Gd[c];n(e,"Unkown type: "+c);return new e(b[a.buffer_id])}
yb.prototype.Ce=function(){for(var a=[],b=Hd(this,a),c=[],e=0,d=0;d<a.length;d++){var f=a[d].byteLength;c[d]={offset:e,length:f};e+=f;e=e+3&-4}b=JSON.stringify({buffer_infos:c,state:b});b=(new TextEncoder).encode(b);d=16+b.length;d=d+3&-4;var k=d+e;e=new ArrayBuffer(k);var l=new Int32Array(e,0,4);(new Uint8Array(e,16,b.length)).set(b);f=new Uint8Array(e,d);l[0]=-2039052682;l[1]=6;l[2]=k;l[3]=b.length;for(d=0;d<a.length;d++)k=a[d],n(k.constructor===Uint8Array),f.set(k,c[d].offset);r("State: json size "+
(b.byteLength>>10)+"k");r("State: Total buffers size "+(f.byteLength>>10)+"k");return e};
yb.prototype.Vd=function(a){function b(A,v){const w=A.length;if(16>w)throw new Fd("Invalid length: "+w);A=new Int32Array(A.buffer,A.byteOffset,4);if(-2039052682!==A[0])throw new Fd("Invalid header: "+K(A[0]>>>0));if(6!==A[1])throw new Fd("Version mismatch: dump="+A[1]+" we=6");if(v&&A[2]!==w)throw new Fd("Length doesn't match header: real="+w+" header="+A[2]);return A[3]}function c(A){A=(new TextDecoder).decode(A);return JSON.parse(A)}a=new Uint8Array(a);if(4247762216===(new Uint32Array(a.buffer,
0,1))[0]){var e=this.sh(a.length);(new Uint8Array(this.Qa.buffer,this.uh(e),a.length)).set(a);var d=this.be(e,16),f=new Uint8Array(this.Qa.buffer,d,16),k=b(f,!1);this.ce(d,16);d=this.be(e,k);f=new Uint8Array(this.Qa.buffer,d,k);f=c(f);this.ce(d,k);d=f.state;var l=f.buffer_infos;f=[];k=16+k;for(var p of l){l=(k+3&-4)-k;if(1048576<p.length){var q=this.be(e,l);this.ce(q,l);q=new Uint8Array(p.length);f.push(q.buffer);for(var t=0;t<p.length;){var u=p.length-t;n(0<=u);u=Math.min(u,1048576);const A=this.be(e,
u);q.set(new Uint8Array(this.Qa.buffer,A,u),t);this.ce(A,u);t+=u}}else q=this.be(e,l+p.length),t=q+l,f.push(this.Qa.buffer.slice(t,t+p.length)),this.ce(q,l+p.length);k+=l+p.length}d=Id(d,f);this.H(d);this.th(e)}else{p=b(a,!0);if(0>p||p+12>=a.length)throw new Fd("Invalid info block length: "+p);d=c(a.subarray(16,16+p));e=d.state;d=d.buffer_infos;let A=16+p;A=A+3&-4;p=d.map(v=>{const w=A+v.offset;return a.buffer.slice(w,w+v.length)});e=Id(e,p);this.H(e)}};function Jd(a,b,c){a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&(r("Replace mac in eth destination field",1048576),a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5]);a[6]===b[0]&&a[7]===b[1]&&a[8]===b[2]&&a[9]===b[3]&&a[10]===b[4]&&a[11]===b[5]&&(r("Replace mac in eth source field",1048576),a[6]=c[0],a[7]=c[1],a[8]=c[2],a[9]=c[3],a[10]=c[4],a[11]=c[5]);var e=a[12]<<8|a[13];if(2048===e)if(a=a.subarray(14),e=a[0]>>4,4!==e)r("Expected ipv4.version==4 but got: "+
e,1048576);else{if(n(5===(a[0]&15),"TODO: ihl!=5"),17===a[9]){a=a.subarray(20);e=a[0]<<8|a[1];var d=a[2]<<8|a[3];r("udp srcport="+e+" dstport="+d+" checksum="+K(a[6]<<8|a[7],4),1048576);if(67===e||67===d)if(e=a.subarray(8),d=e[236]<<24|e[237]<<16|e[238]<<8|e[239],1669485411!==d)r("dhcp packet didn't match magic: "+K(d,8));else for(e[28]===b[0]&&e[29]===b[1]&&e[30]===b[2]&&e[31]===b[3]&&e[32]===b[4]&&e[33]===b[5]&&(r("Replace mac in dhcp.chaddr",1048576),e[28]=c[0],e[29]=c[1],e[30]=c[2],e[31]=c[3],
e[32]=c[4],e[33]=c[5],a[6]=a[7]=0),d=240;d<e.length;){const f=e[d++];if(255===f)break;const k=e[d++];61===f&&1===e[d+0]&&e[d+1]===b[0]&&e[d+2]===b[1]&&e[d+3]===b[2]&&e[d+4]===b[3]&&e[d+5]===b[4]&&e[d+6]===b[5]&&(r("Replace mac in dhcp.clientidentifier",1048576),e[d+1]=c[0],e[d+2]=c[1],e[d+3]=c[2],e[d+4]=c[3],e[d+5]=c[4],e[d+6]=c[5],a[6]=a[7]=0);d+=k}}}else 2054===e&&(a=a.subarray(14),r("arp oper="+a[7]+" "+Kd(a.subarray(8,14))+" "+Kd(a.subarray(18,24)),1048576),a[8]===b[0]&&a[9]===b[1]&&a[10]===b[2]&&
a[11]===b[3]&&a[12]===b[4]&&a[13]===b[5]&&(r("Replace mac in arp.sha",1048576),a[8]=c[0],a[9]=c[1],a[10]=c[2],a[11]=c[3],a[12]=c[4],a[13]=c[5]))}function Kd(a){return[a[0].toString(16).padStart(2,"0"),a[1].toString(16).padStart(2,"0"),a[2].toString(16).padStart(2,"0"),a[3].toString(16).padStart(2,"0"),a[4].toString(16).padStart(2,"0"),a[5].toString(16).padStart(2,"0")].join(":")}
function Ld(a,b,c,e){this.s=a;this.Ta=a.v.Ta;this.Mf=c;this.Yb=e;this.A=b;this.A.register("net0-receive",function(d){if(!(this.Ba&1)&&(this.A.send("eth-receive-end",[d.length]),this.Wd&16||this.Wd&4&&255===d[0]&&255===d[1]&&255===d[2]&&255===d[3]&&255===d[4]&&255===d[5]||!(this.Wd&8&&1===(d[0]&1)||d[0]!==this.ra[0]||d[1]!==this.ra[1]||d[2]!==this.ra[2]||d[3]!==this.ra[3]||d[4]!==this.ra[4]||d[5]!==this.ra[5]))){this.Qd&&(d=new Uint8Array(d),Jd(d,this.ra,this.Qd));var f=this.kb<<8,k=Math.max(60,d.length)+
4,l=f+4,p=this.kb+1+(k>>8),q=f+k,t=1+(k>>8),u=this.Jb>this.kb?this.Jb-this.kb:this.Ya-this.kb+this.Jb-this.zb;u<t&&0!==this.Jb?r("Buffer full, dropping packet pstart="+K(this.zb)+" pstop="+K(this.Ya)+" curpg="+K(this.kb)+" needed="+K(t)+" boundary="+K(this.Jb)+" available="+K(u),1048576):(q>this.Ya<<8?(n(60<=d.length),q=(this.Ya<<8)-l,n(0<=q),this.memory.set(d.subarray(0,q),l),this.memory.set(d.subarray(q),this.zb<<8),r("rcv cut="+K(q),1048576)):(this.memory.set(d,l),60>d.length&&this.memory.fill(0,
l+d.length,l+60)),p>=this.Ya&&(p+=this.zb-this.Ya),this.memory[f]=1,this.memory[f+1]=p,this.memory[f+2]=k,this.memory[f+3]=k>>8,this.kb=p,r("rcv offset="+K(f)+" len="+K(k)+" next="+K(p),1048576),Md(this,1))}},this);this.port=768;this.name="ne2k";this.J=[236,16,41,128,3,1,0,0,0,0,0,2,0,0,0,0,this.port&255|1,this.port>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,184,254,0,0,0,0,0,0,0,0,0,1,0,0];this.Oa=40;this.gb=[{size:32}];this.bf=this.R=0;this.Ba=1;this.vf=this.Fd=this.Ab=
this.fe=0;this.memory=new Uint8Array(32768);this.wf=this.Wd=0;this.Yf=1;this.ra=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]);this.Qd=null;for(b=0;6>b;b++)this.memory[b<<1]=this.memory[b<<1|1]=this.ra[b];this.memory[28]=this.memory[29]=87;this.memory[30]=this.memory[31]=87;r("Mac: "+Kd(this.ra),1048576);this.ua=0;this.zb=64;this.Ya=128;this.Jb=this.kb=76;b=a.u;N(b,this.port|0,this,function(){r("Read cmd",1048576);return this.Ba});P(b,this.port|0,this,function(d){this.Ba=
d;r("Write command: "+K(d,2)+" newpg="+(this.Ba>>6)+" txcr="+K(this.wf,2),1048576);this.Ba&1||(d&24&&0===this.Ab&&Md(this,64),d&4&&(d=this.vf<<8,d=this.memory.subarray(d,d+this.Fd),this.Qd&&(d=new Uint8Array(d),Jd(d,this.Qd,this.ra)),this.A.send("net0-send",d),this.A.send("eth-transmit-end",[d.length]),this.Ba&=-5,Md(this,2),r("Command: Transfer. length="+K(d.byteLength),1048576)))});N(b,this.port|13,this,function(){r("Read counter0",1048576);return 0});N(b,this.port|14,this,function(){r("Read8 counter1",
1048576);return 0},function(){r("Read16 counter1",1048576);return 0});N(b,this.port|15,this,function(){r("Read counter2",1048576);return 0});N(b,this.port|31,this,function(){r("Read reset",1048576);Md(this,128);return 0});P(b,this.port|31,this,function(d){r("Write reset: "+K(d,2),1048576)});N(b,this.port|1,this,function(){var d=V(this);if(0===d)return this.zb;if(1===d)return r("Read pg1/01 (mac[0])",1048576),this.ra[0];if(2===d)return this.zb;r("Read pg"+d+"/01");n(!1);return 0});P(b,this.port|1,
this,function(d){var f=V(this);0===f?(r("start page: "+K(d,2),1048576),this.zb=d):1===f?(r("mac[0] = "+K(d),1048576),this.ra[0]=d):3===f?r("Unimplemented: Write pg3/01 (9346CR): "+K(d),1048576):(r("Write pg"+f+"/01: "+K(d),1048576),n(!1))});N(b,this.port|2,this,function(){var d=V(this);if(0===d)return this.Ya;if(1===d)return r("Read pg1/02 (mac[1])",1048576),this.ra[1];if(2===d)return this.Ya;r("Read pg"+d+"/02",1048576);n(!1);return 0});P(b,this.port|2,this,function(d){var f=V(this);0===f?(r("stop page: "+
K(d,2),1048576),d>this.memory.length>>8&&(d=this.memory.length>>8,r("XXX: Adjusting stop page to "+K(d),1048576)),this.Ya=d):1===f?(r("mac[1] = "+K(d),1048576),this.ra[1]=d):(r("Write pg"+f+"/02: "+K(d),1048576),n(!1))});N(b,this.port|7,this,function(){var d=V(this);if(0===d)return r("Read isr: "+K(this.R,2),1048576),this.R;if(1===d)return r("Read curpg: "+K(this.kb,2),1048576),this.kb;n(!1)});P(b,this.port|7,this,function(d){var f=V(this);0===f?(r("Write isr: "+K(d,2),1048576),this.R&=~d,Nd(this)):
1===f?(r("Write curpg: "+K(d,2),1048576),this.kb=d):n(!1)});P(b,this.port|13,this,function(d){var f=V(this);0===f?(this.wf=d,r("Write tx config: "+K(d,2),1048576)):r("Unimplemented: Write pg"+f+"/0d "+K(d,2),1048576)});P(b,this.port|14,this,function(d){var f=V(this);0===f?(r("Write data configuration: "+K(d,2),1048576),this.fe=d):r("Unimplemented: Write pg"+f+"/0e "+K(d,2),1048576)});N(b,this.port|10,this,function(){if(0===V(this))return r("Read pg0/0a",1048576),80;n(!1,"TODO");return 0});P(b,this.port|
10,this,function(d){var f=V(this);0===f?(r("Write remote byte count low: "+K(d,2),1048576),this.Ab=this.Ab&65280|d&255):r("Unimplemented: Write pg"+f+"/0a "+K(d,2),1048576)});N(b,this.port|11,this,function(){if(0===V(this))return r("Read pg0/0b",1048576),67;n(!1,"TODO");return 0});P(b,this.port|11,this,function(d){var f=V(this);0===f?(r("Write remote byte count high: "+K(d,2),1048576),this.Ab=this.Ab&255|d<<8&65280):r("Unimplemented: Write pg"+f+"/0b "+K(d,2),1048576)});N(b,this.port|8,this,function(){var d=
V(this);if(0===d)return r("Read remote start address low",1048576),this.ua&255;r("Unimplemented: Read pg"+d+"/08",1048576);n(!1)});P(b,this.port|8,this,function(d){var f=V(this);0===f?(r("Write remote start address low: "+K(d,2),1048576),this.ua=this.ua&65280|d&255):r("Unimplemented: Write pg"+f+"/08 "+K(d,2),1048576)});N(b,this.port|9,this,function(){var d=V(this);if(0===d)return r("Read remote start address high",1048576),this.ua>>8&255;r("Unimplemented: Read pg"+d+"/09",1048576);n(!1)});P(b,this.port|
9,this,function(d){var f=V(this);0===f?(r("Write remote start address low: "+K(d,2),1048576),this.ua=this.ua&255|d<<8&65280):r("Unimplemented: Write pg"+f+"/09 "+K(d,2),1048576)});P(b,this.port|15,this,function(d){var f=V(this);0===f?(r("Write interrupt mask register: "+K(d,2)+" isr="+K(this.R,2),1048576),this.bf=d,Nd(this)):r("Unimplemented: Write pg"+f+"/0f "+K(d,2),1048576)});N(b,this.port|3,this,function(){var d=V(this);if(0===d)return r("Read boundary: "+K(this.Jb,2),1048576),this.Jb;if(1===
d)return r("Read pg1/03 (mac[2])",1048576),this.ra[2];3===d?r("Unimplemented: Read pg3/03 (CONFIG0)",1048576):(r("Read pg"+d+"/03",1048576),n(!1));return 0});P(b,this.port|3,this,function(d){var f=V(this);0===f?(r("Write boundary: "+K(d,2),1048576),this.Jb=d):1===f?(r("mac[2] = "+K(d),1048576),this.ra[2]=d):(r("Write pg"+f+"/03: "+K(d),1048576),n(!1))});N(b,this.port|4,this,function(){var d=V(this);if(0===d)return this.Yf;if(1===d)return r("Read pg1/04 (mac[3])",1048576),this.ra[3];r("Read pg"+d+
"/04",1048576);n(!1);return 0});P(b,this.port|4,this,function(d){var f=V(this);0===f?(r("Write tpsr: "+K(d,2),1048576),this.vf=d):1===f?(r("mac[3] = "+K(d),1048576),this.ra[3]=d):(r("Write pg"+f+"/04: "+K(d),1048576),n(!1))});N(b,this.port|5,this,function(){var d=V(this);if(0===d)return r("Unimplemented: Read pg0/05 (NCR: Number of Collisions Register)",1048576),0;if(1===d)return r("Read pg1/05 (mac[4])",1048576),this.ra[4];3===d?r("Unimplemented: Read pg3/05 (CONFIG2)",1048576):(r("Read pg"+d+"/05",
1048576),n(!1));return 0});P(b,this.port|5,this,function(d){var f=V(this);0===f?(r("Write tcnt low: "+K(d,2),1048576),this.Fd=this.Fd&-256|d):1===f?(r("mac[4] = "+K(d),1048576),this.ra[4]=d):3===f?r("Unimplemented: Write pg3/05 (CONFIG2): "+K(d),1048576):(r("Write pg"+f+"/05: "+K(d),1048576),n(!1))});N(b,this.port|6,this,function(){var d=V(this);if(0===d)return n(!1,"TODO"),0;if(1===d)return r("Read pg1/06 (mac[5])",1048576),this.ra[5];3===d?r("Unimplemented: Read pg3/06 (CONFIG3)",1048576):(r("Read pg"+
d+"/06",1048576),n(!1));return 0});P(b,this.port|6,this,function(d){var f=V(this);0===f?(r("Write tcnt high: "+K(d,2),1048576),this.Fd=this.Fd&255|d<<8):1===f?(r("mac[5] = "+K(d),1048576),this.ra[5]=d):3===f?r("Unimplemented: Write pg3/06 (CONFIG3): "+K(d),1048576):(r("Write pg"+f+"/06: "+K(d),1048576),n(!1))});N(b,this.port|12,this,function(){var d=V(this);if(0===d)return 9;r("Unimplemented: Read pg"+d+"/0c",1048576);n(!1);return 0});P(b,this.port|12,this,function(d){var f=V(this);0===f?(r("RX configuration reg write: "+
K(d,2),1048576),this.Wd=d):r("Unimplemented: Write pg"+f+"/0c: "+K(d),1048576)});N(b,this.port|16,this,this.Yh,this.kg,this.Xh);P(b,this.port|16,this,this.lg,this.lg,this.Zh);fc(a.v.Ta,this)}m=Ld.prototype;m.Y=function(){var a=[];a[0]=this.R;a[1]=this.bf;a[2]=this.Ba;a[3]=this.fe;a[4]=this.Ab;a[5]=this.Fd;a[6]=this.vf;a[7]=this.ua;a[8]=this.zb;a[9]=this.kb;a[10]=this.Jb;a[11]=this.Ya;a[12]=this.Wd;a[13]=this.wf;a[14]=this.Yf;a[15]=this.ra;a[16]=this.memory;return a};
m.H=function(a){this.R=a[0];this.bf=a[1];this.Ba=a[2];this.fe=a[3];this.Ab=a[4];this.Fd=a[5];this.vf=a[6];this.ua=a[7];this.zb=a[8];this.kb=a[9];this.Jb=a[10];this.Ya=a[11];this.Wd=a[12];this.wf=a[13];this.Yf=a[14];this.Mf?(this.ra=a[15],this.memory=a[16]):this.Yb&&(this.Qd=a[15],this.memory=a[16],r("Using mac address translation guest_os_mac="+Kd(this.Qd)+" real_mac="+Kd(this.ra),1048576))};function Md(a,b){r("Do interrupt "+K(b,2),1048576);a.R|=b;Nd(a)}
function Nd(a){a.bf&a.R?a.Ta.Da(a.Oa):zc(a.Ta,a.Oa)}function Od(a,b){if(16>=a.ua||16384<=a.ua&&32768>a.ua)a.memory[a.ua]=b;a.ua++;a.Ab--;a.ua>=a.Ya<<8&&(a.ua+=a.zb-a.Ya<<8);0===a.Ab&&Md(a,64)}m.lg=function(a){Od(this,a);this.fe&1&&Od(this,a>>8)};m.Zh=function(a){Od(this,a);Od(this,a>>8);Od(this,a>>16);Od(this,a>>24)};function Pd(a){let b=0;32768>a.ua&&(b=a.memory[a.ua]);a.ua++;a.Ab--;a.ua>=a.Ya<<8&&(a.ua+=a.zb-a.Ya<<8);0===a.Ab&&Md(a,64);return b}m.Yh=function(){return this.kg()&255};
m.kg=function(){return this.fe&1?Pd(this)|Pd(this)<<8:Pd(this)};m.Xh=function(){return Pd(this)|Pd(this)<<8|Pd(this)<<16|Pd(this)<<24};function V(a){return a.Ba>>6&3};var Qd=new Uint8Array(256),Rd=[],Sd=[],Td=[],Ud=new Uint8Array(256),Vd=[];
function Wd(a,b){this.s=a;this.A=b;this.Fa=new Nb(64);this.ea=new Nb(64);this.h=this.B=this.jb=this.o=0;this.M=new Uint8Array(256);Xd(this);this.Nd=!1;this.De=0;this.xb=this.wb=this.jd=this.nc=!1;this.Lb=[new Ob,new Ob];this.lb=a.v.lb;this.mb=this.mc=this.j=this.Pb=this.l=this.F=0;this.Qb=1;this.hd=5;this.Ob=!1;this.g=new ArrayBuffer(65536);this.X=new Int8Array(this.g);this.D=new Uint8Array(this.g);this.W=new Int16Array(this.g);this.aa=new Uint16Array(this.g);this.Va=new Ib(this.g);this.Rb=this.C=
!1;this.hb=22050;b.send("dac-tell-sampling-rate",this.hb);this.i=1;this.P=170;this.K=0;this.cd=new Uint8Array(256);this.I=new Nb(64);this.U=this.S=this.V=0;this.pi=!1;this.ba=5;this.nd=new Uint8Array(16);a.u.Ad(544,this,this.Qg,this.Sg,this.Ri,this.Ti);a.u.Ad(904,this,this.Qg,this.Sg);a.u.Ad(548,this,this.Vi,this.Xi);N(a.u,550,this,this.Zi);N(a.u,551,this,this.aj);N(a.u,552,this,this.cj);N(a.u,553,this,this.ej);N(a.u,554,this,this.gj);N(a.u,555,this,this.ij);N(a.u,556,this,this.kj);N(a.u,557,this,
this.mj);a.u.Ad(558,this,this.oj,this.qj);a.u.ac(544,this,this.Rg,this.Tg,this.Si,this.Ui);a.u.ac(904,this,this.Rg,this.Tg);a.u.ac(548,this,this.Wi,this.Yi);P(a.u,550,this,this.$i);P(a.u,551,this,this.bj);a.u.ac(552,this,this.dj,this.fj);P(a.u,554,this,this.hj);P(a.u,555,this,this.jj);P(a.u,556,this,this.lj);P(a.u,557,this,this.nj);P(a.u,558,this,this.pj);P(a.u,559,this,this.rj);a.u.Ad(816,this,this.Wj,this.Yj);a.u.ac(816,this,this.Xj,this.Zj);this.lb.xf.push({Ze:this.la,Xf:this});b.register("dac-request-data",
function(){!this.Pb||this.Rb?Yd(this):Zd(this)},this);b.register("speaker-has-initialized",function(){Xd(this)},this);b.send("speaker-confirm-initialized");$d(this)}function $d(a){a.Fa.clear();a.ea.clear();a.jb=0;a.B=0;a.Nd=!1;a.De=0;a.nc=!1;a.jd=!1;a.wb=!1;a.xb=!1;a.Lb[0].clear();a.Lb[1].clear();a.F=0;a.l=0;a.Pb=0;a.j=0;a.mc=0;a.mb=0;a.Ob=!1;a.D.fill(0);a.C=!1;a.Rb=!1;a.P=170;a.K=0;a.hb=22050;a.i=1;ae(a,1);a.nd.fill(0);a.cd.fill(0);a.cd[5]=1;a.cd[9]=248}m=Wd.prototype;
m.Y=function(){var a=[];a[2]=this.o;a[3]=this.jb;a[4]=this.B;a[5]=this.h;a[6]=this.M;a[7]=this.Nd;a[8]=this.De;a[9]=this.nc;a[10]=this.jd;a[11]=this.wb;a[12]=this.xb;a[15]=this.F;a[16]=this.l;a[17]=this.Pb;a[18]=this.j;a[19]=this.mc;a[20]=this.mb;a[21]=this.Qb;a[22]=this.hd;a[23]=this.Ob;a[24]=this.D;a[25]=this.C;a[26]=this.Rb;a[27]=this.hb;a[28]=this.i;a[29]=this.P;a[30]=this.K;a[31]=this.cd;a[33]=this.eb;a[34]=this.ba;a[35]=this.nd;return a};
m.H=function(a){this.o=a[2];this.jb=a[3];this.B=a[4];this.h=a[5];this.M=a[6];be(this);this.Nd=a[7];this.De=a[8];this.nc=a[9];this.jd=a[10];this.wb=a[11];this.xb=a[12];this.F=a[15];this.l=a[16];this.Pb=a[17];this.j=a[18];this.mc=a[19];this.mb=a[20];this.Qb=a[21];this.hd=a[22];this.Ob=a[23];this.D=a[24];this.C=a[25];this.Rb=a[26];this.hb=a[27];this.i=a[28];this.P=a[29];this.K=a[30];this.cd=a[31];this.eb=a[33];this.ba=a[34];this.nd=a[35];this.g=this.D.buffer;this.X=new Int8Array(this.g);this.W=new Int16Array(this.g);
this.aa=new Uint16Array(this.g);this.Va=new Ib(this.g);this.Rb?this.A.send("dac-disable"):this.A.send("dac-enable")};m.Qg=function(){r("220 read: fm music status port (unimplemented)",8388608);return 255};m.Sg=function(){r("221 read: fm music data port (write only)",8388608);return 255};m.Ri=function(){r("222 read: advanced fm music status port (unimplemented)",8388608);return 255};m.Ti=function(){r("223 read: advanced music data port (write only)",8388608);return 255};
m.Vi=function(){r("224 read: mixer address port",8388608);return this.h};m.Xi=function(){r("225 read: mixer data port",8388608);var a=this.h,b=Sd[a];b?b=b.call(this):(b=this.M[a],r("unhandled mixer register read. addr:"+K(a)+" data:"+K(b),8388608));return b};m.Zi=function(){r("226 read: (write only)",8388608);return 255};m.aj=function(){r("227 read: undocumented",8388608);return 255};m.cj=function(){r("228 read: fm music status port (unimplemented)",8388608);return 255};
m.ej=function(){r("229 read: fm music data port (write only)",8388608);return 255};m.gj=function(){r("22A read: read data",8388608);this.ea.length&&(this.o=this.ea.shift());r(" <- "+this.o+" "+K(this.o)+" '"+String.fromCharCode(this.o)+"'",8388608);return this.o};m.ij=function(){r("22B read: undocumented",8388608);return 255};m.kj=function(){r("22C read: write-buffer status",8388608);return 127};m.mj=function(){r("22D read: undocumented",8388608);return 255};
m.oj=function(){r("22E read: read-buffer status / irq 8bit ack.",8388608);this.nd[1]&&ae(this,1);return(this.ea.length&&!this.nc)<<7|127};m.qj=function(){r("22F read: irq 16bit ack",8388608);ae(this,2);return 0};m.Rg=function(a){r("220 write: (unimplemented) fm register 0 address = "+K(a),8388608);this.S=0};m.Tg=function(a){r("221 write: (unimplemented) fm register 0 data = "+K(a),8388608);var b=Vd[this.S];b||(b=this.Ye);b.call(this,a,0,this.S)};
m.Si=function(a){r("222 write: (unimplemented) fm register 1 address = "+K(a),8388608);this.U=0};m.Ui=function(a){r("223 write: (unimplemented) fm register 1 data ="+K(a),8388608);var b=Vd[this.U];b||(b=this.Ye);b.call(this,a,1,this.U)};m.Wi=function(a){r("224 write: mixer address = "+K(a),8388608);this.h=a};m.Yi=function(a){r("225 write: mixer data = "+K(a),8388608);ce(this,this.h,a)};
m.$i=function(a){r("226 write: reset = "+K(a),8388608);this.nc?(r(" -> exit highspeed",8388608),this.nc=!1):a&&(r(" -> reset",8388608),$d(this));this.ea.clear();this.ea.push(170)};m.bj=function(){r("227 write: undocumented",8388608)};m.dj=function(){r("228 write: fm music register port (unimplemented)",8388608)};m.fj=function(){r("229 write: fm music data port (unimplemented)",8388608)};m.hj=function(){r("22A write: dsp read data port (read only)",8388608)};
m.jj=function(){r("22B write: undocumented",8388608)};m.lj=function(a){r("22C write: write command/data",8388608);0===this.jb?(r("22C write: command = "+K(a),8388608),this.jb=a,this.Fa.clear(),this.B=Qd[a]):(r("22C write: data: "+K(a),8388608),this.Fa.push(a));this.Fa.length>=this.B&&(a=Rd[this.jb],a||(a=this.Se),a.call(this),this.B=this.jb=0,this.Fa.clear())};m.nj=function(){r("22D write: undocumented",8388608)};m.pj=function(){r("22E write: dsp read buffer status (read only)",8388608)};
m.rj=function(){r("22F write: undocumented",8388608)};m.Wj=function(){r("330 read: mpu data",8388608);this.I.length&&(this.V=this.I.shift());r(" <- "+K(this.V),8388608);return this.V};m.Xj=function(a){r("330 write: mpu data (unimplemented) : "+K(a),8388608)};m.Yj=function(){r("331 read: mpu status",8388608);return 0|128*!this.I.length};m.Zj=function(a){r("331 write: mpu command: "+K(a),8388608);255==a&&(this.I.clear(),this.I.push(254))};m.Se=function(){r("Unhandled command: "+K(this.jb),8388608)};
function W(a,b,c){c||(c=Wd.prototype.Se);for(var e=0;e<a.length;e++)Qd[a[e]]=b,Rd[a[e]]=c}function de(a){for(var b=[],c=0;16>c;c++)b.push(a+c);return b}W([14],2,function(){this.cd[this.Fa.shift()]=this.Fa.shift()});W([15],1,function(){this.ea.clear();this.ea.push(this.cd[this.Fa.shift()])});W([16],1,function(){var a=this.Fa.shift();a=ee(a/127.5+-1);this.Lb[0].push(a);this.Lb[1].push(a);this.A.send("dac-enable")});
W([20,21],2,function(){this.mc=1;this.mb=this.Qb;this.nc=this.wb=this.xb=this.Ob=!1;fe(this);ge(this)});W([22],2);W([23],2);W([28],0,function(){this.mc=1;this.mb=this.Qb;this.Ob=!0;this.nc=this.wb=this.xb=!1;ge(this)});W([31],0);W([32],0,function(){this.ea.clear();this.ea.push(127)});W([36],2);W([44],0);W([48],0);W([49],0);W([52],0);W([53],0);W([54],0);W([55],0);W([56],0);W([64],1,function(){he(this,1E6/(256-this.Fa.shift())/(this.jd?2:1))});W([65,66],2,function(){he(this,this.Fa.shift()<<8|this.Fa.shift())});
W([72],2,function(){fe(this)});W([116],2);W([117],2);W([118],2);W([119],2);W([125],0);W([127],0);W([128],2);W([144],0,function(){this.mc=1;this.mb=this.Qb;this.Ob=!0;this.xb=!1;this.nc=!0;this.wb=!1;ge(this)});W([145],0);W([152],0);W([153],0);W([160],0);W([168],0);W(de(176),3,function(){if(this.jb&8)this.Se();else{var a=this.Fa.shift();this.mc=2;this.mb=this.hd;this.Ob=!!(this.jb&4);this.xb=!!(a&16);this.jd=!!(a&32);this.wb=!0;fe(this);ge(this)}});
W(de(192),3,function(){if(this.jb&8)this.Se();else{var a=this.Fa.shift();this.mc=1;this.mb=this.Qb;this.Ob=!!(this.jb&4);this.xb=!!(a&16);this.jd=!!(a&32);this.wb=!1;fe(this);ge(this)}});W([208],0,function(){this.Rb=!0;this.A.send("dac-disable")});W([209],0,function(){this.Nd=!0});W([211],0,function(){this.Nd=!1});W([212],0,function(){this.Rb=!1;this.A.send("dac-enable")});W([213],0,function(){this.Rb=!0;this.A.send("dac-disable")});W([214],0,function(){this.Rb=!1;this.A.send("dac-enable")});
W([216],0,function(){this.ea.clear();this.ea.push(255*this.Nd)});W([217,218],0,function(){this.Ob=!1});W([224],1,function(){this.ea.clear();this.ea.push(~this.Fa.shift())});W([225],0,function(){this.ea.clear();this.ea.push(4);this.ea.push(5)});W([226],1);W([227],0,function(){this.ea.clear();for(var a=0;44>a;a++)this.ea.push("COPYRIGHT (C) CREATIVE TECHNOLOGY LTD, 1992.".charCodeAt(a));this.ea.push(0)});W([228],1,function(){this.De=this.Fa.shift()});W([232],0,function(){this.ea.clear();this.ea.push(this.De)});
W([242,243],0,function(){this.Da()});var ie=new Uint8Array(256);ie[14]=255;ie[15]=7;ie[55]=56;W([249],1,function(){var a=this.Fa.shift();r("dsp 0xf9: unknown function. input: "+a,8388608);this.ea.clear();this.ea.push(ie[a])});function ce(a,b,c){var e=Td[b];e?e.call(a,c):r("unhandled mixer register write. addr:"+K(b)+" data:"+K(c),8388608)}Wd.prototype.$a=function(){r("mixer register read. addr:"+K(this.h),8388608);return this.M[this.h]};
Wd.prototype.cb=function(a){r("mixer register write. addr:"+K(this.h)+" data:"+K(a),8388608);this.M[this.h]=a};function Xd(a){a.M[4]=204;a.M[34]=204;a.M[38]=204;a.M[40]=0;a.M[46]=0;a.M[10]=0;a.M[48]=192;a.M[49]=192;a.M[50]=192;a.M[51]=192;a.M[52]=192;a.M[53]=192;a.M[54]=0;a.M[55]=0;a.M[56]=0;a.M[57]=0;a.M[59]=0;a.M[60]=31;a.M[61]=21;a.M[62]=11;a.M[63]=0;a.M[64]=0;a.M[65]=0;a.M[66]=0;a.M[67]=0;a.M[68]=128;a.M[69]=128;a.M[70]=128;a.M[71]=128;be(a)}
function be(a){for(var b=1;b<a.M.length;b++)Ud[b]||ce(a,b,a.M[b])}function je(a,b){b||(b=Wd.prototype.$a);Sd[a]=b}function ke(a,b){b||(b=Wd.prototype.cb);Td[a]=b}function le(a,b,c){Ud[a]=1;Sd[a]=function(){return this.M[b]&240|this.M[c]>>>4};Td[a]=function(e){this.M[a]=e;var d=e<<4&240|this.M[c]&15;ce(this,b,e&240|this.M[b]&15);ce(this,c,d)}}function me(a,b,c){Sd[a]=Wd.prototype.$a;Td[a]=function(e){this.M[a]=e;this.A.send("mixer-volume",[b,c,(e>>>2)-62])}}je(0,function(){Xd(this);return 0});ke(0);
le(4,50,51);le(34,48,49);le(38,52,53);le(40,54,55);le(46,56,57);me(48,0,0);me(49,0,1);me(50,2,0);me(51,2,1);je(59);ke(59,function(a){this.M[59]=a;this.A.send("mixer-volume",[1,2,6*(a>>>6)-18])});je(65);ke(65,function(a){this.M[65]=a;this.A.send("mixer-gain-left",6*(a>>>6))});je(66);ke(66,function(a){this.M[66]=a;this.A.send("mixer-gain-right",6*(a>>>6))});je(68);ke(68,function(a){this.M[68]=a;a>>>=3;this.A.send("mixer-treble-left",a-(16>a?14:16))});je(69);
ke(69,function(a){this.M[69]=a;a>>>=3;this.A.send("mixer-treble-right",a-(16>a?14:16))});je(70);ke(70,function(a){this.M[70]=a;a>>>=3;this.A.send("mixer-bass-right",a-(16>a?14:16))});je(71);ke(71,function(a){this.M[71]=a;a>>>=3;this.A.send("mixer-bass-right",a-(16>a?14:16))});je(128,function(){switch(this.ba){case 2:return 1;case 5:return 2;case 7:return 4;case 10:return 8;default:return 0}});ke(128,function(a){a&1&&(this.ba=2);a&2&&(this.ba=5);a&4&&(this.ba=7);a&8&&(this.ba=10)});
je(129,function(){var a=0;switch(this.Qb){case 0:a|=1;break;case 1:a|=2;break;case 3:a|=8}switch(this.hd){case 5:a|=32;break;case 6:a|=64;break;case 7:a|=128}return a});ke(129,function(a){a&1&&(this.Qb=0);a&2&&(this.Qb=1);a&8&&(this.Qb=3);a&32&&(this.hd=5);a&64&&(this.hd=6);a&128&&(this.hd=7)});je(130,function(){for(var a=32,b=0;16>b;b++)a|=b*this.nd[b];return a});Wd.prototype.Ye=function(a,b,c){r("unhandled fm register write. addr:"+b+"|"+K(c)+" data:"+K(a),8388608)};
function ne(a,b){b||(b=Wd.prototype.Ye);for(var c=0;c<a.length;c++)Vd[a[c]]=b}function oe(a,b){for(var c=[];a<=b;a++)c.push(a);return c}var pe=new Uint8Array(32);pe[0]=0;pe[1]=1;pe[2]=2;pe[3]=3;pe[4]=4;pe[5]=5;pe[8]=6;pe[9]=7;pe[10]=8;pe[11]=9;pe[12]=10;pe[13]=11;pe[16]=12;pe[17]=13;pe[18]=14;pe[19]=15;pe[20]=16;pe[21]=17;ne([1],function(a,b){this.pi[b]=a&1});ne([2]);ne([3]);ne([4],function(){});ne([5],function(a,b,c){0===b&&this.Ye(a,b,c)});ne([8],function(){});ne(oe(32,53),function(){});
ne(oe(64,85),function(){});ne(oe(96,117),function(){});ne(oe(128,149),function(){});ne(oe(160,168),function(){});ne(oe(176,184),function(){});ne([189],function(){});ne(oe(192,200),function(){});ne(oe(224,245),function(){});function he(a,b){a.hb=b;a.A.send("dac-tell-sampling-rate",b)}function fe(a){a.F=1+(a.Fa.shift()<<0)+(a.Fa.shift()<<8)}
function ge(a){r("begin dma transfer",8388608);a.i=1;a.wb&&(a.i*=2);a.l=a.F*a.i;a.j=1024*a.i;a.j=Math.min(Math.max(a.l>>2&-4,32),a.j);a.C=!0;a.lb.jc[a.mb]||a.la(a.mb)}Wd.prototype.la=function(a){a===this.mb&&this.C&&(this.C=!1,this.Pb=this.l,this.Rb=!1,this.A.send("dac-enable"))};
function Zd(a){r("dma transfering next block",8388608);var b=Math.min(a.Pb,a.j),c=Math.floor(b/a.i);a.lb.ke(a.Va,0,b,a.mb,e=>{r("dma block transfer "+(e?"unsuccessful":"successful"),8388608);if(!e){e=a.wb?32767.5:127.5;var d=a.xb?0:-1,f=a.jd?1:2,k;a.wb?k=a.xb?a.W:a.aa:k=a.xb?a.X:a.D;for(var l=0,p=0;p<c;p++)for(var q=ee(k[p]/e+d),t=0;t<f;t++)a.Lb[l].push(q),l^=1;Yd(a);a.Pb-=b;a.Pb||(a.Da(a.mc),a.Ob&&(a.Pb=a.l))}})}
function Yd(a){if(a.Lb[0].length){var b=Pb(a.Lb[0],a.Lb[0].length),c=Pb(a.Lb[1],a.Lb[1].length);a.A.send("dac-send-data",[b,c],[b.buffer,c.buffer])}}Wd.prototype.Da=function(a){r("raise irq",8388608);this.nd[a]=1;this.s.Sa(this.ba)};function ae(a,b){r("lower irq",8388608);a.nd[b]=0;Wb(a.s,a.ba)}function ee(a){return-1*(-1>a)+1*(1<a)+(-1<=a&&1>=a)*a};function ma(a,b){this.s=a;this.Ta=a.v.Ta;this.Re=b.Re;this.J=[244,26,b.Re&255,b.Re>>8,7,5,16,0,1,0,2,0,0,0,0,0,1,168,0,0,0,16,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,b.nh&255,b.nh>>8,0,0,0,0,64,0,0,0,0,0,0,0,0,1,0,0];this.J=this.J.concat(Array(256-this.J.length).fill(0));this.Oa=b.Oa;this.gb=[];this.name=b.name;this.i=this.B=0;this.l=new Uint32Array(4);this.h=new Uint32Array(4);for(var c of b.Pe.features)n(0<=c,"VirtIO device<"+this.name+"> feature bit numbers must be non-negative"),
n(128>c,"VirtIO device<"+this.name+"> feature bit numbers assumed less than 128 in implementation"),this.l[c>>>5]|=1<<(c&31),this.h[c>>>5]|=1<<(c&31);n(b.Pe.features.includes(32),"VirtIO device<"+this.name+"> only non-transitional devices are supported");this.C=!0;this.j=0;this.F=!1;this.D=0;this.bb=[];for(var e of b.Pe.bb)this.bb.push(new qe(a,this,e));this.o=0;this.g=this.bb[0];this.Kc=0;c=new Set;for(var d of this.bb.map(f=>f.Sd))e=b.notification.mh?0:d,c.add(e),n(b.notification.$e[e],"VirtIO device<"+
this.name+"> every queue's notifier must exist");for(const [f,k]of b.notification.$e.entries())n(!k||c.has(f),"VirtIO device<"+this.name+"> no defined notify handler should be unused");d=[];d.push(re(this,b.Pe));d.push(se(this,b.notification));d.push(te(this,b.Kc));b.mg&&d.push(ue(this,b.mg));ve(this,d);fc(a.v.Ta,this);this.reset()}
function re(a,b){return{type:1,xc:0,port:b.kd,He:!1,offset:0,me:new Uint8Array(0),Dd:[{bytes:4,name:"device_feature_select",read:()=>a.B,write:c=>{a.B=c}},{bytes:4,name:"device_feature",read:()=>a.l[a.B]||0,write:()=>{}},{bytes:4,name:"driver_feature_select",read:()=>a.i,write:c=>{a.i=c}},{bytes:4,name:"driver_feature",read:()=>a.h[a.i]||0,write:c=>{const e=a.l[a.i];a.i<a.h.length&&(a.h[a.i]=c&e);a.C=a.C&&!(c&~e)}},{bytes:2,name:"msix_config",read:()=>{r("No msi-x capability supported.",2097152);
return 65535},write:()=>{r("No msi-x capability supported.",2097152)}},{bytes:2,name:"num_queues",read:()=>a.bb.length,write:()=>{}},{bytes:1,name:"device_status",read:()=>a.j,write:c=>{0===c?(r("Reset device<"+a.name+">",2097152),a.reset()):c&128?r("Warning: Device<"+a.name+"> status failed",2097152):r("Device<"+a.name+"> status: "+(c&1?"ACKNOWLEDGE ":"")+(c&2?"DRIVER ":"")+(c&4?"DRIVER_OK":"")+(c&8?"FEATURES_OK ":"")+(c&64?"DEVICE_NEEDS_RESET":""),2097152);c&~a.j&4&&a.j&64&&(a.F=!0,a.j&4?a.Da(2):
n(!1,"VirtIO device<"+a.name+"> attempted to notify driver before DRIVER_OK"));a.C||(c&8&&r("Removing FEATURES_OK",2097152),c&=-9);a.j=c}},{bytes:1,name:"config_generation",read:()=>a.D,write:()=>{}},{bytes:2,name:"queue_select",read:()=>a.o,write:c=>{a.o=c;a.o<a.bb.length||(a.g=null)}},{bytes:2,name:"queue_size",read:()=>a.g?a.g.size:0,write:c=>{a.g&&(c&c-1&&(r("Warning: dev<"+a.name+"> Given queue size was not a power of 2. Rounding up to next power of 2.",2097152),c=1<<Hb(c-1)+1),c>a.g.wc&&(r("Warning: dev<"+
a.name+"> Trying to set queue size greater than supported. Clamping to supported size.",2097152),c=a.g.wc),we(a.g,c))}},{bytes:2,name:"queue_msix_vector",read:()=>{r("No msi-x capability supported.",2097152);return 65535},write:()=>{r("No msi-x capability supported.",2097152)}},{bytes:2,name:"queue_enable",read:()=>a.g?a.g.enabled|0:0,write:c=>{a.g&&(1===c?(c=a.g,c.l&&c.h&&c.g?(c=a.g,n(c.l&&c.h&&c.g,"VirtQueue must be configured before enabled"),c.enabled=!0):r("Driver bug: tried enabling unconfigured queue",
2097152)):0===c&&r("Driver bug: tried writing 0 to queue_enable",2097152))}},{bytes:2,name:"queue_notify_off",read:()=>a.g?a.g.Sd:0,write:()=>{}},{bytes:4,name:"queue_desc (low dword)",read:()=>a.g?a.g.l:0,write:c=>{a.g&&(a.g.l=c)}},{bytes:4,name:"queue_desc (high dword)",read:()=>0,write:()=>{r("Warning: High dword of 64 bit queue_desc ignored",2097152)}},{bytes:4,name:"queue_avail (low dword)",read:()=>a.g?a.g.h:0,write:c=>{a.g&&(a.g.h=c)}},{bytes:4,name:"queue_avail (high dword)",read:()=>0,write:()=>
{r("Warning: High dword of 64 bit queue_avail ignored",2097152)}},{bytes:4,name:"queue_used (low dword)",read:()=>a.g?a.g.g:0,write:c=>{a.g&&(a.g.g=c)}},{bytes:4,name:"queue_used (high dword)",read:()=>0,write:()=>{r("Warning: High dword of 64 bit queue_used ignored",2097152)}}]}}
function se(a,b){const c=[];b.mh?(n(1===b.$e.length,"VirtIO device<"+a.name+"> too many notify handlers specified: expected single handler"),a=0):a=2;for(const [e,d]of b.$e.entries())c.push({bytes:2,name:"notify"+e,read:()=>65535,write:d||(()=>{})});return{type:2,xc:1,port:b.kd,He:!1,offset:0,me:new Uint8Array([a&255,a>>8&255,a>>16&255,a>>24]),Dd:c}}
function te(a,b){return{type:3,xc:2,port:b.kd,He:!1,offset:0,me:new Uint8Array(0),Dd:[{bytes:1,name:"isr_status",read:()=>{const c=a.Kc;xe(a);return c},write:()=>{}}]}}function ue(a,b){n(~b.offset&3,"VirtIO device<"+a.name+"> device specific cap offset must be 4-byte aligned");return{type:4,xc:3,port:b.kd,He:!1,offset:0,me:new Uint8Array(0),Dd:b.Dd}}
function ve(a,b){let c=a.J[52]=64;var e=c;for(const f of b){b=16+f.me.length;e=c;c=e+b;n(256>=c,"VirtIO device<"+a.name+"> can't fit all capabilities into 256byte configspace");n(0<=f.xc&&6>f.xc,"VirtIO device<"+a.name+"> capability invalid bar number");var d=f.Dd.reduce((k,l)=>k+l.bytes,0);d+=f.offset;d=16>d?16:1<<Hb(d-1)+1;n(0===(f.port&d-1),"VirtIO device<"+a.name+"> capability port should be aligned to pci bar size");a.gb[f.xc]={size:d};a.J[e]=9;a.J[e+1]=c;a.J[e+2]=b;a.J[e+3]=f.type;a.J[e+4]=
f.xc;a.J[e+5]=0;a.J[e+6]=0;a.J[e+7]=0;a.J[e+8]=f.offset&255;a.J[e+9]=f.offset>>>8&255;a.J[e+10]=f.offset>>>16&255;a.J[e+11]=f.offset>>>24;a.J[e+12]=d&255;a.J[e+13]=d>>>8&255;a.J[e+14]=d>>>16&255;a.J[e+15]=d>>>24;for(const [k,l]of f.me.entries())a.J[e+16+k]=l;e=16+4*f.xc;a.J[e]=f.port&254|!f.He;a.J[e+1]=f.port>>>8&255;a.J[e+2]=f.port>>>16&255;a.J[e+3]=f.port>>>24&255;e=f.port+f.offset;for(const k of f.Dd){let l=k.read;b=k.write;l=()=>{const p=k.read();r("Device<"+a.name+"> cap["+f.type+"] read["+k.name+
"] => "+K(p,8*k.bytes),2097152);return p};b=p=>{r("Device<"+a.name+"> cap["+f.type+"] write["+k.name+"] <= "+K(p,8*k.bytes),2097152);k.write(p)};if(f.He)n(!1,"VirtIO device <"+a.name+"> mmio capability not implemented.");else{d=function(q){r("Warning: 8-bit read from 16-bit virtio port",2097152);return l(q&-2)>>((q&1)<<3)&255};const p=function(q){r("Warning: 8-bit read from 32-bit virtio port",2097152);return l(q&-4)>>((q&3)<<3)&255};switch(k.bytes){case 4:N(a.s.u,e,a,p,void 0,l);P(a.s.u,e,a,void 0,
void 0,b);break;case 2:N(a.s.u,e,a,d,l);P(a.s.u,e,a,void 0,b);break;case 1:N(a.s.u,e,a,l);P(a.s.u,e,a,b);break;default:n(!1,"VirtIO device <"+a.name+"> invalid capability field width of "+k.bytes+" bytes")}}e+=k.bytes}}n(256>=c+20,"VirtIO device<"+a.name+"> can't fit all capabilities into 256byte configspace");a.J[c]=9;a.J[c+1]=0;a.J[c+2]=20;a.J[c+3]=5;a.J[c+4]=0;a.J[c+5]=0;a.J[c+6]=0;a.J[c+7]=0;a.J[c+8]=0;a.J[c+9]=0;a.J[c+10]=0;a.J[c+11]=0;a.J[c+12]=0;a.J[c+13]=0;a.J[c+14]=0;a.J[c+15]=0;a.J[c+16]=
0;a.J[c+17]=0;a.J[c+18]=0;a.J[c+19]=0}ma.prototype.Y=function(){let a=[];a[0]=this.B;a[1]=this.i;a[2]=this.l;a[3]=this.h;a[4]=this.C;a[5]=this.j;a[6]=this.F;a[7]=this.D;a[8]=this.Kc;a[9]=this.o;return a=a.concat(this.bb)};ma.prototype.H=function(a){this.B=a[0];this.i=a[1];this.l=a[2];this.h=a[3];this.C=a[4];this.j=a[5];this.F=a[6];this.D=a[7];this.Kc=a[8];this.o=a[9];let b=0;for(let c of a.slice(10))this.bb[b].H(c),b++;this.g=this.bb[this.o]||null};
ma.prototype.reset=function(){this.i=this.B=0;this.h.set(this.l);this.C=!0;this.o=this.j=0;this.g=this.bb[0];for(const a of this.bb)a.reset();this.F=!1;this.D=0;xe(this)};ma.prototype.Da=function(a){r("Raise irq "+K(a),2097152);this.Kc|=a;this.Ta.Da(this.Oa)};function xe(a){r("Lower irq ",2097152);a.Kc=0;zc(a.Ta,a.Oa)}function qe(a,b,c){this.s=a;this.Za=b;this.wc=this.size=c.wc;this.sd=this.size-1;this.enabled=!1;this.Sd=c.Sd;this.i=this.g=this.j=this.h=this.l=0;this.reset()}
qe.prototype.Y=function(){const a=[];a[0]=this.size;a[1]=this.wc;a[2]=this.enabled;a[3]=this.Sd;a[4]=this.l;a[5]=this.h;a[6]=this.j;a[7]=this.g;a[8]=this.i;return a};qe.prototype.H=function(a){this.size=a[0];this.wc=a[1];this.enabled=a[2];this.Sd=a[3];this.l=a[4];this.h=a[5];this.j=a[6];this.g=a[7];this.i=a[8];this.sd=this.size-1};qe.prototype.reset=function(){this.enabled=!1;this.i=this.g=this.j=this.h=this.l=0;we(this,this.wc)};
function we(a,b){n(0===(b&b-1),"VirtQueue size must be power of 2 or zero");n(b<=a.wc,"VirtQueue size must be within supported size");a.size=b;a.sd=b-1}function na(a){n(a.h,"VirtQueue addresses must be configured before use");return(a.s.ta(a.h+2)&a.sd)!==a.j}
function oa(a,b){this.s=a.s;this.Za=a.Za;this.Ag=b;this.i=[];this.Gf=this.g=this.h=0;this.dg=[];this.Hf=this.Je=this.cg=0;let c=a.l,e=0,d=a.size,f=!1;const k=0<(this.Za.h[0]&268435456);r("<<< Descriptor chain start",2097152);do{var l=a,p=c,q=b;l={Ke:l.s.h(p+16*q),Mh:l.s.h(p+16*q+4),se:l.s.h(p+16*q+8),flags:l.s.ta(p+16*q+12),next:l.s.ta(p+16*q+14)};r("descriptor: idx="+b+" addr="+K(l.Mh,8)+":"+K(l.Ke,8)+" len="+K(l.se,8)+" flags="+K(l.flags,4)+" next="+K(l.next,4),2097152);if(k&&l.flags&4)l.flags&
1&&r("Driver bug: has set VIRTQ_DESC_F_NEXT flag in an indirect table descriptor",2097152),c=l.Ke,e=b=0,d=l.se/16,r("start indirect",2097152);else{if(l.flags&2)f=!0,this.dg.push(l);else{if(f){r("Driver bug: readonly buffer after writeonly buffer within chain",2097152);break}this.i.push(l);this.Gf+=l.se}e++;if(e>d){r("Driver bug: descriptor chain cycle detected",2097152);break}if(l.flags&1)b=l.next;else break}}while(1);r("Descriptor chain end >>>",2097152)}
function ua(a,b){let c=0,e=b.length;for(;e;){if(a.h===a.i.length){r("Device<"+a.Za.name+"> Read more than device-readable buffers has",2097152);break}var d=a.i[a.h],f=d.Ke+a.g;let q=d.se-a.g;q>e?(q=e,a.g+=e):(a.h++,a.g=0);d=b;var k=d.set,l=a.s,p=q;p&&(n(!l.cf(f)),n(!l.cf(f+p-1)));k.call(d,l.Na.subarray(f,f+p),c);c+=q;e-=q}};function ye(){this.te={};this.g=void 0}ye.prototype.register=function(a,b,c){var e=this.te[a];void 0===e&&(e=this.te[a]=[]);e.push({Ze:b,Xf:c})};ye.prototype.unregister=function(a,b){var c=this.te[a];void 0!==c&&(this.te[a]=c.filter(function(e){return e.Ze!==b}))};ye.prototype.send=function(a,b){if(this.g&&(a=this.g.te[a],void 0!==a))for(var c=0;c<a.length;c++){var e=a[c];e.Ze.call(e.Xf,b)}};function ze(){var a=new ye,b=new ye;a.g=b;b.g=a;return[a,b]};var pb=[],r=function(){var a=ia.reduce(function(e,d){e[d[0]]=d[1];return e},{}),b="",c=0;return function(e,d){d=d||1;if(d&eb){e="["+fb(a[d]||"",4)+"] "+e;if(e===b&&(c++,2048>c))return;d=new Date;d=kb(d.getHours(),2)+":"+kb(d.getMinutes(),2)+":"+kb(d.getSeconds(),2)+"+"+kb(d.getMilliseconds(),3)+" ";c&&(1===c?console.log(d+b):console.log("Previous message repeated "+c+" times"),c=0);console.log(d+e);b=e}}}();
function n(a,b){if(!a){debugger;console.trace();if(b)throw"Assert failed: "+b;throw"Assert failed";}};function yb(a,b,c){this.zh=c;this.za=b;Ae(this);b=Object.create(null);b.m=this.za.exports.memory;for(var e of Object.keys(this.za.exports))e.startsWith("_")||e.startsWith("zstd")||e.endsWith("_js")||(b[e]=this.za.exports[e]);this.yh=b;this.Qa=e=this.za.exports.memory;this.G=R(Uint32Array,e,812,1);this.Na=new Uint8Array(0);this.Eb=new Int32Array(this.Na.buffer);this.Hb=R(Uint8Array,e,724,8);this.P=R(Int32Array,e,736,8);this.o=R(Uint32Array,e,768,8);this.K=R(Int32Array,e,800,1);this.Db=R(Int32Array,
e,564,1);this.vb=R(Int32Array,e,568,1);this.B=R(Int32Array,e,572,1);this.tb=R(Int32Array,e,576,1);this.hh=R(Int32Array,e,1128,1);this.Gc=R(Uint32Array,e,540,8);this.Ba=R(Int32Array,e,580,8);this.V=R(Uint8Array,e,612,1);this.F=R(Int32Array,e,804,1);this.S=R(Int32Array,e,808,1);this.j=R(Uint8Array,e,616,1);this.Fc=R(Int32Array,e,620,1);this.ec=R(Int32Array,e,624,1);this.Lg=R(Int32Array,e,636,1);this.eh=R(Int32Array,e,640,1);this.dh=R(Int32Array,e,644,1);this.Hc=R(Int32Array,e,648,1);this.flags=R(Int32Array,
e,120,1);this.fc=R(Int32Array,e,100,1);this.Ec=R(Int32Array,e,96,1);this.Cc=R(Int32Array,e,104,1);R(Int32Array,e,112,1);this.wk=R(Uint32Array,e,960,2);this.v={};this.D=R(Int32Array,e,556,1);this.Lc=R(Int32Array,e,560,1);R(Uint8Array,e,548,1);this.U=R(Uint8Array,e,552,1);this.l=[];this.we=[];this.Fb=[];this.ve=[];this.Kd={Gg:null,ae:null};this.zi=R(Uint32Array,e,664,1);this.i=R(Int32Array,e,64,8);this.ic=R(Int32Array,e,1152,32);this.cb=R(Uint8Array,e,816,1);this.cb[0]=255;this.eb=R(Uint8Array,e,1032,
1);this.eb[0]=0;this.W=R(Uint16Array,e,1036,1);this.W[0]=895;this.zk=R(Uint16Array,e,1040,1);this.zk[0]=0;this.la=R(Int32Array,e,1048,1);this.la[0]=0;this.Va=R(Int32Array,e,1052,1);this.Va[0]=0;this.$a=R(Int32Array,e,1044,1);this.$a[0]=0;this.X=R(Int32Array,e,1056,1);this.X[0]=0;this.aa=R(Int32Array,e,1060,1);this.aa[0]=0;this.pd=R(Int32Array,e,832,32);R(Int32Array,e,824,1);this.g=R(Uint16Array,e,668,8);this.dc=R(Int32Array,e,684,8);this.Mc=R(Int32Array,e,968,8);this.Gh=R(Uint32Array,e,716,1);this.Fh=
R(Uint32Array,e,720,1);this.Xa=[];this.Ef=0;this.ud=[];this.u=void 0;this.A=a;this.Hg(0,0);Be(this);this.Cf=this.rg=0;this.ue={}}
function Ae(a){const b=c=>{const e=a.za.exports[c];console.assert(e,"Missing import: "+c);return e};a.Gb=b("reset_cpu");a.wh=b("getiopl");a.Bc=b("get_eflags");a.C=b("get_eflags_no_arith");a.I=b("pic_call_irq");a.yk=b("do_many_cycles_native");b("cycle_internal");a.Ia=b("read8");a.ta=b("read16");a.h=b("read32s");a.Jd=b("write8");a.$c=b("write16");a.Cb=b("write32");a.cf=b("in_mapped_range");b("fpu_load_tag_word");b("fpu_load_status_word");b("fpu_get_sti_f64");a.Ib=b("translate_address_system_read_js");
a.ub=b("get_seg_cs");a.vh=b("get_real_eip");b("clear_tlb");a.Ak=b("full_clear_tlb");a.oh=b("update_state_flags");a.Hg=b("set_tsc");a.Bh=b("store_current_tsc");a.Ah=b("set_cpuid_level");a.xh=b("jit_clear_cache_js");a.Ai=b("jit_dirty_cache");a.sk=b("codegen_finalize_finished");a.qk=b("allocate_memory");a.Kh=b("zero_memory");a.Dh=b("svga_allocate_memory");a.Ch=b("svga_allocate_dest_buffer");a.Hh=b("svga_fill_pixel_buffer");a.Jg=b("svga_mark_dirty");a.sh=b("zstd_create_ctx");a.uh=b("zstd_get_src_ptr");
a.th=b("zstd_free_ctx");a.be=b("zstd_read");a.ce=b("zstd_read_free")}
yb.prototype.Y=function(){var a=[];a[0]=this.G[0];a[1]=this.Hb;a[2]=this.P;a[3]=this.o;a[4]=this.K[0];a[5]=this.vb[0];a[6]=this.Db[0];a[7]=this.tb[0];a[8]=this.B[0];a[9]=this.Gc[0];a[10]=this.Ba;a[11]=this.V[0];a[13]=this.F[0];a[16]=this.S[0];a[17]=this.j[0];a[18]=this.Fc[0];a[19]=this.ec[0];a[22]=this.Lg[0];a[23]=this.dh[0];a[24]=this.eh[0];a[25]=this.Hc[0];a[26]=this.flags[0];a[27]=this.fc[0];a[28]=this.Cc[0];a[30]=this.Ec[0];a[37]=this.D[0];a[38]=this.Lc[0];a[39]=this.i;a[40]=this.g;a[41]=this.dc;
a[42]=this.Mc;this.Bh();a[43]=this.wk;a[45]=this.v.ag;a[46]=this.v.ad;a[47]=this.v.Yc;a[48]=this.v.Ta;a[49]=this.v.lb;a[50]=this.v.Aa;a[51]=this.v.Bg;a[52]=this.v.ae;a[53]=this.v.Nf;a[54]=this.v.Zf;a[55]=this.v.Df;a[56]=this.v.ga;a[57]=this.v.N;a[58]=this.v.mf;a[59]=this.v.If;a[60]=this.v.rc;a[61]=this.v.Rf;a[62]=this.Xa;a[63]=this.v.Ic;a[64]=this.hh[0];a[66]=this.pd;a[67]=this.ic;a[68]=this.cb[0];a[69]=this.eb[0];a[70]=this.W[0];a[71]=this.la[0];a[72]=this.Va[0];a[73]=this.X[0];a[74]=this.aa[0];
a[75]=this.$a[0];n(0===(this.Na.length&4095));var b=this.Na.length>>12,c=[];for(var e=0;e<b;e++){var d=e<<12;d=this.Eb.subarray(d>>2,d+4096>>2);let l=!0;for(let p=0;p<d.length;p++)if(0!==d[p]){l=!1;break}l||c.push(e)}b=new Qb(b);e=new Uint8Array(c.length<<12);for(let [l,p]of c.entries())b.set(p,1),c=p<<12,e.set(this.Na.subarray(c,c+4096),l<<12);const {Hi:f,Ph:k}={Ph:b,Hi:e};a[77]=f;a[78]=new Uint8Array(k.yb());a[79]=this.v.Ee;a[80]=this.v.Fe;a[81]=this.v.Ge;return a};
yb.prototype.H=function(a){this.G[0]=a[0];this.Na.length!==this.G[0]&&console.warn("Note: Memory size mismatch. we="+this.Na.length+" state="+this.G[0]);this.Hb.set(a[1]);this.P.set(a[2]);this.o.set(a[3]);this.K[0]=a[4];this.vb[0]=a[5];this.Db[0]=a[6];this.tb[0]=a[7];this.B[0]=a[8];this.Gc[0]=a[9];this.Ba.set(a[10]);this.V[0]=a[11];this.F[0]=a[13];this.S[0]=a[16];this.j[0]=a[17];this.Fc[0]=a[18];this.ec[0]=a[19];this.Lg[0]=a[22];this.dh[0]=a[23];this.eh[0]=a[24];this.Hc[0]=a[25];this.flags[0]=a[26];
this.fc[0]=a[27];this.Cc[0]=a[28];this.Ec[0]=a[30];this.D[0]=a[37];this.Lc[0]=a[38];this.i.set(a[39]);this.g.set(a[40]);this.dc.set(a[41]);a[42]&&this.Mc.set(a[42]);this.Hg(a[43][0],a[43][1]);this.v.ag&&this.v.ag.H(a[45]);this.v.ad&&this.v.ad.H(a[46]);this.v.Yc&&this.v.Yc.H(a[47]);this.v.Ta&&this.v.Ta.H(a[48]);this.v.lb&&this.v.lb.H(a[49]);this.v.Aa&&this.v.Aa.H(a[50]);this.v.Bg&&this.v.Bg.H(a[51]);this.v.ae&&this.v.ae.H(a[52]);this.v.Nf&&this.v.Nf.H(a[53]);this.v.Zf&&this.v.Zf.H(a[54]);this.v.Df&&
this.v.Df.H(a[55]);this.v.ga&&this.v.ga.H(a[56]);this.v.N&&this.v.N.H(a[57]);this.v.mf&&this.v.mf.H(a[58]);this.v.If&&this.v.If.H(a[59]);this.v.rc&&this.v.rc.H(a[60]);this.v.Rf&&this.v.Rf.H(a[61]);this.v.Ee&&this.v.Ee.H(a[79]);this.v.Fe&&this.v.Fe.H(a[80]);this.v.Ge&&this.v.Ge.H(a[81]);this.Xa=a[62];this.v.Ic&&this.v.Ic.H(a[63]);this.hh[0]=a[64];this.pd.set(a[66]);this.ic.set(a[67]);this.cb[0]=a[68];this.eb[0]=a[69];this.W[0]=a[70];this.la[0]=a[71];this.Va[0]=a[72];this.X[0]=a[73];this.aa[0]=a[74];
this.$a[0]=a[75];var b=new Qb(a[78].buffer);a=a[77];this.Kh(this.G[0]);const c=this.G[0]>>12;let e=0;for(let d=0;d<c;d++)if(b.get(d)){let f=e<<12;this.Na.set(a.subarray(f,f+4096),d<<12);e++}this.oh();this.Ak();this.xh()};function yc(a){a.Gb();a.Xa=[];a.v.Za&&a.v.Za.reset();Fb(a)}
function Ce(a,b){1048576>b?b=1048576:0>(b|0)&&(b=Math.pow(2,31)-131072);b=(b-1|131071)+1|0;n(0<(b|0));n(0===(b&131071));console.assert(0===a.G[0],"Expected uninitialised memory");a.G[0]=b;const c=a.qk(b);a.Na=R(Uint8Array,a.Qa,c,b);a.Eb=R(Uint32Array,a.Qa,c,b>>2)}
yb.prototype.fb=function(a,b){"number"===typeof a.Fg&&(eb=a.Fg);Ce(this,"number"===typeof a.G?a.G:67108864);a.Ld&&this.Ah(a.Ld);this.U[0]=+a.Aa;this.Gb();var c=new rb(this);this.u=c;this.Kd.Gg=a.Kd;this.Kd.ae=a.vk;Fb(this);if(a.Kb){const {Gi:d}=De(this.Na,a.Kb,a.md,a.ed||"");d&&this.ud.push(d)}N(c,179,this,function(){r("port 0xB3 read");return 0});var e=0;N(c,146,this,function(){return e});P(c,146,this,function(d){e=d});N(c,1297,this,function(){if(this.Ef<this.Xa.length)return this.Xa[this.Ef++];
n(!1,"config port: Read past value");return 0});P(c,1296,this,void 0,function(d){function f(p){return new Uint8Array((new Int32Array([p])).buffer)}function k(p){return p>>8|p<<8&65280}function l(p){return p<<24|p<<8&16711680|p>>8&65280|p>>>24}r("bios config port, index="+K(d));this.Ef=0;if(0===d)this.Xa=f(1431127377);else if(1===d)this.Xa=f(0);else if(3===d)this.Xa=f(this.G[0]);else if(5===d)this.Xa=f(1);else if(15===d)this.Xa=f(1);else if(13===d)this.Xa=new Uint8Array(16);else if(25===d){d=new Int32Array(4+
64*this.ud.length);const p=new Uint8Array(d.buffer);d[0]=l(this.ud.length);for(let q=0;q<this.ud.length;q++){const {name:t,data:u}=this.ud[q],A=4+64*q;n(65536>49152+q);d[A>>2]=l(u.length);d[A+4>>2]=k(49152+q);n(56>t.length);for(let v=0;v<t.length;v++)p[A+8+v]=t.charCodeAt(v)}this.Xa=p}else 32768<=d&&49152>d?this.Xa=f(0):49152<=d&&d-49152<this.ud.length?this.Xa=this.ud[d-49152].data:(r("Warning: Unimplemented fw index: "+K(d)),this.Xa=f(0))});P(c,128,this,function(){});N(c,128,this,function(){return 255});
P(c,233,this,function(){});this.v={};a.Bi&&(this.v.rc=new hd(this),this.v.Ta=new uc(this),this.U[0]&&(this.v.Ic=new Ed(this),this.v.ad=new ud(this),this.v.Aa=new qd(this)),this.v.Yc=new id(this),Ee(this,this.v.Yc,a),this.v.lb=new Dc(this),this.v.ae=new Pc(this,b,a.fa||8388608),this.v.Nf=new dd(this,b),this.v.Zf=new ld(this,1016,b),a.Ee&&(this.v.Ee=new ld(this,760,b)),a.Fe&&(this.v.Fe=new ld(this,1E3,b)),a.Ge&&(this.v.Ge=new ld(this,744,b)),this.v.Df=new Ac(this,a.qa),c=0,a.N&&(this.v.N=new Ub(this,
a.N,a.af,!1,c++,b)),a.ga&&(this.v.ga=new Ub(this,a.ga,void 0,!0,c++,b)),this.v.mf=new Ic(this,b),a.ki&&(this.v.If=new Ld(this,b,a.Mf,a.Yb)),a.Ub&&(this.v.ag=new la(a.Ub,this,b)),this.v.Rf=new Wd(this,b));a.Oc&&Fe(this,a.Oc);this.debug.fb()};
function Fe(a,b){r("Trying multiboot from buffer of size "+b.byteLength,2);if(8192>b.byteLength){var c=new Int32Array(2048);(new Uint8Array(c.buffer)).set(new Uint8Array(b))}else c=new Int32Array(b,0,2048);for(var e=0;8192>e;e+=4)if(464367618===c[e>>2]){var d=c[e+4>>2];if(464367618+d+c[e+8>>2]|0)r("Multiboot checksum check failed",2);else{r("Multiboot magic found, flags: "+K(d>>>0,8),2);n(0===(d&-65537),"TODO");a.i[0]=732803074;a.i[3]=31744;a.Cb(31744,0);a.Ba[0]=1;a.K[0]=1;a.flags[0]=2;a.F[0]=1;a.S[0]=
1;for(var f=0;6>f;f++)a.Hb[f]=0,a.P[f]=0,a.o[f]=4294967295,a.g[f]=45058;if(d&65536){r("Multiboot specifies its own address table",2);var k=c[e+12>>2],l=c[e+16>>2];f=c[e+20>>2];d=c[e+28>>2];r("header="+K(k,8)+" load="+K(l,8)+" load_end="+K(f,8)+" bss_end="+K(c[e+24>>2],8)+" entry="+K(d,8));n(l<=k);c=e-(k-l);0===f?e=void 0:(n(f>=l),e=f-l);b=new Uint8Array(b,c,e);ta(a,b,l);a.D[0]=a.ub()+d|0}else if(1179403647===c[0]){r("Multiboot image is in elf format",2);c=Ge(b);a.D[0]=a.ub()+c.wi.li|0;for(l of c.hk)0!==
l.type&&(1===l.type?(n(l.xe===l.rh),n(l.Xe<=l.ef),l.xe+l.ef<a.G[0]?l.Xe&&(c=new Uint8Array(b,l.offset,l.Xe),ta(a,c,l.xe)):r("Warning: Skipped loading section, paddr="+K(l.xe)+" memsz="+l.ef,2)):2!==l.type&&3!==l.type&&4!==l.type&&6!==l.type&&1685382480!==l.type&&1685382481!==l.type&&1685382483!==l.type&&n(!1,"unimplemented elf section type: "+K(l.type)))}else n(!1,"Not a bootable multiboot format");a.u.ac(244,a,function(p){console.log("Test exited with code "+K(p,2));throw"HALT";},function(){},function(){},
function(){});for(let p=0;15>=p;p++){function q(t){r("kvm-unit-test: Set irq "+K(p)+" to "+K(t,2));t?this.Sa(p):Wb(this,p)}P(a.u,8192+p,a,q,q,q)}a.oh();r("Starting multiboot kernel at:",2);a.debug.ii();a.debug.sg();break}}}
function Ee(a,b,c){var e=c.yc||531;S(b,56,1|e>>4&240);S(b,61,e&255);S(b,21,128);S(b,22,2);e=0;1048576<=a.G[0]&&(e=a.G[0]-1048576>>10,e=Math.min(e,65535));S(b,23,e&255);S(b,24,e>>8&255);S(b,48,e&255);S(b,49,e>>8&255);e=0;16777216<=a.G[0]&&(e=a.G[0]-16777216>>16,e=Math.min(e,65535));S(b,52,e&255);S(b,53,e>>8&255);S(b,91,0);S(b,92,0);S(b,93,0);S(b,20,47);S(b,95,0);c.ni&&S(b,63,1)}
function Fb(a){var b=a.Kd.Gg,c=a.Kd.ae;if(b){var e=new Uint8Array(b);ta(a,e,1048576-b.byteLength);if(c){var d=new Uint8Array(c);ta(a,d,786432);ub(a.u,4272947200,1048576,function(f){f=f-4272947200|0;return f<d.length?d[f]:0},function(){n(!1,"Unexpected write to VGA rom")})}else r("Warning: No VGA BIOS");ub(a.u,4293918720,1048576,function(f){return this.Na[f&1048575]}.bind(a),function(f,k){this.Na[f&1048575]=k}.bind(a))}else r("Warning: No BIOS")}
function He(a,b,c,e,d,f){d>>>=0;f>>>=0;n(0<=b&&900>b);const k=new Uint8Array(a.Qa.buffer,d,f);a.ue[c]=(a.ue[c]||0)+1;a.Jh&&a.Jh(k);WebAssembly.instantiate(k,{e:a.yh}).then(l=>{a.za.bg.set(b+1024,l.instance.exports.f);a.sk(b,c,e);a.Ih&&a.Ih(k)}).catch(l=>{console.log(l);debugger;throw l;})}function Bb(a){if(a.C()&512){const b=Db(a,Cb());Eb(a);return b}return 100}
function Db(a,b){var c=a.v.mf.Bb(b,!1);var e=a.v.Yc.Bb(b,!1);let d=100,f=100;a.U[0]&&(d=a.v.Aa.Bb(b),f=a.v.ad.Bb(b));return Math.min(c,e,100,d,f)}function Eb(a){a.C()&512&&(Ie(a),a.zh())}function Ie(a){n(a.C()&512);a.v.rc&&a.v.rc.de();a.v.ad&&a.v.ad.de()}yb.prototype.Sa=function(a){n(1===arguments.length);this.v.rc&&this.v.rc.Zd(a);this.v.Ic&&this.v.Ic.Zd(a)};function Wb(a,b){a.v.rc&&a.v.rc.ee(b);a.v.Ic&&a.v.Ic.ee(b)}
"undefined"!==typeof window?window.CPU=yb:"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports.CPU=yb:"function"===typeof importScripts&&(self.CPU=yb);function Be(a){function b(t){for(var u=f.K[0]?"prot":"real",A=f.Bc(),v=f.wh(),w=f.V[0],y=K(f.g[1],4)+":"+K(f.vh()>>>0,8),z=K(f.g[2],4)+":"+K(f.i[0]>>>0,8),D=f.F[0]?"32":"16",H=f.flags[0]&512?1:0,L={[1]:"c",[4]:"p",[16]:"a",[64]:"z",[128]:"s",[256]:"t",[512]:"i",[1024]:"d",[2048]:"o"},T="",Q=0;16>Q;Q++)L[1<<Q]&&(T=A&1<<Q?T+L[1<<Q]:T+" ");return"mode="+u+"/"+D+" paging="+ +(0!==(f.Ba[0]&-2147483648))+" pae="+ +(0!==(f.Ba[4]&32))+" iopl="+v+" cpl="+w+" if="+H+" cs:eip="+y+" cs_off="+K(f.ub()>>>0,8)+
" flgs="+K(f.Bc()>>>0,6)+" ("+T+") ss:esp="+z+" ssize="+ +f.S[0]+(t?" in "+t:"")}function c(){for(var t={eax:0,ecx:1,edx:2,ebx:3,esp:4,ebp:5,esi:6,edi:7},u="eax ecx edx ebx esp ebp esi edi".split(" "),A="",v="",w=0;4>w;w++)A+=u[w]+"="+K(f.i[t[u[w]]]>>>0,8)+" ",v+=u[w+4]+"="+K(f.i[t[u[w+4]]]>>>0,8)+" ";A+="  ds="+K(f.g[3],4)+" es="+K(f.g[0],4)+" fs="+K(f.g[4],4);v+="  gs="+K(f.g[5],4)+" cs="+K(f.g[1],4)+" ss="+K(f.g[2],4);return[A,v]}function e(t,u,A){if(!(t&1))return!1;var v=128===(t&128);return{size:v,
global:256===(t&256),eg:32===(t&32),ai:64===(t&64),ig:16===(t&16),qh:4===(t&4),gh:2===(t&2),Le:(v&&!A?t&(u?4292870144:4290772992):t&4294963200)>>>0}}function d(t,u,A){for(var v=u?512:1024,w=u?8:4,y=u?21:22,z=0;z<v;z++){var D=f.h(t+z*w),H=e(D,u,!0);if(H)if(D="",D+=H.size?"S ":"  ",D+=H.eg?"A ":"  ",D+=H.ig?"Cd ":"  ",D+=H.qh?"U ":"  ",D+=H.gh?"Rw ":"   ",H.size)r("=== "+K(A+(z<<y)>>>0,8)+" -> "+K(H.Le>>>0,8)+" | "+D);else{r("=== "+K(A+(z<<y)>>>0,8)+" | "+D);for(var L=0;L<v;L++){var T=H.Le+L*w;D=f.h(T);
var Q=e(D,u,!1);Q&&(D="",D+=Q.ig?"Cd ":"   ",D+=Q.qh?"U ":"  ",D+=Q.gh?"Rw ":"   ",D+=Q.global?"G ":"  ",D+=Q.eg?"A ":"  ",D+=Q.ai?"Di ":"   ",r("# "+K(A+(z<<y|L<<12)>>>0,8)+" -> "+K(Q.Le,8)+" | "+D+"        (at "+K(T,8)+")"))}}}}var f=a,k={};a.debug=k;k.fb=function(){function t(A){10===A?(r(u,4096),u=""):u+=String.fromCharCode(A)}if(f.u){var u="";P(f.u,1026,this,t);P(f.u,1280,this,t)}};k.ri=c;k.sg=function(){var t=c();r(t[0],2);r(t[1],2)};k.Y=b;k.ii=function(){r(b(void 0),2)};k.Gk=function(t,u){var A=
f.i[4];r("========= STACK ==========");if(u>=t||void 0===u)t=5,u=-5;for(;t>u;t--){var v="    ";t||(v="=>  ");v+=K(t,2)+" | ";r(v+K(A+4*t,8)+" | "+K(f.h(A+4*t)>>>0))}};k.hi=function(){if(f.Ba[4]&32){r("PAE enabled");for(var t=0;4>t;t++){var u=f.h(f.Ba[3]+8*t);u&1&&d(u&4294963200,!0,t<<30)}}else r("PAE disabled"),d(f.Ba[3],!1,0)};k.fi=function(){function t(u,A){for(var v=0;v<A;v+=8,u+=8){var w=f.ta(u+2)|f.Ia(u+4)<<16|f.Ia(u+7)<<24,y=f.ta(u)|(f.Ia(u+6)&15)<<16,z=f.Ia(u+5),D=f.Ia(u+6)>>4,H="",L=z>>5&
3;H=z&128?H+" P ":H+"NP ";z&16?(H=D&4?H+"32b ":H+"16b ",z&8?(H+="X ",z&4&&(H+="C ")):H+="R ",H+="RW "):H+="sys: "+K(z&15);D&8&&(y=y<<12|4095);r(K(v&-8,4)+" "+K(w>>>0,8)+" ("+K(y>>>0,8)+" bytes) "+H+";  dpl = "+L+", a = "+z.toString(2)+", f = "+D.toString(2))}}r("gdt: (len = "+K(f.B[0])+")");t(f.Ib(f.tb[0]),f.B[0]);r("\nldt: (len = "+K(f.o[7])+")");t(f.Ib(f.P[7]),f.o[7])};k.gi=function(){for(var t=0;t<f.Db[0];t+=8){var u=f.Ib(f.vb[0]+t),A=f.ta(u)|f.ta(u+6)<<16,v=f.ta(u+2);u=f.Ia(u+5);var w=u>>5&3;
var y=5===(u&31)?"task gate ":14===(u&31)?"intr gate ":15===(u&31)?"trap gate ":"invalid   ";y=u&128?y+" P":y+"NP";r(K(t>>3,4)+" "+K(A>>>0,8)+", "+K(v,4)+"; "+y+";  dpl = "+w+", t = "+u.toString(2))}};k.Jk=function(t,u){void 0===t?(t=0,u=f.G[0]):void 0===u&&(u=t,t=0);return f.Na.slice(t,t+u).buffer};k.Nk=function(t,u){u=u||64;for(var A,v,w=0;w<u>>4;w++){A=K(t+(w<<4),5)+"   ";for(var y=0;16>y;y++)v=f.Ia(t+(w<<4)+y),A+=K(v,2)+" ";A+="  ";for(y=0;16>y;y++)v=f.Ia(t+(w<<4)+y),A+=33>v||126<v?".":String.fromCharCode(v);
r(A)}};k.Vk=function(){for(var t=f.G[0]/128/16|0,u,A=0;16>A;A++){u=K(128*A*t,8)+" | ";for(var v=0;128>v;v++)u+=0<f.Eb[(128*A+v)*t]?"X":" ";r(u)}};k.Ek=function(){};let l,p;k.Fk=function(t,u,A){if(!p){if(void 0===l&&(l="function"===typeof require?require("./capstone-x86.min.js"):window.cs,void 0===l)){r("Warning: Missing capstone library, disassembly not available");return}p=[new l.Capstone(l.ARCH_X86,l.MODE_16),new l.Capstone(l.ARCH_X86,l.MODE_32)]}try{p[t].disasm(u,A).forEach(function(v){r(K(v.Le>>>
0)+": "+fb(v.bytes.map(w=>K(w,2).slice(-2)).join(" "),20)+" "+v.mnemonic+" "+v.op_str)}),r("")}catch(v){r("Could not disassemble: "+Array.from(u).map(w=>K(w,2)).join(" "))}};let q;k.Hk=function(t){if(void 0===q&&(q="function"===typeof require?require("./libwabt.js"):new window.WabtModule,void 0===q)){r("Warning: Missing libwabt, wasm dump not available");return}t=t.slice();try{var u=q.readWasm(t,{Sk:!1});u.generateNames();u.applyNames();const w=u.toText({Ik:!0,Lk:!0});r(w)}catch(w){var A=new Blob([t]),
v=document.createElement("a");v.download="failed.wasm";v.href=window.URL.createObjectURL(A);v.dataset.downloadurl=["application/octet-stream",v.download,v.href].join(":");v.click();window.URL.revokeObjectURL(v.src);console.log(w.toString())}finally{u&&u.va()}}};let Je=DataView.prototype,Ke={size:1,get:Je.getUint8,set:Je.setUint8},Le={size:2,get:Je.getUint16,set:Je.setUint16},Me={size:4,get:Je.getUint32,set:Je.setUint32},Oe=Ne([{Ci:Me},{Th:Ke},{data:Ke},{tk:Ke},{Pk:Ke},{Dk:Ke},{Qk:function(a){return{size:a,get:()=>-1}}(7)},{type:Le},{Mk:Le},{uk:Me},{li:Me},{Ji:Me},{lk:Me},{flags:Me},{ji:Le},{Og:Le},{Pg:Le},{kh:Le},{lh:Le},{Uk:Le}]);console.assert(52===Oe.reduce((a,b)=>a+b.size,0));
let Pe=Ne([{type:Me},{offset:Me},{rh:Me},{xe:Me},{Xe:Me},{ef:Me},{flags:Me},{align:Me}]);console.assert(32===Pe.reduce((a,b)=>a+b.size,0));let Qe=Ne([{name:Me},{type:Me},{flags:Me},{Lh:Me},{offset:Me},{size:Me},{link:Me},{info:Me},{Nh:Me},{mi:Me}]);console.assert(40===Qe.reduce((a,b)=>a+b.size,0));function Ne(a){return a.map(function(b){var c=Object.keys(b);console.assert(1===c.length);c=c[0];b=b[c];console.assert(0<b.size);return{name:c,type:b,size:b.size,get:b.get,set:b.set}})}
function Ge(a){a=new DataView(a);let [b,c]=Re(a,Oe);console.assert(52===c);for(var e of Object.keys(b))r(e+": 0x"+(b[e].toString(16)>>>0));console.assert(1179403647===b.Ci,"Bad magic");console.assert(1===b.Th,"Unimplemented: 64 bit elf");console.assert(1===b.data,"Unimplemented: big endian");console.assert(1===b.tk,"Bad version0");console.assert(2===b.type,"Unimplemented type");console.assert(1===b.uk,"Bad version1");console.assert(52===b.ji,"Bad header size");console.assert(32===b.Og,"Bad program header size");
console.assert(40===b.kh,"Bad section header size");[e]=Se(new DataView(a.buffer,a.byteOffset+b.Ji,b.Og*b.Pg),Pe,b.Pg);[a]=Se(new DataView(a.buffer,a.byteOffset+b.lk,b.kh*b.lh),Qe,b.lh);if(eb){console.log("%d program headers:",e.length);for(let d of e)console.log("type=%s offset=%s vaddr=%s paddr=%s filesz=%s memsz=%s flags=%s align=%s",d.type.toString(16),d.offset.toString(16),d.rh.toString(16),d.xe.toString(16),d.Xe.toString(16),d.ef.toString(16),d.flags.toString(16),d.align.toString(16));console.log("%d program headers:",
a.length);for(let d of a)console.log("name=%s type=%s flags=%s addr=%s offset=%s size=%s link=%s info=%s addralign=%s entsize=%s",d.name.toString(16),d.type.toString(16),d.flags.toString(16),d.Lh.toString(16),d.offset.toString(16),d.size.toString(16),d.link.toString(16),d.info.toString(16),d.Nh.toString(16),d.mi.toString(16))}return{wi:b,hk:e,Tk:a}}function Re(a,b){let c={},e=0;for(let d of b)b=d.get.call(a,e,!0),console.assert(void 0===c[d.name]),c[d.name]=b,e+=d.size;return[c,e]}
function Se(a,b,c){let e=[],d=0;for(var f=0;f<c;f++){let [k,l]=Re(new DataView(a.buffer,a.byteOffset+d,void 0),b);e.push(k);d+=l}return[e,d]};function De(a,b,c,e){r("Trying to load kernel of size "+b.byteLength);var d=new Uint8Array(b);const f=new Uint16Array(b);var k=new Uint32Array(b),l=d[497]||4,p=f[255];if(43605!==p)r("Bad checksum1: "+K(p));else if(p=f[257]|f[258]<<16,1400005704!==p)r("Bad checksum2: "+K(p));else{p=f[259];n(514<=p);var q=d[529];n(q&1);var t=f[283],u=k[139],A=k[140],v=d[564],w=d[565],y=k[142],z=k[146],D=k[147],H=k[150],L=k[151],T=k[152];r("kernel boot protocol version: "+K(p));r("flags="+K(q)+" xflags="+K(t));r("code32_start="+
K(k[133]));r("initrd_addr_max="+K(u));r("kernel_alignment="+K(A));r("relocatable="+v);r("min_alignment="+K(w));r("cmdline max="+K(y));r("payload offset="+K(z)+" size="+K(D));r("pref_address="+K(L)+":"+K(H));r("init_size="+K(T));d[528]=255;d[529]=q&-97|128;f[274]=56832;f[253]=65535;r("heap_end_ptr="+K(56832));e+="\x00";n(e.length<y);r("cmd_line_ptr="+K(581632));k[138]=581632;for(d=0;d<e.length;d++)a[581632+d]=e.charCodeAt(d);l=512*(l+1);r("prot_mode_kernel_start="+K(l));e=new Uint8Array(b,0,l);b=new Uint8Array(b,
l);d=l=0;c&&(l=67108864,d=c.byteLength,n(1048576+b.length<l),a.set(new Uint8Array(c),l));k[134]=l;k[135]=d;n(655360>524288+e.length);a.set(e,524288);a.set(b,1048576);a=new Uint8Array(256);(new Uint16Array(a.buffer))[0]=43605;a[2]=1;c=3;a[c++]=250;a[c++]=184;a[c++]=32768;a[c++]=128;a[c++]=142;a[c++]=192;a[c++]=142;a[c++]=216;a[c++]=142;a[c++]=224;a[c++]=142;a[c++]=232;a[c++]=142;a[c++]=208;a[c++]=188;a[c++]=57344;a[c++]=224;a[c++]=234;a[c++]=0;a[c++]=0;a[c++]=32800;a[c++]=128;n(512>c);k=a[c]=0;for(b=
0;b<a.length;b++)k+=a[b];a[c]=-k;return{Gi:{name:"genroms/kernel.bin",data:a}}}};var Na=16384,Sa=4;function Te(a){this.g=[];this.C=[];this.j=a;this.B={Ff:0};this.h={};this.l=274877906944;this.o=0;this.i=[];Ma(this,"",-1)}Te.prototype.Y=function(){let a=[];a[0]=this.g;a[1]=this.B.Ff;a[2]=[];for(const [b,c]of Object.entries(this.h))0===(this.g[b].mode&Na)&&a[2].push([b,c]);a[3]=this.l;a[4]=this.o;return a=a.concat(this.i)};
Te.prototype.H=function(a){this.g=a[0].map(b=>{const c=new Ue(0);c.H(b);return c});this.B.Ff=a[1];this.h={};for(let [b,c]of a[2])c.buffer.byteLength!==c.byteLength&&(c=c.slice()),this.h[b]=c;this.l=a[3];this.o=a[4];this.i=a.slice(5)};function Ha(a,b,c){var e=a.g[b];0==e.status||2==e.status?c():5===e.status?Ha(Z(a,e),e.g,c):a.C.push({id:b,Ck:c})}
function Ve(a,b,c){var e=We(a);const d=b[0];e.size=b[1];e.qc=b[2];e.Md=e.qc;e.dd=e.qc;e.mode=b[3];e.uid=b[4];e.Ma=b[5];var f=e.mode&61440;if(f===Na)for(Xe(a,e,c,d),c=a.g.length-1,b=b[6],e=0;e<b.length;e++)Ve(a,b[e],c);else 32768===f?(e.status=2,e.bc=b[6],n(e.bc),Xe(a,e,c,d)):40960===f?(e.$d=b[6],Xe(a,e,c,d)):49152!==f&&r("Unexpected ifmt: "+K(f)+" ("+d+")")}
function Ye(a,b,c,e){const d=a.g[c],f=a.g[b];n(5!==f.status,"Filesystem: Shouldn't link under fowarder parents");n(Ze(a,b),"Filesystem: Can't link under non-directories");n(5!==d.status||0===d.g,"Filesystem: Can't link across filesystems apart from their root");n(0<=d.wa,"Filesystem: Found negative nlinks value of "+d.wa);n(!f.ha.has(e),"Filesystem: Name '"+e+"' is already taken");f.ha.set(e,c);d.wa++;Ze(a,c)&&(n(!d.ha.has(".."),"Filesystem: Cannot link a directory twice"),d.ha.has(".")||d.wa++,d.ha.set(".",
c),d.ha.set("..",b),f.wa++)}function $e(a,b,c){const e=Ya(a,b,c),d=a.g[e],f=a.g[b];n(5!==f.status,"Filesystem: Can't unlink from forwarders");n(Ze(a,b),"Filesystem: Can't unlink from non-directories");f.ha.delete(c)?(d.wa--,Ze(a,e)&&(n(d.ha.get("..")===b,"Filesystem: Found directory with bad parent id"),d.ha.delete(".."),f.wa--),n(0<=d.wa,"Filesystem: Found negative nlinks value of "+d.wa)):n(!1,"Filesystem: Can't unlink non-existent file: "+c)}
function Xe(a,b,c,e){-1!=c?(a.g.push(b),b.Tb=a.g.length-1,Ye(a,c,b.Tb,e)):0==a.g.length?(a.g.push(b),b.ha.set(".",0),b.ha.set("..",0),b.wa=2):(B("Error in Filesystem: Pushed inode with name = "+e+" has no parent"),bb())}function Ue(a){this.ha=new Map;this.ff=this.df=this.qc=this.dd=this.Md=this.Tb=this.Ma=this.uid=this.size=this.status=0;this.$d="";this.mode=493;this.Ca={type:0,version:0,path:a};this.wa=0;this.bc="";this.h=[];this.g=this.i=-1}
Ue.prototype.Y=function(){const a=[];a[0]=this.mode;a[1]=(this.mode&61440)===Na?[...this.ha]:32768===(this.mode&61440)?this.bc:40960===(this.mode&61440)?this.$d:49152===(this.mode&61440)?[this.ff,this.df]:null;a[2]=this.h;a[3]=this.status;a[4]=this.size;a[5]=this.uid;a[6]=this.Ma;a[7]=this.Tb;a[8]=this.Md;a[9]=this.dd;a[10]=this.qc;a[11]=this.Ca.version;a[12]=this.Ca.path;a[13]=this.wa;return a};
Ue.prototype.H=function(a){this.mode=a[0];if((this.mode&61440)===Na){this.ha=new Map;for(const [b,c]of a[1])this.ha.set(b,c)}else 32768===(this.mode&61440)?this.bc=a[1]:40960===(this.mode&61440)?this.$d=a[1]:49152===(this.mode&61440)&&([this.ff,this.df]=a[1]);this.h=[];for(const b of a[2]){const c=new af;c.H(b);this.h.push(c)}this.status=a[3];this.size=a[4];this.uid=a[5];this.Ma=a[6];this.Tb=a[7];this.Md=a[8];this.dd=a[9];this.qc=a[10];this.Ca.type=(this.mode&61440)>>8;this.Ca.version=a[11];this.Ca.path=
a[12];this.wa=a[13]};function bf(a,b){Object.assign(b,a,{Tb:b.Tb,ha:b.ha,wa:b.wa})}function We(a){const b=Math.round(Date.now()/1E3);a=new Ue(++a.B.Ff);a.dd=a.Md=a.qc=b;return a}function Ma(a,b,c){var e=a.g[c];if(0<=c&&5===e.status)return c=e.g,b=Ma(Z(a,e),b,c),cf(a,e.i,b);e=We(a);e.mode=511|Na;0<=c&&(e.uid=a.g[c].uid,e.Ma=a.g[c].Ma,e.mode=a.g[c].mode&511|Na);e.Ca.type=Na>>8;Xe(a,e,c,b);return a.g.length-1}
function Oa(a,b,c){var e=a.g[c];if(5===e.status)return c=e.g,b=Oa(Z(a,e),b,c),cf(a,e.i,b);e=We(a);e.uid=a.g[c].uid;e.Ma=a.g[c].Ma;e.Ca.type=128;e.mode=a.g[c].mode&438|32768;Xe(a,e,c,b);return a.g.length-1}function La(a,b,c,e,d){var f=a.g[c];if(5===f.status)return c=f.g,b=La(Z(a,f),b,c,e,d),cf(a,f.i,b);f=We(a);f.df=e;f.ff=d;f.uid=a.g[c].uid;f.Ma=a.g[c].Ma;f.Ca.type=192;f.mode=a.g[c].mode&438;Xe(a,f,c,b);return a.g.length-1}
function Ja(a,b,c,e){var d=a.g[c];if(5===d.status)return c=d.g,b=Ja(Z(a,d),b,c,e),cf(a,d.i,b);d=We(a);d.uid=a.g[c].uid;d.Ma=a.g[c].Ma;d.Ca.type=160;d.$d=e;d.mode=40960;Xe(a,d,c,b);return a.g.length-1}async function df(a,b,c,e){var d=a.g[c];if(5===d.status)return c=d.g,e=await df(Z(a,d),b,c,e),cf(a,d.i,e);d=Oa(a,b,c);b=a.g[d];c=new Uint8Array(e.length);c.set(e);await ef(a,d,c);b.size=e.length;return d}
function Fa(a,b,c){var e=a.g[b];if(5===e.status)return Fa(Z(a,e),e.g,c);(e.mode&61440)==Na&&ff(a,b);return!0}async function ab(a,b){var c=a.g[b];if(5===c.status)return await ab(Z(a,c),c.g);2===c.status&&a.j.g(c.bc);c.status==Sa&&(c.status=-1,await gf(a,b))}
async function Xa(a,b,c,e,d){if(b==e&&c==d)return 0;var f=Ya(a,b,c);if(-1===f)return-2;var k=b;n(Ze(a,k),"Filesystem: Cannot get full path of non-directory inode");for(var l="";0!=k;)l="/"+hf(a,k)+l,k=jf(a,k);if(-1!=Ya(a,e,d)&&(k=Za(a,e,d),0>k))return k;l=a.g[f];var p=a.g[b];k=a.g[e];if(5===p.status||5===k.status)if(5===p.status&&p.i===k.i){if(a=await Xa(Z(a,p),p.g,c,k.g,d),0>a)return a}else{if(0===Ea(a,f).Tb)return r("XXX: Attempted to move mountpoint ("+c+") - skipped",4194304),-1;if(!Ze(a,f)&&
1<Ea(a,f).wa)return r("XXX: Attempted to move hardlinked file ("+c+") across filesystems - skipped",4194304),-1;p=Ya(a,b,c);var q=a.g[p],t=new Ue(-1);n(q,"Filesystem divert: name ("+c+") not found");n(Ze(a,p)||1>=q.wa,"Filesystem: can't divert hardlinked file '"+c+"' with nlinks="+q.wa);Object.assign(t,q);const u=a.g.length;a.g.push(t);t.Tb=u;5===q.status&&a.i[q.i].g.set(q.g,u);if(5!==q.status||0===q.g)$e(a,b,c),Ye(a,b,u,c);if(Ze(a,p)&&5!==q.status)for(const [A,v]of t.ha)"."!==A&&".."!==A&&Ze(a,v)&&
a.g[v].ha.set("..",u);a.h[u]=a.h[p];delete a.h[p];q.ha=new Map;q.wa=0;p=u;q=Ea(a,f);t=await Va(a,p,0,q.size);5===k.status?(e=Z(a,k),d=Ze(a,p)?Ma(e,d,k.g):Oa(e,d,k.g),e=Ea(e,d),bf(q,e),kf(a,f,k.i,d)):(n(5===l.status,"Filesystem delete_forwarder: expected forwarder"),l.status=-1,a.i[l.i].g.delete(l.g),bf(q,l),Ye(a,e,f,d));await Ta(a,f,q.size);t&&t.length&&await Wa(a,f,0,t.length,t);if(Ze(a,f))for(const A of lf(a,p))if(d=await Xa(a,p,A,f,A),0>d)return d;await gf(a,p);a=Za(a,b,c);if(0>a)return a}else $e(a,
b,c),Ye(a,e,f,d),l.Ca.version++;return 0}async function Wa(a,b,c,e,d){var f=a.g[b];if(5===f.status)b=f.g,await Wa(Z(a,f),b,c,e,d);else{var k=await a.yb(b);!k||k.length<c+e?(await Ta(a,b,Math.floor(3*(c+e)/2)),f.size=c+e,k=await a.yb(b)):f.size<c+e&&(f.size=c+e);d&&k.set(d.subarray(0,e),c);await ef(a,b,k)}}async function Va(a,b,c,e){const d=a.g[b];return 5===d.status?(b=d.g,await Va(Z(a,d),b,c,e)):await mf(a,b,c,e)}
function Ya(a,b,c){b=a.g[b];if(5===b.status){const e=b.g;c=Ya(Z(a,b),e,c);return-1===c?-1:of(a,b.i,c)}a=b.ha.get(c);return void 0===a?-1:a}function Ca(a){let b=a.g.length;for(const {h:c,g:e}of a.i)b+=Ca(c),b-=e.size;return b}function Da(a){let b=1048576;for(const {h:c}of a.i)b+=Da(c);return b}function ya(a){let b=a.o;for(const {h:c}of a.i)b+=ya(c);return b}function za(a){let b=a.l;for(const {h:c}of a.i)b+=za(c);return a.l}
function hf(a,b){const c=a.g[jf(a,b)];if(5===c.status)return hf(Z(a,c),a.g[b].g);if(!c)return"";for(const [e,d]of c.ha)if(d===b)return e;n(!1,"Filesystem: Found directory inode whose parent doesn't link to it");return""}
function Ia(a,b,c,e){if(Ze(a,c))return-1;const d=a.g[b],f=a.g[c];if(5===d.status)return 5!==f.status||f.i!==d.i?(r("XXX: Attempted to hardlink a file into a child filesystem - skipped",4194304),-1):Ia(Z(a,d),d.g,f.g,e);if(5===f.status)return r("XXX: Attempted to hardlink file across filesystems - skipped",4194304),-1;Ye(a,b,c,e);return 0}
function Za(a,b,c){if("."===c||".."===c)return-1;var e=Ya(a,b,c);const d=a.g[e];var f=a.g[b];if(5===f.status)return n(5===d.status,"Children of forwarders should be forwarders"),b=f.g,Za(Z(a,f),b,c);if(f=Ze(a,e)){a:if(e=a.g[e],5===e.status)var k=Ze(Z(a,e),e.g);else{for(k of e.ha.keys())if("."!==k&&".."!==k){k=!1;break a}k=!0}f=!k}if(f)return-39;$e(a,b,c);0===d.wa&&(d.status=Sa);return 0}async function gf(a,b){const c=a.g[b];5===c.status?await gf(Z(a,c),c.g):(c.size=0,delete a.h[b])}
Te.prototype.yb=async function(a){const b=this.g[a];n(b,`Filesystem get_buffer: idx ${a} does not point to an inode`);return this.h[a]?this.h[a]:2===b.status?(n(b.bc,"Filesystem get_data: found inode on server without sha256sum"),await this.j.read(b.bc,0,b.size)):null};
async function mf(a,b,c,e){const d=a.g[b];n(d,`Filesystem get_data: idx ${b} does not point to an inode`);return a.h[b]?a.h[b].subarray(c,c+e):2===d.status?(n(d.bc,"Filesystem get_data: found inode on server without sha256sum"),await a.j.read(d.bc,c,e)):null}async function ef(a,b,c){a.h[b]=c;2===a.g[b].status&&(a.g[b].status=0,a.j.g(a.g[b].bc))}
function Ea(a,b){n(!isNaN(b),"Filesystem GetInode: NaN idx");n(0<=b&&b<a.g.length,"Filesystem GetInode: out of range idx:"+b);b=a.g[b];return 5===b.status?Ea(Z(a,b),b.g):b}async function Ta(a,b,c){var e=Ea(a,b),d=await mf(a,b,0,e.size);if(c!=e.size){var f=new Uint8Array(c);e.size=c;d&&f.set(d.subarray(0,Math.min(d.length,e.size)),0);await ef(a,b,f)}}
function pf(a,b){b=b.replace("//","/");b=b.split("/");0<b.length&&0===b[b.length-1].length&&b.pop();0<b.length&&0===b[0].length&&b.shift();const c=b.length;var e=-1,d=0;let f=null;for(var k=0;k<c;k++)if(e=d,d=Ya(a,e,b[k]),!f&&5===a.g[e].status&&(f="/"+b.slice(k).join("/")),-1==d)return k<c-1?{id:-1,Kf:-1,name:b[k],vg:f}:{id:-1,Kf:e,name:b[k],vg:f};return{id:d,Kf:e,name:b[k],vg:f}}
function ff(a,b){var c=a.g[b];if(5===c.status)ff(Z(a,c),c.g);else{var e=0;for(const d of c.ha.keys())e+=24+qf(d);b=a.h[b]=new Uint8Array(e);c.size=e;e=0;for(const [d,f]of c.ha)c=Ea(a,f),e+=ra(["Q","d","b","s"],[c.Ca,e+13+8+1+2+qf(d),c.mode>>12,d],b,e)}}
function Ua(a,b,c){a=a.h[b];n(a,`FS directory data for dirid=${b} should be generated`);n(a.length,"FS directory should have at least an entry");if(c>=a.length)return a.length;for(b=0;;){const e=J(["Q","d"],a,{offset:b})[1];if(e>c)break;b=e}return b}function Ze(a,b){b=a.g[b];return 5===b.status?Ze(Z(a,b),b.g):(b.mode&61440)===Na}
function lf(a,b){n(Ze(a,b),"Filesystem: cannot get children of non-directory inode");b=a.g[b];if(5===b.status)return lf(Z(a,b),b.g);a=[];for(const c of b.ha.keys())"."!==c&&".."!==c&&a.push(c);return a}function jf(a,b){n(Ze(a,b),"Filesystem: cannot get parent of non-directory inode");b=a.g[b];if(5!==b.status||0===b.g)return b.ha.get("..");const c=jf(Z(a,b),b.g);n(-1!==c,"Filesystem: should not have invalid parent ids");return of(a,b.i,c)}
function kf(a,b,c,e){const d=a.g[b];n(0===d.wa,"Filesystem: attempted to convert an inode into forwarder before unlinking the inode");5===d.status&&a.i[d.i].g.delete(d.g);d.status=5;d.i=c;d.g=e;a.i[c].g.set(e,b)}function cf(a,b,c){const e=We(a),d=a.g.length;a.g.push(e);e.Tb=d;kf(a,d,b,c);return d}function of(a,b,c){var e=a.i[b];n(0<=c,"Filesystem get_forwarder: invalid foreign_id: "+c);n(e,"Filesystem get_forwarder: invalid mount number: "+b);e=e.g.get(c);return void 0===e?cf(a,b,c):e}
function Z(a,b){a=a.i[b.i];n(5===b.status,"Filesystem follow_fs: inode should be a forwarding inode");n(a,"Filesystem follow_fs: inode<id="+b.Tb+"> should point to valid mounted FS");return a.h}function af(){this.type=2;this.start=0;this.length=Infinity;this.g=-1;this.h=""}af.prototype.Y=function(){const a=[];a[0]=this.type;a[1]=this.start;a[2]=Infinity===this.length?0:this.length;a[3]=this.g;a[4]=this.h;return a};
af.prototype.H=function(a){this.type=a[0];this.start=a[1];this.length=0===a[2]?Infinity:a[2];this.g=a[3];this.h=a[4]};function rf(a){const b=new af;b.H(a.Y());return b}function sf(a,b){return a.g===b.g&&a.h===b.h||2===a.type||2===b.type||1!==a.type&&1!==b.type||a.start+a.length<=b.start||b.start+b.length<=a.start?!1:!0}function tf(a,b){return b.g===a.g&&b.h===a.h&&b.type===a.type}function uf(a,b){return tf(a,b)&&b.start+b.length===a.start}
function Pa(a,b,c,e,d){n(0===a||1===a||2===a,"Filesystem: Invalid lock type: "+a);n(0<=b,"Filesystem: Invalid negative lock starting offset: "+b);n(0<c,"Filesystem: Invalid non-positive lock length: "+c);const f=new af;f.type=a;f.start=b;f.length=c;f.g=e;f.h=d;return f}function Ra(a,b,c){b=a.g[b];if(5===b.status){var e=b.g;return Ra(Z(a,b),e,c)}for(e of b.h)if(sf(c,e))return rf(e);return null}
function Qa(a,b,c,e){const d=a.g[b];if(5===d.status)return b=d.g,Qa(Z(a,d),b,c,e);c=rf(c);if(2!==c.type&&Ra(a,b,c))return 1;for(a=0;a<d.h.length;a++){e=d.h[a];n(0<e.length,"Filesystem: Found non-positive lock region length: "+e.length);n(0===e.type||1===e.type,"Filesystem: Found invalid lock type: "+e.type);n(!d.h[a-1]||d.h[a-1].start<=e.start,"Filesystem: Locks should be sorted by starting offset");if(e.start+e.length<=c.start)continue;if(c.start+c.length<=e.start)break;if(e.g!==c.g||e.h!==c.h){n(!sf(e,
c),"Filesytem: Found conflicting lock region, despite already checked for conflicts");continue}b=c.start+c.length;const f=c.start-e.start,k=e.start+e.length-b;if(0<f&&0<k&&e.type===c.type)return 0;0<f&&(e.length=f);if(0>=f&&0<k)e.start=b,e.length=k;else if(0<k){for(;a<d.h.length&&d.h[a].start<b;)a++;d.h.splice(a,0,Pa(e.type,b,k,e.g,e.h))}else 0>=f&&(d.h.splice(a,1),a--)}if(2!==c.type){a=c;e=!1;for(b=0;b<d.h.length&&!(uf(a,d.h[b])&&(d.h[b].length+=c.length,a=d.h[b],e=!0),c.start<=d.h[b].start);b++);
e||(d.h.splice(b,0,a),b++);for(;b<d.h.length;b++)if(tf(d.h[b],a)){uf(d.h[b],a)&&(a.length+=d.h[b].length,d.h.splice(b,1));break}}return 0}function vf(a,b){b=pf(a,b);if(-1!==b.id)return a=Ea(a,b.id),Array.from(a.ha.keys()).filter(c=>"."!==c&&".."!==c)}Te.prototype.Be=function(a){a=pf(this,a);if(-1===a.id)return Promise.resolve(null);const b=Ea(this,a.id);return Va(this,a.id,0,b.size)};function B(a){r([].slice.apply(arguments).join(" "),4194304)}function bb(){throw Error("message.Abort()");};function ra(a,b,c,e){for(var d,f=0,k=0;k<a.length;k++)switch(d=b[k],a[k]){case "w":c[e++]=d&255;c[e++]=d>>8&255;c[e++]=d>>16&255;c[e++]=d>>24&255;f+=4;break;case "d":c[e++]=d&255;c[e++]=d>>8&255;c[e++]=d>>16&255;c[e++]=d>>24&255;c[e++]=0;c[e++]=0;c[e++]=0;c[e++]=0;f+=8;break;case "h":c[e++]=d&255;c[e++]=d>>8;f+=2;break;case "b":c[e++]=d;f+=1;break;case "s":var l=e,p=0;c[e++]=0;c[e++]=0;f+=2;for(var q of d)wf(q.charCodeAt(0)).forEach(function(t){c[e++]=t;f+=1;p++});c[l+0]=p&255;c[l+1]=p>>8&255;break;
case "Q":ra(["b","w","d"],[d.type,d.version,d.path],c,e);e+=13;f+=13;break;default:B("Marshall: Unknown type="+a[k])}return f}
function J(a,b,c){let e=c.offset;for(var d=[],f=0;f<a.length;f++)switch(a[f]){case "w":var k=b[e++];k+=b[e++]<<8;k+=b[e++]<<16;k+=b[e++]<<24>>>0;d.push(k);break;case "d":k=b[e++];k+=b[e++]<<8;k+=b[e++]<<16;k+=b[e++]<<24>>>0;e+=4;d.push(k);break;case "h":k=b[e++];d.push(k+(b[e++]<<8));break;case "b":d.push(b[e++]);break;case "s":k=b[e++];k+=b[e++]<<8;for(var l="",p=new xf,q=0;q<k;q++){var t=p.i(b[e++]);-1!=t&&(l+=String.fromCharCode(t))}d.push(l);break;case "Q":c.offset=e;k=J(["b","w","d"],b,c);e=
c.offset;d.push({type:k[0],version:k[1],path:k[2]});break;default:B("Error in Unmarshall: Unknown type="+a[f])}c.offset=e;return d};function xf(){this.g=new Uint8Array(5);this.h=0;this.i=function(a){this.g[this.h]=a;this.h++;switch(this.h){case 1:if(128>this.g[0])return this.h=0,this.g[0];break;case 2:if(192==(this.g[0]&224)&&128==(this.g[1]&192))return this.h=0,(this.g[0]&31)<<6|this.g[1]&63}return-1}}function wf(a){if(128>a)return[a];if(2048>a)return[192|a>>6&31,128|a&63]}function qf(a){for(var b=0,c=0;c<a.length;c++)b+=128>a.charCodeAt(c)?1:2;return b};function yf(a){function b(v){!v.altKey&&l[56]&&f(56,!1);return d(v,!1)}function c(v){!v.altKey&&l[56]&&f(56,!1);return d(v,!0)}function e(){for(var v=Object.keys(l),w,y=0;y<v.length;y++)w=+v[y],l[w]&&f(w,!1);l={}}function d(v,w){if(p.A&&(v.shiftKey&&v.ctrlKey&&(73===v.keyCode||74===v.keyCode||75===v.keyCode)||!p.We?0:v.target?v.target.classList.contains("phone_keyboard")||"INPUT"!==v.target.nodeName&&"TEXTAREA"!==v.target.nodeName:1)){a:{if(void 0!==v.code){var y=A[v.code];if(void 0!==y)break a}y=
q[v.keyCode]}if(y)return f(y,w,v.repeat),v.preventDefault&&v.preventDefault(),!1;console.log("Missing char in map: keyCode="+(v.keyCode||-1).toString(16)+" code="+v.code)}}function f(v,w,y){if(w)l[v]&&!y&&f(v,!1);else if(!l[v])return;(l[v]=w)||(v|=128);255<v?(k(v>>8),k(v&255)):k(v)}function k(v){p.A.send("keyboard-code",v)}var l={},p=this;this.We=!0;var q=new Uint16Array([0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,0,58,0,0,0,0,0,0,1,0,0,0,0,57,57417,57425,57423,57415,57419,57416,57421,80,0,0,0,0,
82,83,0,11,2,3,4,5,6,7,8,9,10,0,39,0,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,57435,57436,57437,0,0,82,79,80,81,75,76,77,71,72,73,0,0,0,0,0,0,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,57435,57400,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t={8:8,10:13,32:32,39:222,
44:188,45:189,46:190,47:191,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,59:186,61:187,91:219,92:220,93:221,96:192,97:65,98:66,99:67,100:68,101:69,102:70,103:71,104:72,105:73,106:74,107:75,108:76,109:77,110:78,111:79,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,122:90},u={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,42:56,43:187,58:186,60:188,62:190,63:191,64:50,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,
81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,94:54,95:189,123:219,124:220,125:221,126:192},A={Escape:1,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Digit0:11,Minus:12,Equal:13,Backspace:14,Tab:15,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Enter:28,ControlLeft:29,KeyA:30,KeyS:31,KeyD:32,KeyF:33,KeyG:34,KeyH:35,KeyJ:36,KeyK:37,KeyL:38,Semicolon:39,Quote:40,Backquote:41,ShiftLeft:42,
Backslash:43,KeyZ:44,KeyX:45,KeyC:46,KeyV:47,KeyB:48,KeyN:49,KeyM:50,Comma:51,Period:52,Slash:53,ShiftRight:54,NumpadMultiply:55,AltLeft:56,Space:57,CapsLock:58,F1:59,F2:60,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,F10:68,NumLock:69,ScrollLock:70,Numpad7:71,Numpad8:72,Numpad9:73,NumpadSubtract:74,Numpad4:75,Numpad5:76,Numpad6:77,NumpadAdd:78,Numpad1:79,Numpad2:80,Numpad3:81,Numpad0:82,NumpadDecimal:83,IntlBackslash:86,F11:87,F12:88,NumpadEnter:57372,ControlRight:57373,NumpadDivide:57397,AltRight:57400,
Home:57415,ArrowUp:57416,PageUp:57417,ArrowLeft:57419,ArrowRight:57421,End:57423,ArrowDown:57424,PageDown:57425,Insert:57426,Delete:57427,OSLeft:57435,OSRight:57436,ContextMenu:57437};this.A=a;this.va=function(){"undefined"!==typeof window&&(window.removeEventListener("keyup",b,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("blur",e,!1))};this.fb=function(){"undefined"!==typeof window&&(this.va(),window.addEventListener("keyup",b,!1),window.addEventListener("keydown",c,
!1),window.addEventListener("blur",e,!1))};this.fb();this.g=function(v){v={keyCode:v};d(v,!0);d(v,!1)};this.nk=function(v){var w=v.charCodeAt(0);w in t?this.g(t[w]):w in u?(k(42),this.g(u[w]),k(170)):console.log("ascii -> keyCode not found: ",w,v)}};function zf(a,b){function c(z){if(!y.enabled||!y.We)return!1;var D=b||document.body,H;if(!(H=document.pointerLockElement))a:{for(z=z.target;z.parentNode;){if(z===D){H=!0;break a}z=z.parentNode}H=!1}return H}function e(z){c(z)&&(z=z.changedTouches)&&z.length&&(z=z[z.length-1],v=z.clientX,w=z.clientY)}function d(){if(t||A||u)y.A.send("mouse-click",[!1,!1,!1]),t=A=u=!1}function f(z){if(y.A&&c(z)&&y.od){var D=0,H=0,L=z.changedTouches;L?L.length&&(L=L[L.length-1],D=L.clientX-v,H=L.clientY-w,v=L.clientX,
w=L.clientY,z.preventDefault()):"number"===typeof z.movementX?(D=z.movementX,H=z.movementY):"number"===typeof z.webkitMovementX?(D=z.webkitMovementX,H=z.webkitMovementY):"number"===typeof z.mozMovementX?(D=z.mozMovementX,H=z.mozMovementY):(D=z.clientX-v,H=z.clientY-w,v=z.clientX,w=z.clientY);y.A.send("mouse-delta",[.15*D,-(.15*H)]);b&&y.A.send("mouse-absolute",[z.pageX-b.offsetLeft,z.pageY-b.offsetTop,b.offsetWidth,b.offsetHeight])}}function k(z){c(z)&&p(z,!0)}function l(z){c(z)&&p(z,!1)}function p(z,
D){y.A&&(1===z.which?t=D:2===z.which?A=D:3===z.which?u=D:r("Unknown event.which: "+z.which),y.A.send("mouse-click",[t,A,u]),z.preventDefault())}function q(z){if(c(z)){var D=z.wheelDelta||-z.detail;0>D?D=-1:0<D&&(D=1);y.A.send("mouse-wheel",[D,0]);z.preventDefault()}}var t=!1,u=!1,A=!1,v=0,w=0,y=this;this.enabled=!1;this.We=!0;this.A=a;this.A.register("mouse-enable",function(z){this.enabled=z},this);this.od=!1;this.A.register("emulator-stopped",function(){this.od=!1},this);this.A.register("emulator-started",
function(){this.od=!0},this);this.va=function(){"undefined"!==typeof window&&(window.removeEventListener("touchstart",e,!1),window.removeEventListener("touchend",d,!1),window.removeEventListener("touchmove",f,!1),window.removeEventListener("mousemove",f,!1),window.removeEventListener("mousedown",k,!1),window.removeEventListener("mouseup",l,!1),window.removeEventListener("wheel",q,{passive:!1}))};this.fb=function(){"undefined"!==typeof window&&(this.va(),window.addEventListener("touchstart",e,!1),
window.addEventListener("touchend",d,!1),window.addEventListener("touchmove",f,!1),window.addEventListener("mousemove",f,!1),window.addEventListener("mousedown",k,!1),window.addEventListener("mouseup",l,!1),window.addEventListener("wheel",q,{passive:!1}))};this.fb()};function Af(a){if("undefined"!==typeof window)if(window.AudioContext||window.webkitAudioContext){var b=window.AudioWorklet?Bf:Cf;this.A=a;this.O=window.AudioContext?new AudioContext:new webkitAudioContext;this.gf=new Df(a,this.O);this.h=new Ef(a,this.O,this.gf);this.g=new b(a,this.O,this.gf);this.h.start();a.register("emulator-stopped",function(){this.O.suspend()},this);a.register("emulator-started",function(){this.O.resume()},this);a.register("speaker-confirm-initialized",function(){a.send("speaker-has-initialized")},
this);a.send("speaker-has-initialized")}else console.warn("Web browser doesn't support Web Audio API")}Af.prototype.va=function(){this.O&&this.O.close();this.g&&this.g.Ha&&this.g.Ha.port.close()};
function Df(a,b){function c(e){return function(d){e.gain.setValueAtTime(d,this.O.currentTime)}}this.O=b;this.sources=new Map;this.yg=this.xg=this.F=this.D=this.B=1;this.i=this.O.createBiquadFilter();this.j=this.O.createBiquadFilter();this.i.type="highshelf";this.j.type="highshelf";this.i.frequency.setValueAtTime(2E3,this.O.currentTime);this.j.frequency.setValueAtTime(2E3,this.O.currentTime);this.g=this.O.createBiquadFilter();this.h=this.O.createBiquadFilter();this.g.type="lowshelf";this.h.type="lowshelf";
this.g.frequency.setValueAtTime(200,this.O.currentTime);this.h.frequency.setValueAtTime(200,this.O.currentTime);this.l=this.O.createGain();this.o=this.O.createGain();this.C=this.O.createChannelMerger(2);this.I=this.i;this.K=this.j;this.i.connect(this.g);this.g.connect(this.l);this.l.connect(this.C,0,0);this.j.connect(this.h);this.h.connect(this.o);this.o.connect(this.C,0,1);this.C.connect(this.O.destination);a.register("mixer-connect",function(e){Ff(this,e[0],e[1])},this);a.register("mixer-disconnect",
function(e){Gf(this,e[0],e[1])},this);a.register("mixer-volume",function(e){var d=e[0],f=e[1];e=Math.pow(10,e[2]/20);var k=0===d?this:this.sources.get(d);void 0===k?n(!1,"Mixer set volume - cannot set volume for undefined source: "+d):k.uf(e,f)},this);a.register("mixer-gain-left",function(e){this.xg=Math.pow(10,e/20);this.update()},this);a.register("mixer-gain-right",function(e){this.yg=Math.pow(10,e/20);this.update()},this);a.register("mixer-treble-left",c(this.i),this);a.register("mixer-treble-right",
c(this.j),this);a.register("mixer-bass-left",c(this.g),this);a.register("mixer-bass-right",c(this.h),this)}function Hf(a,b,c){b=new If(a.O,b,a.I,a.K);n(!a.sources.has(c),"Mixer add source - overwritting source: "+c);a.sources.set(c,b);return b}function Ff(a,b,c){a=a.sources.get(b);void 0===a?n(!1,"Mixer connect - cannot connect undefined source: "+b):a.connect(c)}function Gf(a,b,c){a=a.sources.get(b);void 0===a?n(!1,"Mixer disconnect - cannot disconnect undefined source: "+b):a.disconnect(c)}
Df.prototype.uf=function(a,b){void 0===b&&(b=2);switch(b){case 0:this.D=a;break;case 1:this.F=a;break;case 2:this.B=a;break;default:n(!1,"Mixer set master volume - unknown channel: "+b);return}this.update()};Df.prototype.update=function(){var a=this.B*this.F*this.yg;this.l.gain.setValueAtTime(this.B*this.D*this.xg,this.O.currentTime);this.o.gain.setValueAtTime(a,this.O.currentTime)};
function If(a,b,c,e){this.O=a;this.o=this.l=!0;this.D=this.C=this.j=this.g=1;this.B=a.createChannelSplitter(2);this.h=a.createGain();this.i=a.createGain();b.connect(this.B);this.B.connect(this.h,0);this.h.connect(c);this.B.connect(this.i,1);this.i.connect(e)}If.prototype.update=function(){var a=this.o*this.g*this.j*this.D;this.h.gain.setValueAtTime(this.l*this.g*this.j*this.C,this.O.currentTime);this.i.gain.setValueAtTime(a,this.O.currentTime)};
If.prototype.connect=function(a){var b=!a||2===a;if(b||0===a)this.l=!0;if(b||1===a)this.o=!0;this.update()};If.prototype.disconnect=function(a){var b=!a||2===a;if(b||0===a)this.l=!1;if(b||1===a)this.o=!1;this.update()};If.prototype.uf=function(a,b){void 0===b&&(b=2);switch(b){case 0:this.C=a;break;case 1:this.D=a;break;case 2:this.j=a;break;default:n(!1,"Mixer set volume - unknown channel: "+b);return}this.update()};
function Ef(a,b,c){this.Rd=b.createOscillator();this.Rd.type="square";this.Rd.frequency.setValueAtTime(440,b.currentTime);this.g=Hf(c,this.Rd,1);this.g.disconnect();a.register("pcspeaker-enable",function(){Ff(c,1)},this);a.register("pcspeaker-disable",function(){Gf(c,1)},this);a.register("pcspeaker-update",function(e){var d=e[1],f=0;3===e[0]&&(f=Math.min(1193181.6665999999/d,this.Rd.frequency.maxValue),f=Math.max(f,0));this.Rd.frequency.setValueAtTime(f,b.currentTime)},this)}Ef.prototype.start=function(){this.Rd.start()};
function Bf(a,b,c){this.A=a;this.O=b;this.enabled=!1;this.hb=48E3;b=function(){function d(l){if(0===l)return 1;l*=Math.PI;return Math.sin(l)/l}function f(){var l=Reflect.construct(AudioWorkletProcessor,[],f);l.D=3;l.B=Array(1024);l.C=0;l.I=0;l.j=0;l.F=l.B.length;l.l=0;l.K=k;l.g=k;l.P=1;l.o=0;l.i=0;l.h=0;l.port.onmessage=p=>{switch(p.data.type){case "queue":l.la(p.data.value);break;case "sampling-rate":l.P=p.data.value/sampleRate}};return l}var k=[new Float32Array(256),new Float32Array(256)];Reflect.setPrototypeOf(f.prototype,
AudioWorkletProcessor.prototype);Reflect.setPrototypeOf(f,AudioWorkletProcessor);f.prototype.process=f.prototype.process=function(l,p){for(l=0;l<p[0][0].length;l++){for(var q=0,t=0,u=this.h+this.D,A=this.h-this.D+1;A<=u;A++){var v=this.o+A;q+=this.U(v,0)*this.V(this.i-A);t+=this.U(v,1)*this.V(this.i-A)}if(isNaN(q)||isNaN(t))q=t=0,this.S("ERROR: NaN values! Ignoring for now.");p[0][0][l]=q;p[0][1][l]=t;this.i+=this.P;this.h=Math.floor(this.i)}p=this.h;p+=this.D+2;this.i-=this.h;this.o+=this.h;this.h=
0;this.X(p);return!0};f.prototype.V=function(l){return d(l)*d(l/this.D)};f.prototype.U=function(l,p){return 0>l?(l+=this.K[0].length,this.K[p][l]):this.g[p][l]};f.prototype.X=function(l){var p=this.g[0].length;p-this.o<l&&(this.aa(),this.o-=p)};f.prototype.aa=function(){256>this.l&&this.j&&this.S("Not enough samples - should not happen during midway of playback");this.K=this.g;this.g=this.W();var l=this.g[0].length;if(256>l){for(var p=this.C,q=0;256>l&&q<this.j;)l+=this.B[p][0].length,p=p+1&this.F-
1,q++;l=Math.max(l,256);l=[new Float32Array(l),new Float32Array(l)];l[0].set(this.g[0]);l[1].set(this.g[1]);p=this.g[0].length;for(var t=0;t<q;t++){var u=this.W();l[0].set(u[0],p);l[1].set(u[1],p);p+=u[0].length}this.g=l}this.uc()};f.prototype.uc=function(){1024>this.l/this.P&&this.port.postMessage({type:"pump"})};f.prototype.la=function(l){this.j<this.F&&(this.B[this.I]=l,this.I=this.I+1&this.F-1,this.j++,this.l+=l[0].length,this.uc())};f.prototype.W=function(){if(!this.j)return k;var l=this.B[this.C];
this.B[this.C]=null;this.C=this.C+1&this.F-1;this.j--;this.l-=l[0].length;return l};f.prototype.S=function(l){this.port.postMessage({type:"debug-log",value:l})};registerProcessor("dac-processor",f)}.toString();var e=URL.createObjectURL(new Blob(["var DEBUG = true;\n"+b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))],{type:"application/javascript"}));this.Ha=null;this.g=this.O.createGain();this.O.audioWorklet.addModule(e).then(()=>{URL.revokeObjectURL(e);this.Ha=new AudioWorkletNode(this.O,"dac-processor",
{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],parameterData:{},processorOptions:{}});this.Ha.port.postMessage({type:"sampling-rate",value:this.hb});this.Ha.port.onmessage=d=>{switch(d.data.type){case "pump":this.uc();break;case "debug-log":r("SpeakerWorkletDAC - Worklet: "+d.data.value)}};this.Ha.connect(this.g)});this.i=Hf(c,this.g,2);this.i.g=3;a.register("dac-send-data",function(d){this.Pf(d)},this);a.register("dac-enable",function(){this.enabled=!0},this);a.register("dac-disable",
function(){this.enabled=!1},this);a.register("dac-tell-sampling-rate",function(d){n(0<d,"Sampling rate should be nonzero");this.hb=d;this.Ha&&this.Ha.port.postMessage({type:"sampling-rate",value:d})},this);this.h=new Jf(this.O,this.g)}Bf.prototype.Pf=function(a){this.Ha&&(Kf(this.h,a),this.Ha.port.postMessage({type:"queue",value:a},[a[0].buffer,a[1].buffer]))};Bf.prototype.uc=function(){this.enabled&&this.A.send("dac-request-data")};
function Cf(a,b,c){this.A=a;this.O=b;this.enabled=!1;this.hb=22050;this.g=0;this.Ae=1;this.kf=this.O.createBiquadFilter();this.kf.type="lowpass";this.h=this.kf;this.j=Hf(c,this.h,2);this.j.g=3;a.register("dac-send-data",function(e){this.Pf(e)},this);a.register("dac-enable",function(){this.enabled=!0;this.uc()},this);a.register("dac-disable",function(){this.enabled=!1},this);a.register("dac-tell-sampling-rate",function(e){n(0<e,"Sampling rate should be nonzero");this.hb=e;this.Ae=Math.ceil(8E3/e);
this.kf.frequency.setValueAtTime(e/2,this.O.currentTime)},this);this.i=new Jf(this.O,this.h)}
Cf.prototype.Pf=function(a){Kf(this.i,a);var b=a[0].length,c=b/this.hb;if(1<this.Ae){var e=this.O.createBuffer(2,b*this.Ae,this.hb*this.Ae);for(var d=e.getChannelData(0),f=e.getChannelData(1),k=0,l=0;l<b;l++)for(var p=0;p<this.Ae;p++,k++)d[k]=a[0][l],f[k]=a[1][l]}else e=this.O.createBuffer(2,b,this.hb),e.copyToChannel?(e.copyToChannel(a[0],0),e.copyToChannel(a[1],1)):(e.getChannelData(0).set(a[0]),e.getChannelData(1).set(a[1]));a=this.O.createBufferSource();a.buffer=e;a.connect(this.kf);a.addEventListener("ended",
this.uc.bind(this));e=this.O.currentTime;if(this.g<e)for(r("Speaker DAC - Creating/Recreating reserve - shouldn't occur frequently during playback"),this.g=e,e=.2-c,b=0;b<=e;)b+=c,this.g+=c,setTimeout(()=>this.uc(),1E3*b);a.start(this.g);this.g+=c;setTimeout(()=>this.uc(),0)};Cf.prototype.uc=function(){this.enabled&&(.2<this.g-this.O.currentTime||this.A.send("dac-request-data"))};
function Jf(a,b){this.O=a;this.l=b;this.Ha=null;this.j=this.O.createGain();this.j.gain.setValueAtTime(0,this.O.currentTime);this.j.connect(this.O.destination);this.i=!1;this.B=[];this.o=[];this.h=[[],[]];this.g=[[],[]]}
Jf.prototype.start=function(a){this.i=!0;this.h=[[],[]];this.g=[[],[]];this.B.push(this.h);this.o.push(this.g);this.Ha=this.O.createScriptProcessor(1024,2,2);this.Ha.onaudioprocess=b=>{this.g[0].push(b.inputBuffer.getChannelData(0).slice());this.g[1].push(b.inputBuffer.getChannelData(1).slice())};this.l.connect(this.Ha);this.Ha.connect(this.j);setTimeout(()=>{this.stop()},a)};Jf.prototype.stop=function(){this.i=!1;this.l.disconnect(this.Ha);this.Ha.disconnect();this.Ha=null};
function Kf(a,b){a.i&&(a.h[0].push(b[0].slice()),a.h[1].push(b[1].slice()))};function Lf(a,b){function c(l){k.A&&k.enabled&&(k.i(l.which),l.preventDefault())}function e(l){var p=l.which;8===p?(k.i(127),l.preventDefault()):9===p&&(k.i(9),l.preventDefault())}function d(l){if(k.enabled){for(var p=l.clipboardData.getData("text/plain"),q=0;q<p.length;q++)k.i(p.charCodeAt(q));l.preventDefault()}}function f(l){l.target!==a&&a.blur()}var k=this;this.enabled=!0;this.A=b;this.text="";this.j=!1;this.h=0;this.A.register("serial0-output-char",function(l){this.mk(l)},this);this.va=function(){a.removeEventListener("keypress",
c,!1);a.removeEventListener("keydown",e,!1);a.removeEventListener("paste",d,!1);window.removeEventListener("mousedown",f,!1)};this.fb=function(){this.va();a.style.display="block";a.addEventListener("keypress",c,!1);a.addEventListener("keydown",e,!1);a.addEventListener("paste",d,!1);window.addEventListener("mousedown",f,!1)};this.fb();this.mk=function(l){"\b"===l?(this.text=this.text.slice(0,-1),this.update()):"\r"!==l&&(this.text+=l,"\n"===l&&(this.j=!0),this.update())};this.update=function(){var l=
Date.now(),p=l-this.h;16>p?void 0===this.g&&(this.g=setTimeout(()=>{this.g=void 0;var q=Date.now();n(15<=q-this.h);this.h=q;this.l()},16-p)):(void 0!==this.g&&(clearTimeout(this.g),this.g=void 0),this.h=l,this.l())};this.l=function(){a.value=this.text;this.j&&(this.j=!1,a.scrollTop=1E9)};this.i=function(l){k.A&&k.A.send("serial0-input",l)}}
function Mf(a,b){this.element=a;if(window.Terminal){var c=this.g=new window.Terminal;c.setOption("logLevel","off");c.write("This is the serial console. Whatever you type or paste here will be sent to COM1");var e=c.onData(function(d){for(let f=0;f<d.length;f++)b.send("serial0-input",d.charCodeAt(f))});b.register("serial0-output-char",function(d){c.write(d)},this);this.va=function(){e.dispose();c.dispose()}}}Mf.prototype.show=function(){this.g&&this.g.open(this.element)};function Nf(a,b){this.A=b;this.g=void 0;this.h=[];this.url=a;this.i=Date.now()-1E4;this.A.register("net0-send",function(c){this.send(c)},this)}m=Nf.prototype;m.ui=function(a){this.A&&this.A.send("net0-receive",new Uint8Array(a.data))};m.si=function(){this.connect();setTimeout(this.connect.bind(this),1E4)};m.vi=function(){for(var a=0;a<this.h.length;a++)this.send(this.h[a]);this.h=[]};m.ti=function(){};m.va=function(){this.g&&this.g.close()};
m.connect=function(){if("undefined"!==typeof WebSocket){if(this.g){var a=this.g.readyState;if(0===a||1===a)return}this.i+1E4>Date.now()||(this.i=Date.now(),this.g=new WebSocket(this.url),this.g.binaryType="arraybuffer",this.g.onopen=this.vi.bind(this),this.g.onmessage=this.ui.bind(this),this.g.onclose=this.si.bind(this),this.g.onerror=this.ti.bind(this))}};m.send=function(a){this.g&&1===this.g.readyState?this.g.send(a):(this.h.push(a),128<this.h.length&&(this.h=this.h.slice(-64)),this.connect())};function gb(a){this.Qe=!1;var b=ze();this.A=b[0];this.Od=b[1];var c,e;const d=new WebAssembly.Table({element:"anyfunc",initial:1924});b={cpu_exception_hook:k=>this.cpu_exception_hook&&this.cpu_exception_hook(k),hlt_op:function(){var k=c;0===(k.C()&512)&&k.A.send("cpu-event-halt");k.j[0]=1;Bb(k)},abort:function(){n(!1)},microtick:Cb,get_rand_int:function(){return Mb()},pic_acknowledge:function(){Ie(c)},io_port_read8:function(k){var l=c.u,p=l.ports[k];p.Ia===l.Ve&&r("read8 port  #"+K(k,4)+wb(k),32);
l=p.Ia.call(p.pa);n(256>l,"8 bit port returned large value: "+K(k));return l},io_port_read16:function(k){var l=c.u,p=l.ports[k];p.ta===l.Te&&r("read16 port  #"+K(k,4)+wb(k),32);l=p.ta.call(p.pa);n(65536>l&&0<=l,"16 bit port returned large value: "+K(k));return l},io_port_read32:function(k){var l=c.u,p=l.ports[k];p.Wc===l.Ue&&r("read32 port  #"+K(k,4)+wb(k),32);k=p.Wc.call(p.pa);n((k|0)===k);return k},io_port_write8:function(k,l){var p=c.u,q=p.ports[k];q.Jd===p.nb&&r("write8 port #"+K(k,4)+" <- "+
K(l,2)+wb(k),32);q.Jd.call(q.pa,l)},io_port_write16:function(k,l){var p=c.u,q=p.ports[k];q.$c===p.nb&&r("write16 port #"+K(k,4)+" <- "+K(l,4)+wb(k),32);q.$c.call(q.pa,l)},io_port_write32:function(k,l){var p=c.u,q=p.ports[k];q.Cb===p.nb&&r("write32 port #"+K(k,4)+" <- "+K(l>>>0,8)+wb(k),32);q.Cb.call(q.pa,l)},mmap_read8:function(k){k=c.l[k>>>17](k);n(0<=k&&255>=k);return k},mmap_read16:function(k){var l=c.l[k>>>17];k=l(k)|l(k+1|0)<<8;n(0<=k&&65535>=k);return k},mmap_read32:function(k){return c.Fb[k>>>
17](k)},mmap_write8:function(k,l){var p=c;n(0<=l&&255>=l);p.we[k>>>17](k,l)},mmap_write16:function(k,l){var p=c.we[k>>>17];n(0<=l&&65535>=l);p(k,l&255);p(k+1|0,l>>8)},mmap_write32:function(k,l){c.ve[k>>>17](k,l)},mmap_write64:function(k,l,p){var q=c,t=k>>>17;n(t===k+7>>>17);q=q.ve[t];q(k,l);q(k+4,p)},mmap_write128:function(k,l,p,q,t){var u=c,A=k>>>17;n(A===k+12>>>17);u=u.ve[A];u(k,l);u(k+4,p);u(k+8,q);u(k+12,t)},log_from_wasm:function(k,l){k=String.fromCharCode(...(new Uint8Array(e.buffer,k>>>0,l>>>
0)));r(k,2)},console_log_from_wasm:function(k,l){k=String.fromCharCode(...(new Uint8Array(e.buffer,k>>>0,l>>>0)));console.error(k)},dbg_trace_from_wasm:function(){r(Error().stack,2)},codegen_finalize:(k,l,p,q,t)=>{He(c,k,l,p,q,t)},jit_clear_func:k=>{var l=c;n(0<=k&&900>k);l.za.bg.set(k+1024,null)},jit_clear_all_funcs:()=>{const k=c.za.bg;for(let l=0;900>l;l++)k.set(1024+l,null)},__indirect_function_table:d};let f=a.wasm_fn;f||(f=k=>new Promise(l=>{let p="v86-debug.wasm",q="v86-fallback.wasm";if(a.wasm_path){p=
a.wasm_path;const t=p.lastIndexOf("/");q=(-1===t?"":p.substr(0,t))+"/"+q}else"undefined"===typeof window&&"string"===typeof __dirname?(p=__dirname+"/"+p,q=__dirname+"/"+q):(p="build/"+p,q="build/"+q);Tb(p,{done:async t=>{try{const {instance:u}=await WebAssembly.instantiate(t,k);this.C=t;l(u.exports)}catch(u){Tb(q,{done:async A=>{const {instance:v}=await WebAssembly.instantiate(A,k);this.C=A;l(v.exports)}})}},progress:t=>{this.Od.send("download-progress",{pe:0,oe:1,qe:p,lengthComputable:t.lengthComputable,
total:t.total,loaded:t.loaded})}})}));f({env:b}).then(k=>{e=k.memory;k.rust_init();k=this.sb=new xb(this.Od,{exports:k,bg:d});c=k.s;Of(this,k,a)});this.h=null;this.D=0}
async function Of(a,b,c){function e(v,w){switch(v){case "hda":f.N=this.lc.hda=w;break;case "hdb":f.af=this.lc.hdb=w;break;case "cdrom":f.ga=this.lc.cdrom=w;break;case "fda":f.qa=this.lc.fda=w;break;case "fdb":f.tg=this.lc.fdb=w;break;case "multiboot":f.Oc=this.lc.multiboot=w.buffer;break;case "bzimage":f.Kb=this.lc.bzimage=w.buffer;break;case "initrd":f.md=this.lc.initrd=w.buffer;break;case "bios":f.Kd=w.buffer;break;case "vga_bios":f.vk=w.buffer;break;case "initial_state":f.ld=w.buffer;break;case "fs9p_json":f.wg=
w;break;default:n(!1,v)}}async function d(){if(f.Ub&&f.wg){if(f.ld)r("Filesystem basefs ignored: Overridden by state image");else{var v=f.Ub,w=f.wg;n(w,"Invalid fs passed to load_from_json");if(3!==w.version)throw"The filesystem JSON format has changed. Please update your fs2json (https://github.com/copy/fs2json) and recreate the filesystem JSON.";var y=w.fsroot;v.o=w.size;for(w=0;w<y.length;w++)Ve(v,y[w],0)}if(c.bzimage_initrd_from_filesystem){const {Qh:z,yi:D}=Pf(f.Ub);r("Found bzimage: "+z+" and initrd: "+
D);const [H,L]=await Promise.all([f.Ub.Be(D),f.Ub.Be(z)]);e.call(this,"initrd",new Ib(H.buffer));e.call(this,"bzimage",new Ib(L.buffer))}}else n(!c.bzimage_initrd_from_filesystem,"bzimage_initrd_from_filesystem: Requires a filesystem");this.Yd&&this.Yd.show&&this.Yd.show();this.A.send("cpu-init",f);f.ld&&(b.Vd(f.ld),f.ld=void 0);c.autostart&&this.A.send("cpu-run");this.Od.send("emulator-loaded")}a.A.register("emulator-stopped",function(){this.Qe=!1},a);a.A.register("emulator-started",function(){this.Qe=
!0},a);var f={};a.lc={fda:void 0,fdb:void 0,hda:void 0,hdb:void 0,cdrom:void 0};f.Aa=c.acpi;f.Bi=!0;f.Fg=c.log_level;f.G=c.memory_size||67108864;f.fa=c.vga_memory_size||8388608;f.yc=c.boot_order||531;f.ni=c.fastboot||!1;f.qa=void 0;f.tg=void 0;f.Ee=c.uart1;f.Fe=c.uart2;f.Ge=c.uart3;f.ed=c.cmdline;f.Mf=c.preserve_mac_from_state_image;f.Yb=c.mac_address_translation;f.Ld=c.cpuid_level;c.network_adapter?a.B=c.network_adapter(a.A):c.network_relay_url&&(a.B=new Nf(c.network_relay_url,a.A));f.ki=!0;c.disable_keyboard||
(a.o=new yf(a.A));c.disable_mouse||(a.l=new zf(a.A,c.screen_container));c.screen_container?a.g=new cb(c.screen_container,a.A):c.screen_dummy&&(a.g=new Qf(a.A));c.serial_container&&(a.Yd=new Lf(c.serial_container,a.A));c.serial_container_xtermjs&&(a.Yd=new Mf(c.serial_container_xtermjs,a.A));c.disable_speaker||(a.i=new Af(a.A));var k=[],l=(v,w)=>{if(w)if(w.get&&w.set&&w.load)k.push({name:v,rd:w});else{if("bios"===v||"vga_bios"===v||"initial_state"===v||"multiboot"===v||"bzimage"===v||"initrd"===v)w.async=
!1;w.buffer instanceof ArrayBuffer?(w=new Ib(w.buffer),k.push({name:v,rd:w})):"undefined"!==typeof File&&w.buffer instanceof File?(void 0===w.async&&(w.async=268435456<=w.buffer.size),w=w.async?new Lb(w.buffer):new ob(w.buffer),k.push({name:v,rd:w})):w.url?w.async?(w=w.da?new Kb(w.url,w.size,w.L,!1,a.Bk.bind(a)):new Jb(w.url,w.size,w.L),k.push({name:v,rd:w})):k.push({name:v,url:w.url,size:w.size}):r("Ignored file: url="+w.url+" buffer="+w.buffer)}};c.state&&console.warn("Warning: Unknown option 'state'. Did you mean 'initial_state'?");
for(var p="bios vga_bios cdrom hda hdb fda fdb initial_state multiboot bzimage initrd".split(" "),q=0;q<p.length;q++)l(p[q],c[p[q]]);if(c.filesystem&&(l=c.filesystem.Oh,p=c.filesystem.Me,q=new Rf,p&&(q=new Sf(q,p)),f.Ub=a.Ub=new Te(q),l)){n(p,"Filesystem: baseurl must be specified");if("object"===typeof l){var t=l.size;l=l.url}n("string"===typeof l);k.push({name:"fs9p_json",url:l,size:t,bd:!0})}var u=k.length,A=function(v){if(v===u)setTimeout(d.bind(this),0);else{var w=k[v];w.rd?(w.rd.onload=function(){e.call(this,
w.name,w.rd);A(v+1)}.bind(this),w.rd.load()):Tb(w.url,{done:function(y){if(w.url.endsWith(".zst")&&"initial_state"!==w.name){n(w.size,"A size must be provided for compressed images");var z=w.size,D=new Uint8Array(y);y=this.sb.s;n(!this.j);this.j=y.sh(D.length);(new Uint8Array(y.Qa.buffer)).set(D,y.uh(this.j));D=y.be(this.j,z);const H=y.Qa.buffer.slice(D,D+z);y.ce(D,z);y.th(this.j);this.j=null;y=H}e.call(this,w.name,w.bd?y:new Ib(y));A(v+1)}.bind(this),progress:function(y){200===y.target.status?a.Od.send("download-progress",
{pe:v,oe:u,qe:w.url,lengthComputable:y.lengthComputable,total:y.total||w.size,loaded:y.loaded}):a.Od.send("download-error",{pe:v,oe:u,qe:w.url,request:y.target})},bd:w.bd})}}.bind(a);A(0)}m=gb.prototype;
m.Bk=async function(a,b){if(!this.h){const c=URL.createObjectURL(new Blob(["("+function(){let e;globalThis.onmessage=function(d){if(e){var f=d.data.src,k=d.data.$h;d=d.data.id;var l=e.exports,p=l.zstd_create_ctx(f.length);(new Uint8Array(l.memory.buffer)).set(f,l.zstd_get_src_ptr(p));f=l.zstd_read(p,k);var q=l.memory.buffer.slice(f,f+k);l.zstd_read_free(f,k);l.zstd_free_ctx(p);postMessage({result:q,id:d},[q])}else k=Object.fromEntries("cpu_exception_hook hlt_op microtick get_rand_int pic_acknowledge io_port_read8 io_port_read16 io_port_read32 io_port_write8 io_port_write16 io_port_write32 mmap_read8 mmap_read16 mmap_read32 mmap_write8 mmap_write16 mmap_write32 mmap_write64 mmap_write128 codegen_finalize jit_clear_func jit_clear_all_funcs".split(" ").map(t=>
[t,()=>console.error("zstd worker unexpectedly called "+t)])),k.__indirect_function_table=new WebAssembly.Table({element:"anyfunc",initial:1024}),k.abort=()=>{throw Error("zstd worker aborted");},k.log_from_wasm=k.console_log_from_wasm=(t,u)=>{console.log(String.fromCharCode(...(new Uint8Array(e.exports.memory.buffer,t,u))))},k.dbg_trace_from_wasm=()=>console.trace(),e=new WebAssembly.Instance(new WebAssembly.Module(d.data),{env:k})}}.toString()+")()"],{type:"text/javascript"}));this.h=new Worker(c);
URL.revokeObjectURL(c);this.h.postMessage(this.C,[this.C])}return new Promise(c=>{const e=this.D++,d=async f=>{f.data.id===e&&(this.h.removeEventListener("message",d),n(a===f.data.result.byteLength),c(f.data.result))};this.h.addEventListener("message",d);this.h.postMessage({src:b,$h:a,id:e},[b.buffer])})};
function Pf(a){const b=(vf(a,"/")||[]).map(d=>"/"+d);a=(vf(a,"/boot/")||[]).map(d=>"/boot/"+d);let c,e;for(let d of[].concat(b,a)){const f=/old/i.test(d)||/fallback/i.test(d),k=/initrd/i.test(d)||/initramfs/i.test(d);!/vmlinuz/i.test(d)&&!/bzimage/i.test(d)||e&&f||(e=d);!k||c&&f||(c=d)}c&&e||(console.log("Failed to find bzimage or initrd in filesystem. Files:"),console.log(b.join(" ")),console.log(a.join(" ")));return{yi:c,Qh:e}}m.sf=async function(){this.A.send("cpu-run")};
m.stop=async function(){this.Qe&&await new Promise(a=>{const b=()=>{this.A.unregister("emulator-stopped",b);a()};hb(this,"emulator-stopped",b);this.A.send("cpu-stop")})};m.va=async function(){await this.stop();this.sb.va();this.o&&this.o.va();this.B&&this.B.va();this.l&&this.l.va();this.g&&this.g.va();this.Yd&&this.Yd.va();this.i&&this.i.va()};m.Qf=function(){this.A.send("cpu-restart")};function hb(a,b,c){a.A.register(b,c,a)}m.Vd=async function(a){n(1===arguments.length);this.sb.Vd(a)};
m.Ce=async function(){n(0===arguments.length);return this.sb.Ce()};m.od=function(){return this.Qe};function jb(a,b){for(var c=0;c<b.length;c++)a.A.send("keyboard-code",b[c])}function db(a,b){for(var c=0;c<b.length;c++)a.o.nk(b[c])}function nb(){var a=document.body,b=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock;b&&b.call(a)}
m.Wh=async function(a,b){n(2===arguments.length);var c=this.Ub;if(c){var e=a.split("/");e=e[e.length-1];var d=pf(c,a).Kf;if(""!==e&&-1!==d)await df(c,e,d,b);else return Promise.reject(new Tf)}};m.Be=async function(a){n(1===arguments.length);var b=this.Ub;if(b)return(b=await b.Be(a))?b:Promise.reject(new Tf)};function Tf(){this.message="File not found"}Tf.prototype=Error.prototype;
"undefined"!==typeof window?(window.V86Starter=gb,window.V86=gb):"undefined"!==typeof module&&"undefined"!==typeof module.exports?(module.exports.V86Starter=gb,module.exports.V86=gb):"function"===typeof importScripts&&(self.V86Starter=gb,self.V86=gb);function Qf(a){var b,c,e,d,f;this.A=a;a.register("screen-set-mode",function(k){this.Uf(k)},this);a.register("screen-fill-buffer-end",function(k){this.$f(k[0])},this);a.register("screen-put-char",function(k){this.Of(k[0],k[1],k[2],k[3],k[4])},this);a.register("screen-text-scroll",function(k){console.log("scroll",k)},this);a.register("screen-update-cursor",function(k){this.Gd(k[0],k[1])},this);a.register("screen-update-cursor-scanline",function(k){this.Hd(k[0],k[1])},this);a.register("screen-set-size-text",
function(k){this.Cd(k[0],k[1])},this);a.register("screen-set-size-graphical",function(k){this.Bd(k[0],k[1])},this);this.Of=function(k,l,p,q,t){k<f&&l<d&&(k=3*(k*d+l),e[k]=p,e[k+1]=q,e[k+2]=t)};this.va=function(){};this.Uf=function(){};this.jg=function(){};this.Cd=function(k,l){if(k!==d||l!==f)e=new Int32Array(k*l*3),d=k,f=l};this.Bd=function(){};this.Vf=function(){};this.Hd=function(){};this.Gd=function(k,l){if(k!==b||l!==c)b=k,c=l};this.$f=function(){}};const ib={pk:function(a){return ib.gk(a)+ib.fk(a)},gk:function(a){let b="";var c="COMPILE COMPILE_SKIPPED_NO_NEW_ENTRY_POINTS COMPILE_WRONG_ADDRESS_SPACE COMPILE_CUT_OFF_AT_END_OF_PAGE COMPILE_WITH_LOOP_SAFETY COMPILE_PAGE COMPILE_PAGE/COMPILE COMPILE_BASIC_BLOCK COMPILE_DUPLICATED_BASIC_BLOCK COMPILE_WASM_BLOCK COMPILE_WASM_LOOP COMPILE_DISPATCHER COMPILE_ENTRY_POINT COMPILE_WASM_TOTAL_BYTES COMPILE_WASM_TOTAL_BYTES/COMPILE_PAGE RUN_INTERPRETED RUN_INTERPRETED_NEW_PAGE RUN_INTERPRETED_PAGE_HAS_CODE RUN_INTERPRETED_PAGE_HAS_ENTRY_AFTER_PAGE_WALK RUN_INTERPRETED_NEAR_END_OF_PAGE RUN_INTERPRETED_DIFFERENT_STATE RUN_INTERPRETED_DIFFERENT_STATE_CPL3 RUN_INTERPRETED_DIFFERENT_STATE_FLAT RUN_INTERPRETED_DIFFERENT_STATE_IS32 RUN_INTERPRETED_DIFFERENT_STATE_SS32 RUN_INTERPRETED_MISSED_COMPILED_ENTRY_RUN_INTERPRETED RUN_INTERPRETED_STEPS RUN_FROM_CACHE RUN_FROM_CACHE_STEPS RUN_FROM_CACHE_STEPS/RUN_FROM_CACHE RUN_FROM_CACHE_STEPS/RUN_INTERPRETED_STEPS DIRECT_EXIT INDIRECT_JUMP INDIRECT_JUMP_NO_ENTRY NORMAL_PAGE_CHANGE NORMAL_FALLTHRU NORMAL_FALLTHRU_WITH_TARGET_BLOCK NORMAL_BRANCH NORMAL_BRANCH_WITH_TARGET_BLOCK CONDITIONAL_JUMP CONDITIONAL_JUMP_PAGE_CHANGE CONDITIONAL_JUMP_EXIT CONDITIONAL_JUMP_FALLTHRU CONDITIONAL_JUMP_FALLTHRU_WITH_TARGET_BLOCK CONDITIONAL_JUMP_BRANCH CONDITIONAL_JUMP_BRANCH_WITH_TARGET_BLOCK DISPATCHER_SMALL DISPATCHER_LARGE LOOP LOOP_SAFETY CONDITION_OPTIMISED CONDITION_UNOPTIMISED CONDITION_UNOPTIMISED_PF CONDITION_UNOPTIMISED_UNHANDLED_L CONDITION_UNOPTIMISED_UNHANDLED_LE FAILED_PAGE_CHANGE SAFE_READ_FAST SAFE_READ_SLOW_PAGE_CROSSED SAFE_READ_SLOW_NOT_VALID SAFE_READ_SLOW_NOT_USER SAFE_READ_SLOW_IN_MAPPED_RANGE SAFE_WRITE_FAST SAFE_WRITE_SLOW_PAGE_CROSSED SAFE_WRITE_SLOW_NOT_VALID SAFE_WRITE_SLOW_NOT_USER SAFE_WRITE_SLOW_IN_MAPPED_RANGE SAFE_WRITE_SLOW_READ_ONLY SAFE_WRITE_SLOW_HAS_CODE SAFE_READ_WRITE_FAST SAFE_READ_WRITE_SLOW_PAGE_CROSSED SAFE_READ_WRITE_SLOW_NOT_VALID SAFE_READ_WRITE_SLOW_NOT_USER SAFE_READ_WRITE_SLOW_IN_MAPPED_RANGE SAFE_READ_WRITE_SLOW_READ_ONLY SAFE_READ_WRITE_SLOW_HAS_CODE PAGE_FAULT TLB_MISS DO_MANY_CYCLES CYCLE_INTERNAL INVALIDATE_ALL_MODULES_NO_FREE_WASM_INDICES INVALIDATE_MODULE_WRITTEN_WHILE_COMPILED INVALIDATE_MODULE_UNUSED_AFTER_OVERWRITE INVALIDATE_MODULE_DIRTY_PAGE INVALIDATE_PAGE_HAD_CODE INVALIDATE_PAGE_HAD_ENTRY_POINTS DIRTY_PAGE_DID_NOT_HAVE_CODE RUN_FROM_CACHE_EXIT_SAME_PAGE RUN_FROM_CACHE_EXIT_NEAR_END_OF_PAGE RUN_FROM_CACHE_EXIT_DIFFERENT_PAGE CLEAR_TLB FULL_CLEAR_TLB TLB_FULL TLB_GLOBAL_FULL MODRM_SIMPLE_REG MODRM_SIMPLE_REG_WITH_OFFSET MODRM_SIMPLE_CONST_OFFSET MODRM_COMPLEX SEG_OFFSET_OPTIMISED SEG_OFFSET_NOT_OPTIMISED SEG_OFFSET_NOT_OPTIMISED_ES SEG_OFFSET_NOT_OPTIMISED_FS SEG_OFFSET_NOT_OPTIMISED_GS SEG_OFFSET_NOT_OPTIMISED_NOT_FLAT".split(" "),
e=0;const d={};for(let k=0;k<c.length;k++){const l=c[k];var f=void 0;if(l.includes("/")){e++;const [p,q]=l.split("/");f=d[p]/d[q]}else f=d[l]=a.za.exports.profiler_stat_get(k-e),f=1E8<=f?Math.round(f/1E6)+"m":1E5<=f?Math.round(f/1E3)+"k":f;b+=l+"="+f+"\n"}b+="\n";c=a.za.exports.get_valid_tlb_entries_count();e=a.za.exports.get_valid_global_tlb_entries_count();b=b+("TLB_ENTRIES="+c+" ("+e+" global, "+(c-e)+" non-global)\nWASM_TABLE_FREE=")+(a.za.exports.jit_get_wasm_table_index_free_list_count()+"\n");
b+="JIT_CACHE_SIZE="+a.za.exports.jit_get_cache_size()+"\n";b+="FLAT_SEGMENTS="+a.za.exports.has_flat_segmentation()+"\n";b+="do_many_cycles avg: "+(a.Cf/a.rg||0)+"\n";b+="wasm memory size: "+(a.Qa.buffer.byteLength>>20)+"m\n";b=b+"Config:\nMAX_PAGES="+(a.za.exports.get_jit_config(0)+"\n");b+="JIT_USE_LOOP_SAFETY="+!!a.za.exports.get_jit_config(1)+"\n";return b+="MAX_EXTRA_BASIC_BLOCKS="+a.za.exports.get_jit_config(2)+"\n"},fk:function(a){return[ib.ze(a,!1,!1,!1,!1),ib.ze(a,!0,!1,!1,!1),ib.ze(a,!1,
!0,!1,!1),ib.ze(a,!1,!1,!0,!1),ib.ze(a,!1,!1,!1,!0)].join("\n\n")},ze:function(a,b,c,e,d){let f="";var k=[],l=b?"compiled":c?"jit exit":e?"unguarded register":d?"wasm size":"executed";for(let t=0;256>t;t++)for(let u=0;8>u;u++)for(let A of[!1,!0]){var p=a.za.exports.get_opstats_buffer(b,c,e,d,t,!1,A,u);k.push({lf:t,count:p,Dg:A,ug:u});p=a.za.exports.get_opstats_buffer(b,c,e,d,t,!0,A,u);k.push({lf:3840|t,count:p,Dg:A,ug:u})}a=0;b=new Set([38,46,54,62,100,101,102,103,240,242,243]);for(let {count:t,lf:u}of k)b.has(u)||
(a+=t);if(0===a)return"";c=new Uint32Array(256);b=new Uint32Array(256);for(let {lf:t,count:u}of k)3840==(t&65280)?b[t&255]+=u:c[t&255]+=u;f=f+"------------------\nTotal: "+(a+"\n");const q=1E7<a?1E3:1;e=Math.max.apply(Math,k.map(({count:t})=>Math.round(t/q)));e=String(e).length;f+=`Instruction counts ${l} (in ${q}):\n`;for(d=0;256>d;d++)f+=d.toString(16).padStart(2,"0")+":"+fb(Math.round(c[d]/q),e),f=15==d%16?f+"\n":f+" ";f=f+"\n"+`Instruction counts ${l} (0f, in ${q}):\n`;for(l=0;256>l;l++)f+=(l&
255).toString(16).padStart(2,"0")+":"+fb(Math.round(b[l]/q),e),f=15==l%16?f+"\n":f+" ";f+="\n";k=k.filter(({count:t})=>t).sort(({count:t},{count:u})=>u-t);for(let {lf:t,Dg:u,ug:A,count:v}of k.slice(0,200))f+=t.toString(16)+"_"+A+(u?"_m":"_r")+":"+(v/a*100).toFixed(2)+" ";return f+"\n"}};"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports.print_stats=ib);function Rf(){this.h=new Map}Rf.prototype.read=async function(a,b,c){n(a,"MemoryFileStorage read: sha256sum should be a non-empty string");return(a=this.h.get(a))?a.subarray(b,b+c):null};Rf.prototype.cache=async function(a,b){n(a,"MemoryFileStorage cache: sha256sum should be a non-empty string");this.h.set(a,b)};Rf.prototype.g=function(a){this.h.delete(a)};function Sf(a,b){n(b,"ServerMemoryFileStorage: baseurl should not be empty");this.h=a;this.Me=b}
function Uf(a,b){return new Promise(c=>{Tb(a.Me+b,{done:async e=>{e=new Uint8Array(e);await a.cache(b,e);c(e)}})})}Sf.prototype.read=async function(a,b,c){const e=await this.h.read(a,b,c);return e?e:(await Uf(this,a)).subarray(b,b+c)};Sf.prototype.cache=async function(a,b){return await this.h.cache(a,b)};Sf.prototype.g=function(a){this.h.g(a)};
"undefined"!==typeof window?(window.MemoryFileStorage=Rf,window.ServerFileStorageWrapper=Sf):"undefined"!==typeof module&&"undefined"!==typeof module.exports?(module.exports.MemoryFileStorage=Rf,module.exports.ServerFileStorageWrapper=Sf):"function"===typeof importScripts&&(self.MemoryFileStorage=Rf,self.ServerFileStorageWrapper=Sf);
